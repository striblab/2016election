<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

<!--STYLESHEETS-->
<link href="nvd3-master/src/nv.d3.css" rel="stylesheet" type="text/css">

<style>
path:hover {
  fill-opacity: 0.5;
  stroke: #fff !important;
}

.symbol {
  fill: #ddd;
  fill-opacity: 1;
  stroke: #fff;
}

.tooltip{ background-color:rgba(255,255,255,1);;
          margin: 10px;
          height: 50px;
          width: 150px;
          padding-left: 10px; 
          padding-top: 10px;
    -webkit-border-radius:10px;
    -moz-border-radius:10px;
    border-radius:10px;
        }

.land {
  fill: #222;
}

.state {
    fill: #ddd;
}

.state:hover {
    stroke:black;
    cursor:pointer;
}

.state-label{
    cursor:pointer;
}

rect{
border-radius:2px !important;
}

.state-label {
    -webkit-user-select: none;  /* Chrome all / Safari all */
    -moz-user-select: none;     /* Firefox all */
    -ms-user-select: none;      /* IE 10+ */
}

.key text {
    dominant-baseline: central;
    font-size: 12px;
}
.leader {
    stroke: #666;
    shape-rendering: crispEdges;
}

.selectable{
fill:#c0bfeb !important;
background-color:#c0bfeb !important;
}

 #container {
    display: table;
    width:100%;
    }

  #row  {
    display: table-row;
    }

  #left, #right, #middle {
    display: table-cell;
    }

div{
vertical-align: text-top;
}

.nvtooltip{
font-size:16px !important;
font-weight:bold !important;
padding:10px !important;
display: block !important;
margin-left: auto !important;
margin-right: auto !important;
width:auto !important;
border: 1px solid black !important;
}

.nv-axisMaxMin text{
font-weight: normal !important;
}

rect:hover{
stroke-opacity: 1 !important;
stroke: #000 !important;
}

.nv-slice:hover{
stroke-opacity: 1 !important;
stroke: #000 !important;
}

.nvd3 .nv-wrap .nv-multiBarHorizontalChart{
width:100% !important;
}

.nvd3 .nv-wrap .nv-multiBarHorizontalChart g{
width:100% !important;
}

</style>

<style>
.CSSTableGenerator {
	margin:0px;padding:0px;
	width:100%;
	border:1px solid #fff;
	
	-moz-border-radius-bottomleft:0px;
	-webkit-border-bottom-left-radius:0px;
	border-bottom-left-radius:0px;
	
	-moz-border-radius-bottomright:0px;
	-webkit-border-bottom-right-radius:0px;
	border-bottom-right-radius:0px;
	
	-moz-border-radius-topright:0px;
	-webkit-border-top-right-radius:0px;
	border-top-right-radius:0px;
	
	-moz-border-radius-topleft:0px;
	-webkit-border-top-left-radius:0px;
	border-top-left-radius:0px;
}.CSSTableGenerator table{
    border-collapse: collapse;
        border-spacing: 0;
	width:100%;
	height:100%;
	margin:0px;padding:0px;
}.CSSTableGenerator tr:last-child td:last-child {
	-moz-border-radius-bottomright:0px;
	-webkit-border-bottom-right-radius:0px;
	border-bottom-right-radius:0px;
}
.CSSTableGenerator table tr:first-child td:first-child {
	-moz-border-radius-topleft:0px;
	-webkit-border-top-left-radius:0px;
	border-top-left-radius:0px;
}
.CSSTableGenerator table tr:first-child td:last-child {
	-moz-border-radius-topright:0px;
	-webkit-border-top-right-radius:0px;
	border-top-right-radius:0px;
}.CSSTableGenerator tr:last-child td:first-child{
	-moz-border-radius-bottomleft:0px;
	-webkit-border-bottom-left-radius:0px;
	border-bottom-left-radius:0px;
}.CSSTableGenerator tr:hover td{
	
}
.CSSTableGenerator tr:nth-child(odd){ background-color:#ddd; }
.CSSTableGenerator tr:nth-child(even)    { background-color:#ddd; }.CSSTableGenerator td{
	vertical-align:middle;
	
	
	border:1px solid #fff;
	border-width:0px 1px 1px 0px;
	text-align:center;
	padding:2px;
	font-size:18px;
	font-family:Arial;
	font-weight:normal;
	color:#000000;
}.CSSTableGenerator tr:last-child td{
	border-width:0px 1px 0px 0px;
}.CSSTableGenerator tr td:last-child{
	border-width:0px 0px 1px 0px;
}.CSSTableGenerator tr:last-child td:last-child{
	border-width:0px 0px 0px 0px;
}

#menu{
width:100%;
float:left;
}

a{
text-decoration:none;
color:#000;
}

a:hover{
text-decoration:none;
color:#000;
}

.active{
background-color: #fff;
color:#000;
}

.active a{
color:#fff;
}

div a{
color:black !important;
}

td:hover{
background-color: #92B28D;
cursor:pointer;
}

.tab-content.active{
display: block;
}
 
.tab-content.hide{
display: none;
}
</style>

<style>

path:hover {
  fill-opacity: 0.5;
  stroke: #fff !important;
}

.symbol {
  fill: #ddd;
  fill-opacity: 1;
  stroke: #fff;
}

.tooltip{ background-color:rgba(255,255,255,1);;
          margin: 10px;
          height: 50px;
          width: 150px;
          padding-left: 10px; 
          padding-top: 10px;
    -webkit-border-radius:10px;
    -moz-border-radius:10px;
    border-radius:10px;
        }

label > input{ /* HIDE RADIO */
  display:none;
}
label > input + img{ /* IMAGE STYLES */
  cursor:pointer;
  border:2px solid transparent;
}
label > input:checked + img{ /* (CHECKED) IMAGE STYLES */
  border:2px solid #ddd;
}

#target, #target2, #map, #map2 {
width:100%;
height:500px;
}

#map, #map2{
display:none;
}

#can1, #can2{
    font-weight: 900;
    font-size: 24px;
}
</style>

<!--SCRIPTS-->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.9/d3.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.9/d3.min.js"></script>
<script src="//cdn.jsdelivr.net/underscorejs/1.6.0/underscore-min.map"></script>
<script src="//cdn.jsdelivr.net/underscorejs/1.6.0/underscore-min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="nvd3-master/lib/d3.v3.js"></script>
<script src="nvd3-master/nv.d3.js"></script>
<script src="nvd3-master/src/utils.js"></script>
<script src="nvd3-master/src/tooltip.js"></script>
<script src="nvd3-master/src/models/legend.js"></script>
<script src="nvd3-master/src/models/axis.js"></script>
<script src="nvd3-master/src/models/multiBarHorizontal.js"></script>
<script src="nvd3-master/src/models/multiBarHorizontalChart.js"></script>
<script src="nvd3-master/examples/stream_layers.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js" type="text/javascript"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://datamaps.github.com/scripts/datamaps-all.js"></script>


</head>

<body>
<div id="menu">
<div class="CSSTableGenerator">
                <table class="nav-tabs">
                    <tr class="nav-tabs">
                        <td class="active" width="25%">
                            <a href="#tab1">Minnesota Governor</a>
                        </td>
                        <td width="25%">
                            <a href="#tab1">U.S. Senate</a>
                        </td>
                        <td width="25%">
                           <a href="#tab1">U.S House of Representatives</a>
                        </td>
                        <td width="25%">
                            <a href="#tab1">Minnesota House of Representatives</a>
                        </td>
                    </tr>
                </table>
            </div>
</div>

<section id="tab1" class="tab-content">
<div id="buttons">
  <label value="small">
    <input type="radio" name="pickView" id="map-select" onchange="setVisibility('map', 'block');setVisibility('map2', 'block');setVisibility('target', 'none');setVisibility('target2', 'none');" />
    <img src="mnview.png">
  </label>
  
  <label>
    <input type="radio" name="pickView" value="big" id="carto-select" onchange="setVisibility('map', 'none');setVisibility('map2', 'none');setVisibility('target', 'block');setVisibility('target2', 'block');" />
    <img src="blockview.png">
  </label>
  
</div>

<div id="container">
  <div id="row">

  	<div id="left">
  		<p><div id="target"></div></p>
                <p><div id="map"><svg width="30%" height="500"></svg></div></p>
  	</div>

  	<div id="right">
  		<p><div id="target2"></div></p>
                <p><div id="map2"><svg width="30%" height="500"></svg></div></p>
  	</div>

</div>
</div>

<div id="container">
  <div id="row">

  	<div id="left">
  		<div id="can1">DFL</div>
  		<div id="voteCount">1,000,000</div>
  	</div>

  	<div id="middle">
  		<div id="tracker" class="tracking"><svg style="height:130px;width:100%"></svg></div>
  	</div>

  	<div id="right">
  		<div id="can2">GOP</div>
  		<div id="voteCount2">1,000,000</div>
  	</div>

</div>
</div>
</section>

<script>
//MENU STUFF
function setVisibility(id, visibility) {
document.getElementById(id).style.display = visibility;
}
	$(document).ready(function() {
		$('.nav-tabs > td > a').click(function(event){
		event.preventDefault();//stop browser to take action for clicked anchor

		//get displaying tab content jQuery selector
		var active_tab_selector = $('.nav-tabs > td.active > a').attr('href');					
 
		//find actived navigation and remove 'active' css
		var actived_nav = $('.nav-tabs > td.active');
		actived_nav.removeClass('active');
 
		//add 'active' css into clicked navigation
		$(this).parents('td').addClass('active');
 
		//hide displaying tab content
		$(active_tab_selector).removeClass('active');
		$(active_tab_selector).addClass('hide');
 
		//show target tab content
		var target_tab_selector = $(this).attr('href');
		$(target_tab_selector).removeClass('hide');
		$(target_tab_selector).addClass('active');
	     });
	  });
</script>

<script>
//FULL STATE MAP
var projection2 = d3.geo.albersUsa()
                       .translate([90, 800])
                       .scale([4000]);
var path2 = d3.geo.path()
                 .projection(projection2);

var svg2 = d3.select("#map svg");

var color1 = "#a7706b";
var color2 = "#79B0C5";
var basecolor = "#ddd";

d3.json("mncounties.json", function(json) {

        svg2.selectAll("path")
           .data(json.features)
           .enter()
           .append("path")
           .attr("d", path2)
           .attr("stroke-width", 1.5)
           .style("stroke", "white")
           .style("fill", "black")
//           .text(function(d) { return d.properties.DISTRICT; })
//           .style("fill", function(d) {
  //                              //Get data value
   //                             var value = update(d.properties.Party);
//
   //                            if (value != null && d.properties.Party == "R") {
  //                                     return color1;
  //                              } else if (value != null && d.properties.Party == "DFL") {
  //                                      return color2;
   //                             } else if (value != null && d.properties.Party == "DFL") {
   //                                     return color2;
    //                            } else {
    //                                    return basecolor;
    //                           }
   //               })
   //         .call(d3.helper.tooltip(
    //    function(d, i){
   //      return "<b>"+d.properties.DISTRICT + "</b> ("+d.properties.Party + ")";
    //    }
    //    ));
 });

function update(stuff){
 
var factor2 = stuff;

return factor2;
                               
}

//FULL METRO AREA MAP
var projection = d3.geo.albersUsa()
                       .translate([-1300, 3600])
                       .scale([27000]);
var path = d3.geo.path()
                 .projection(projection);

var svg = d3.select("#map2 svg");

var color1 = "#a7706b";
var color2 = "#79B0C5";
var basecolor = "#ddd";
var blankcolor = "#fff";

d3.json("mnleg.json", function(json) {

        svg.selectAll("path")
           .data(json.features)
           .enter()
           .append("path")
           .attr("d", path)
           .attr("stroke-width", 1.5)
           .style("stroke", "white")
           .text(function(d) { return d.properties.DISTRICT; })
           .style("fill", function(d) {
                                //Get data value
                                var value = update(d.properties.Party);

                                if (value != null && d.properties.DISTRICT == "14B") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "13A") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "15B") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "15A") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "31A") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "32A") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "29A") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "29B") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "47A") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "18B") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "20A") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "58B") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "21A") {
                                        return blankcolor;
                                }
                                if (value != null && d.properties.DISTRICT == "20B") {
                                        return blankcolor;
                                }

                                if (value != null && d.properties.Party == "R") {
                                        return color1;
                                } else if (value != null && d.properties.Party == "DFL") {
                                        return color2;
                                } else {
                                        return basecolor;
                                }
                   })
             .call(d3.helper.tooltip(
        function(d, i){
          return "<b>"+d.properties.DISTRICT + "</b> ("+d.properties.Party + ")";
        }
        ));
 });

function update(stuff){
 
var factor = stuff;

return factor;
                               
}
</script>

<script>
d3.helper = {};

d3.helper.tooltip = function(accessor){
    return function(selection){
        var tooltipDiv;
        var bodyNode = d3.select('body').node();
        selection.on("mouseover", function(d, i){
            // Clean up lost tooltips
            d3.select('body').selectAll('div.tooltip').remove();
            // Append tooltip
            tooltipDiv = d3.select('body').append('div').attr('class', 'tooltip');
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px')
                .style('position', 'absolute') 
                .style('z-index', 1001);
            // Add text using the accessor function
            var tooltipText = accessor(d, i) || '';
            // Crop text arbitrarily
            //tooltipDiv.style('width', function(d, i){return (tooltipText.length > 80) ? '300px' : null;})
            //    .html(tooltipText);
        })
        .on('mousemove', function(d, i) {
            // Move tooltip
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px');
            var tooltipText = accessor(d, i) || '';
            tooltipDiv.html(tooltipText);
        })
        .on("mouseout", function(d, i){
            // Remove tooltip
            tooltipDiv.remove();
        });

    };
};
</script>

<script>
//POWER BAR
var chart2;

nv.addGraph(function() {

  chart2 = nv.models.multiBarHorizontalChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .margin({top: 30, right: 20, bottom: 30, left: 20})
      //.showValues(true)
      .tooltips(true)
      .showLegend(false)
      //.barColor(#006d2c,#31a354,#74c476,#bae4b3,#edf8e9)
      .transitionDuration(250)
      .stacked(true)
      .color(['#79B0C5','#dddddd','#A7706B'])
      .showControls(false);

  chart2.yAxis
      .tickFormat(d3.format(','));

  d3.select('#tracker svg')
      .datum(favorableData)
      .call(chart2);

  nv.utils.windowResize(chart2.update);

  chart2.dispatch.on('stateChange', function(e) { nv.log('New State:', JSON.stringify(e)); });

chart2.tooltip(function(key, x, y, e, graph) {
    return x + ' Seats: ' +  y + ' ' + key;
});

  return chart2;

});


//BAR DATA
favorableData = [ 
  {
    key: 'DFL',
    values: [
      { 
        "label" : " " ,
        "value" : 63
      }
    ]
  },
  {
    key: 'Undecided',
    values: [
      { 
        "label" : " " ,
        "value" : 10
      }
    ]
  },
  {
    key: 'GOP',
    values: [
      { 
        "label" : " " ,
        "value" : 61
      }
    ]
  }
];


//CARTOGRAPHIC GREATER MINNESOTA MAP
$(document).ready(function() {
    cartogram.init();
});

var cartogram = {
    margin: {
        top: 70,
        right: 0,
        bottom: 0,
        left: 60
    },

    selector: '#target',

    init: function() {
        var self = this;

        self.$el = $(self.selector);

        self.width = 500 - self.margin.left - self.margin.right;
        self.height = 350 - self.margin.top - self.margin.bottom;

        self.svg = d3.select(self.selector).append('svg')
            .attr('height', self.height + self.margin.top + self.margin.bottom)
            .attr('width', self.width + self.margin.left + self.margin.right)

        self.state_size = self.width / 12;
        self.state_padding = 2;

        self.map = self.svg.append('g')
            .attr('transform', 'translate(' + self.margin.left + ','
                  + self.margin.top + ')')

        self.drawMap();
    },

    drawMap: function() {
        var self = this;

        var states = self.map.selectAll('.states')
            .data(self.state_pos)
            .enter().append('g')
            .attr('class', 'state-groups');

        var state = states.append('rect')
            .attr('id', function(d) {
                return d.state_postal;
            })
            .attr('class', 'state')
            .attr('rx', 2)
            .attr('ry', 2)
            .attr('x', function(d) {
                return d.column * (self.state_size + self.state_padding);
            })
            .attr('y', function(d) {
                return d.row * (self.state_size + self.state_padding);
            })
            .attr('width', self.state_size)
            .attr('height', self.state_size);

        var text = states.append('text')
            .attr('class', 'state-label')
            .attr('dominant-baseline', 'central')
            .attr('x', function(d) {
                return (d.column * (self.state_size + self.state_padding))
                        + self.state_size / 2; })
            .attr('y', function(d) {
                return (d.row * (self.state_size + self.state_padding))
                    + self.state_size / 2; })
            .style('text-anchor', 'middle')
            .text(function(d) {
                return d.state_postal;
            });
    },

    state_pos: [{'state_full':'1A','state_postal':'1A','row':0,'column':0},
        {'state_full':'1A','state_postal':'2A','row':-1,'column':1},
        {'state_full':'1B','state_postal':'1B','row':0,'column':1},
        {'state_full':'2B','state_postal':'2B','row':0,'column':2},
        {'state_full':'6A','state_postal':'6A','row':0,'column':3},
        {'state_full':'6B','state_postal':'6B','row':0,'column':4},
        {'state_full':'3B','state_postal':'3B','row':0,'column':5},
        {'state_full':'3A','state_postal':'3A','row':0,'column':6},
        {'state_full':'4A','state_postal':'4A','row':1,'column':0},
        {'state_full':'4B','state_postal':'4B','row':1,'column':1},
        {'state_full':'5A','state_postal':'5A','row':1,'column':2},
        {'state_full':'5B','state_postal':'5B','row':1,'column':3},
        {'state_full':'7B','state_postal':'7B','row':1,'column':4},
        {'state_full':'7A','state_postal':'7A','row':1,'column':5},
        {'state_full':'8A','state_postal':'8A','row':2,'column':0},
        {'state_full':'8B','state_postal':'8B','row':2,'column':1},
        {'state_full':'10A','state_postal':'10A','row':2,'column':2},
        {'state_full':'10B','state_postal':'10B','row':2,'column':3},
        {'state_full':'11A','state_postal':'11A','row':2,'column':4},
        {'state_full':'12A','state_postal':'12A','row':3,'column':0},
        {'state_full':'9A','state_postal':'9A','row':3,'column':1},
        {'state_full':'9B','state_postal':'9B','row':3,'column':2},
        {'state_full':'15B','state_postal':'15B','row':3,'column':3},
        {'state_full':'11B','state_postal':'11B','row':3,'column':4},
        {'state_full':'12B','state_postal':'12B','row':4,'column':0},
        {'state_full':'13A','state_postal':'13A','row':4,'column':1},
        {'state_full':'13B','state_postal':'13B','row':4,'column':2},
        {'state_full':'15A','state_postal':'15A','row':4,'column':3},
        {'state_full':'32A','state_postal':'32A','row':4,'column':4},
        {'state_full':'17A','state_postal':'17A','row':5,'column':0},
        {'state_full':'17B','state_postal':'17B','row':5,'column':1},
        {'state_full':'14A','state_postal':'14A','row':5,'column':2},
        {'state_full':'14B','state_postal':'14B','row':5,'column':3},
        {'state_full':'31A','state_postal':'31A','row':5,'column':4},
        {'state_full':'15A','state_postal':'15A','row':6,'column':0},
        {'state_full':'18A','state_postal':'18A','row':6,'column':1},
        {'state_full':'29A','state_postal':'29A','row':6,'column':2},
        {'state_full':'29B','state_postal':'29B','row':6,'column':3},
        {'state_full':'16B','state_postal':'16B','row':7,'column':0},
        {'state_full':'18B','state_postal':'18B','row':7,'column':1},
        {'state_full':'47A','state_postal':'47A','row':7,'column':2},
        {'state_full':'33A','state_postal':'33A','row':7,'column':3},
        {'state_full':'19A','state_postal':'19A','row':8,'column':0},
        {'state_full':'20A','state_postal':'20A','row':8,'column':1},
        {'state_full':'20B','state_postal':'20B','row':8,'column':2},
        {'state_full':'58B','state_postal':'58B','row':8,'column':3},
        {'state_full':'21A','state_postal':'21A','row':8,'column':4},
        {'state_full':'21B','state_postal':'21B','row':8,'column':5},
        {'state_full':'22B','state_postal':'22B','row':9,'column':0},
        {'state_full':'19B','state_postal':'19B','row':9,'column':1},
        {'state_full':'23B','state_postal':'23B','row':9,'column':2},
        {'state_full':'25B','state_postal':'25B','row':9,'column':3},
        {'state_full':'28A','state_postal':'24B','row':9,'column':4},
        {'state_full':'22A','state_postal':'25A','row':9,'column':5},
        {'state_full':'23A','state_postal':'28A','row':9,'column':6},
        {'state_full':'24A','state_postal':'22A','row':10,'column':0},
        {'state_full':'25B','state_postal':'23B','row':10,'column':1},
        {'state_full':'25A','state_postal':'24A','row':10,'column':2},
        {'state_full':'11A','state_postal':'26B','row':10,'column':3},
        {'state_full':'11A','state_postal':'26A','row':10,'column':4},
        {'state_full':'11A','state_postal':'27A','row':10,'column':5},
        {'state_full':'11A','state_postal':'27B','row':10,'column':6},
        {'state_full':'11A','state_postal':'28B','row':10,'column':7}
        ]
};
</script>

<script>
//CARTOGRAPHIC METRO AREA MAP
$(document).ready(function() {
    cartogram2.init();
});

var cartogram2 = {
    margin: {
        top: 70,
        right: 0,
        bottom: 0,
        left: 60
    },

    selector: '#target2',

    init: function() {
        var self = this;

        self.$el = $(self.selector);

        self.width = 500 - self.margin.left - self.margin.right;
        self.height = 350 - self.margin.top - self.margin.bottom;

        self.svg = d3.select(self.selector).append('svg')
            .attr('height', self.height + self.margin.top + self.margin.bottom)
            .attr('width', self.width + self.margin.left + self.margin.right)

        self.state_size = self.width / 12;
        self.state_padding = 2;

        self.map = self.svg.append('g')
            .attr('transform', 'translate(' + self.margin.left + ','
                  + self.margin.top + ')')

        self.drawMap();
    },

    drawMap: function() {
        var self = this;

        var states = self.map.selectAll('.states')
            .data(self.state_pos2)
            .enter().append('g')
            .attr('class', 'state-groups');

        var state = states.append('rect')
            .attr('id', function(d) {
                return d.state_postal;
            })
            .attr('class', 'state')
            .attr('rx', 2)
            .attr('ry', 2)
            .attr('x', function(d) {
                return d.column * (self.state_size + self.state_padding);
            })
            .attr('y', function(d) {
                return d.row * (self.state_size + self.state_padding);
            })
            .attr('width', self.state_size)
            .attr('height', self.state_size);

        var text = states.append('text')
            .attr('class', 'state-label')
            .attr('dominant-baseline', 'central')
            .attr('x', function(d) {
                return (d.column * (self.state_size + self.state_padding))
                        + self.state_size / 2; })
            .attr('y', function(d) {
                return (d.row * (self.state_size + self.state_padding))
                    + self.state_size / 2; })
            .style('text-anchor', 'middle')
            .text(function(d) {
                return d.state_postal;
            });
    },

    state_pos2: [{'state_full':'30A','state_postal':'30A','row':0,'column':2},
        {'state_full':'30B','state_postal':'30B','row':0,'column':3},
        {'state_full':'35A','state_postal':'35A','row':0,'column':4},
        {'state_full':'35B','state_postal':'35B','row':0,'column':5},
        {'state_full':'31B','state_postal':'31B','row':0,'column':6},
        {'state_full':'32B','state_postal':'32B','row':0,'column':7},
        {'state_full':'34A','state_postal':'34A','row':1,'column':1},
        {'state_full':'36A','state_postal':'36A','row':1,'column':2},
        {'state_full':'36B','state_postal':'36B','row':1,'column':3},
        {'state_full':'37A','state_postal':'37A','row':1,'column':4},
        {'state_full':'37B','state_postal':'37B','row':1,'column':5},
        {'state_full':'38A','state_postal':'38A','row':1,'column':6},
        {'state_full':'38B','state_postal':'38B','row':1,'column':7},
        {'state_full':'39A','state_postal':'39A','row':1,'column':8},
        {'state_full':'34B','state_postal':'34B','row':2,'column':1},
        {'state_full':'40A','state_postal':'40A','row':2,'column':2},
        {'state_full':'40B','state_postal':'40B','row':2,'column':3},
        {'state_full':'41A','state_postal':'41A','row':2,'column':4},
        {'state_full':'41B','state_postal':'41B','row':2,'column':5},
        {'state_full':'42A','state_postal':'42A','row':2,'column':6},
        {'state_full':'42B','state_postal':'42B','row':2,'column':7},
        {'state_full':'43A','state_postal':'43A','row':2,'column':8},
        {'state_full':'44A','state_postal':'44A','row':3,'column':0},
        {'state_full':'45A','state_postal':'45A','row':3,'column':1},
        {'state_full':'45B','state_postal':'45B','row':3,'column':2},
        {'state_full':'59A','state_postal':'59A','row':3,'column':3},
        {'state_full':'60A','state_postal':'60A','row':3,'column':4},
        {'state_full':'66A','state_postal':'66A','row':3,'column':5},
        {'state_full':'66B','state_postal':'66B','row':3,'column':6},
        {'state_full':'67A','state_postal':'67A','row':3,'column':7},
        {'state_full':'43B','state_postal':'43B','row':3,'column':8},
        {'state_full':'39B','state_postal':'39B','row':3,'column':9},
        {'state_full':'44B','state_postal':'44B','row':4,'column':1},
        {'state_full':'46A','state_postal':'46A','row':4,'column':2},
        {'state_full':'59B','state_postal':'59B','row':4,'column':3},
        {'state_full':'60B','state_postal':'60B','row':4,'column':4},
        {'state_full':'64A','state_postal':'64A','row':4,'column':5},
        {'state_full':'65A','state_postal':'65A','row':4,'column':6},
        {'state_full':'67B','state_postal':'67B','row':4,'column':7},
        {'state_full':'53A','state_postal':'53A','row':4,'column':8},
        {'state_full':'33B','state_postal':'33B','row':5,'column':1},
        {'state_full':'46B','state_postal':'46B','row':5,'column':2},
        {'state_full':'61A','state_postal':'61A','row':5,'column':3},
        {'state_full':'62A','state_postal':'62A','row':5,'column':4},
        {'state_full':'63A','state_postal':'63A','row':5,'column':5},
        {'state_full':'65B','state_postal':'65B','row':5,'column':6},
        {'state_full':'53B','state_postal':'53B','row':5,'column':7},
        {'state_full':'54B','state_postal':'54B','row':5,'column':8},
        {'state_full':'48A','state_postal':'48A','row':6,'column':1},
        {'state_full':'49A','state_postal':'49A','row':6,'column':2},
        {'state_full':'61B','state_postal':'61B','row':6,'column':3},
        {'state_full':'62B','state_postal':'62B','row':6,'column':4},
        {'state_full':'63B','state_postal':'63B','row':6,'column':5},
        {'state_full':'64B','state_postal':'64B','row':6,'column':6},
        {'state_full':'52A','state_postal':'52A','row':6,'column':7},
        {'state_full':'54A','state_postal':'54A','row':6,'column':8},
        {'state_full':'47B','state_postal':'47B','row':7,'column':1},
        {'state_full':'48B','state_postal':'48B','row':7,'column':2},
        {'state_full':'49B','state_postal':'49B','row':7,'column':3},
        {'state_full':'50A','state_postal':'50A','row':7,'column':4},
        {'state_full':'50B','state_postal':'50B','row':7,'column':5},
        {'state_full':'51A','state_postal':'51A','row':7,'column':6},
        {'state_full':'51B','state_postal':'51B','row':7,'column':7},
        {'state_full':'52B','state_postal':'52B','row':7,'column':8},
        {'state_full':'55A','state_postal':'55A','row':8,'column':2},
        {'state_full':'55B','state_postal':'55B','row':8,'column':3},
        {'state_full':'56A','state_postal':'56A','row':8,'column':4},
        {'state_full':'56B','state_postal':'56B','row':8,'column':5},
        {'state_full':'58A','state_postal':'58A','row':8,'column':6},
        {'state_full':'57A','state_postal':'57A','row':8,'column':7},
        {'state_full':'57B','state_postal':'57B','row':8,'column':8}
        ]
};
</script>

<script>
//MORPHING AND REDRAWING FUNCTION
redrawGraph = function(data1, data2, data3, data4, data5, data6, data7, data8, theline) {

    d3.select('#pie1 svg').datum(data1).transition().duration(500).call(chart0);
    nv.utils.windowResize(chart0.update);
    d3.select('#pie2 svg').datum(data4).transition().duration(500).call(chart01);
    nv.utils.windowResize(chart01.update);
    d3.select('#pie3 svg').datum(data5).transition().duration(500).call(chart02);
    nv.utils.windowResize(chart02.update);
    d3.select('#pie4 svg').datum(data6).transition().duration(500).call(chart03);
    nv.utils.windowResize(chart03.update);
    d3.select('#pie5 svg').datum(data7).transition().duration(500).call(chart04);
    nv.utils.windowResize(chart04.update);
    d3.select('#tracker svg').datum(data2).transition().duration(500).call(chart1);
    nv.utils.windowResize(chart1.update);
    d3.select('#tracker2 svg').datum(data3).transition().duration(500).call(chart2);
    nv.utils.windowResize(chart2.update);
    d3.select('#tracker3 svg').datum(data8).transition().duration(500).call(chart3);
    nv.utils.windowResize(chart3.update);

  var d1Text= [
   'DFL',
   'Mark Dayton',
   'Al Franken'
  ];

  $("#can1").text(d1Text[theline]);

  var d2Text= [
   "GOP",
   "Jeff Johnson",
   "Mike McFadden"
  ];

  $("#demo2").text(d2Text[theline]);

  var d3Text= [
   "Independent",
   " ",
   "Rest of State",
   " ",
   "50-64"
  ];

  var voteCountText = [
   "1,000,000",
   "2,000,000",
   "3,000,000"
  ];

  $("#voteCount1").text(voteCountText[theline]);

  var voteCount2Text = [
   "1,000,000",
   "2,000,000",
   "4,000,000"
  ];

  $("#voteCount2").text(voteCount2Text[theline]);

};
</script>

<script>
//LIVE DATA AND COLORATION FUNCTIONS
$(document).ready(function(){
 $("#AZ").css("fill","#c0bfeb");
 $("#AR").css("fill","#c0bfeb");
 $("#CA").css("fill","#c0bfeb"); 
 $("#CO").css("fill","#c0bfeb");
 $("#CT").css("fill","#c0bfeb");
 $("#DE").css("fill","#c0bfeb");
 $("#HI").css("fill","#c0bfeb");
 $("#ME").css("fill","#c0bfeb");
 $("#MI").css("fill","#c0bfeb");
 $("#MN").css("fill","#c0bfeb");
 $("#MT").css("fill","#c0bfeb");
 $("#NH").css("fill","#c0bfeb");
 $("#NM").css("fill","#c0bfeb");
 $("#RI").css("fill","#c0bfeb");
 $("#TX").css("fill","#c0bfeb");
 $("#VA").css("fill","#c0bfeb");
 $("#WI").css("fill","#c0bfeb");
 $("#WY").css("fill","#c0bfeb");
if($("input[id='state1']:checked").val()){
 $("#AZ").css("fill","#c0bfeb");
 $("#AR").css("fill","#c0bfeb");
 $("#CA").css("fill","#c0bfeb"); 
 $("#CO").css("fill","#c0bfeb");
 $("#CT").css("fill","#c0bfeb");
 $("#DE").css("fill","#c0bfeb");
 $("#HI").css("fill","#c0bfeb");
 $("#ME").css("fill","#c0bfeb");
 $("#MI").css("fill","#c0bfeb");
 $("#MN").css("fill","#c0bfeb");
 $("#MT").css("fill","#c0bfeb");
 $("#NH").css("fill","#c0bfeb");
 $("#NM").css("fill","#c0bfeb");
 $("#RI").css("fill","#c0bfeb");
 $("#TX").css("fill","#c0bfeb");
 $("#VA").css("fill","#c0bfeb");
 $("#WI").css("fill","#c0bfeb");
 $("#WY").css("fill","#c0bfeb");
 }else if($("input:radio[id=state2]").is(":checked")){
     $("#MN").css("fill","#ddd");
 }

});

</script>