<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Battleground 2016</title>
  <meta name="description" content="Midwestern Region Economic Mobility">
  <meta name="author" content="Frey Hargarten - StarTribune">

  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  <link rel="stylesheet" href="../_common_resources/interfaces/d3.slider-master/d3.slider.css" />
  <link href="../_common_resources/charts/c3-master/c3.css" rel="stylesheet" type="text/css">
  
  <style>
    /* PAGE BASE */
    body { font-family:"Benton Sans",Helvetica,Arial,sans-serif !important; overflow-x:hidden !important; }
    p { font-family:"Benton Sans",Helvetica,Arial,sans-serif !important; }
    a { color:#000; }
    #wrapper { text-align:center; height:auto; width:920px; margin-left:auto; margin-right:auto; }
    
    /* SWITCHES AND BUTTONS */
    #bottomSwitches { text-align:center; margin-left:auto; margin-right:auto; width:100%; }
    #viewSwitches { display:inline-block; border-right:1px solid #ddd; }
    .switch { padding:10px; display:inline-block; text-align:center; width:24.5%; background-color:#fff; font-weight:900; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border:1px solid black; }
    .switch:hover, .selected2, .mapSwitch:hover, .typeSwitch:hover, .layerSwitch:hover, .raceSwitch:hover { opacity:1 !important; cursor:pointer; background-color:#fff !important; color:#000 !important; }
    .typeSwitch, .layerSwitch, .stateSwitch { width:60px; display:inline-block; opacity:.4; margin:5px; }
    .switch img { width:40px; }
    .mapSwitch img, .typeSwitch img, .layerSwitch img, .stateSwitch img { width:100%; }
    #raceSwitcher { margin-bottom:10px; }
    .raceSwitch { width:13.8%; display:inline-block; opacity:.5; }

     /* PANES */
    .dataviz { width:100%;  }
    #rightSide { width:100%; font-size:.8em; }
    #infobox { width:60%; margin-right:auto; margin-left:auto; }

     /* MAPS */
    .map, .carto { width:800px; margin-right:auto; margin-left:auto; text-align:center;  }
    
    rect:hover, text:hover { background-color:#333 !important; cursor:pointer; opacity:.5; }
    #mnhouse .map, #mnhouse .carto, #mnsenate .map, #mnsenate .carto, #mnhouse .map svg, #mnhouse .carto svg, #mnsenate .map svg, #mnsenate .carto svg { display:inline-block; width:320px !important; height:350px !important; }
    .carto, #mnhouse .carto, #mnsenate .carto  { display:none; }

     /* RESET BUTTON */
    .zoom { float:none !important; text-align:center; }

    /* POWER BAR */
    #partyLabels, #partyBar, #partyCount { width:100%; }
    .bar, .count, .label { display:inline-block; }
    .label, .count { width:24%; }
    .bar { width:0; height:15px; border:0.5px solid #fff; }
    .bar:hover { background-color:#333; cursor:pointer; }
    .gopLabel, .gopCount, .gopVotes { text-align:right !important; }
    .demsLabel, .demsCount, .demsVotes { text-align:left !important; }
    #demsBar { background-color:#0D4773; }
    #gopBar { background-color:#9C0004; }
    #undBar { background-color:#ddd; }
    #indBar { background-color:#E07242; }
    #indLabel, #undLabel, #indCount, #undCount { text-align:center; }
    .check { width:20px; height:20px; }
    .demWin { float:left; }
    .gopWin { float:right; }

    /* COLOR SWATCHES */
    .republican { fill:#8C1B17 !important; pointer-events: all; font-weight:bold; color:#8C1B17; stroke:#8C1B17 !important; }
    .rlikely { color:#A5484D; fill:#A5484D !important; pointer-events: all; font-weight:bold; }
    .rlean { color:#C68985; fill:#C68985 !important; pointer-events: all; font-weight:bold; }
    .democrat { fill:#3F88C5 !important; pointer-events: all; font-weight:bold; color:#3F88C5; stroke:#3F88C5 !important; }
    .dlikely { color:#5ca5c3; fill:#5ca5c3 !important; pointer-events: all; font-weight:bold; }
    .dlean { color:#ABCEE8; fill:#ABCEE8 !important; pointer-events: all; font-weight:bold; }
    .r1 { background-color:#C68985; fill:#C68985 !important; color:black !important; pointer-events: all; font-weight:bold; }
    .r2 { background-color:#A5484D; fill:#A5484D !important; color:white !important; pointer-events: all; font-weight:bold; }
    .r3 { background-color:#A52129; fill:#A52129 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .r4 { background-color:#8C1B17; fill:#8C1B17 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .r0 { background-color:#8C1B17; fill:#8C1B17 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .mid { background-color:#fff !important; fill:#ddd !important; color:#bbb !important; pointer-events: all; font-weight:bold; }
    .gray3 { color:black !important; }
    .d1 { background-color:#ABCEE8; fill:#ABCEE8 !important; color:black !important; pointer-events: all; font-weight:bold; }
    .d2 { background-color:#5ca5c3; fill:#5ca5c3 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .d3 { background-color:#4f97c4; fill:#4f97c4 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .d4 { background-color:#3f88c5; fill:#3f88c5 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .d0 { background-color:#3F88C5; fill:#3F88C5 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .independent { fill:#66AF50; background-color:#66AF50; color:#333 !important; }
    .none { fill:#ddd !important; }
    path { stroke-opacity:0 !important; }

    /* LEGENDS */
    .legends { width:570px; height:auto; text-align:center; margin-right:auto; margin-left:auto; }
    small { font-family:"Benton Sans",Helvetica,Arial,sans-serif; color:#808080; clear:both; display:block; }
    .legend label, .legend span { display:block; float:left; height:15px; width:47px; text-align:center; font-size:12px; color:#808080; font-family:"Benton Sans",Helvetica,Arial,sans-serif; }

    /* TABLES */
    #table { height:604px; }
    #chamber { width:450px; height:275px; margin-right:auto; margin-left:auto; text-align:center; display:none; }
    .column { width:48%; display:inline-block; vertical-align:top; }
    .counter div { width:48%; display:inline-block; }
    .tableHead { display:inline-block; padding:10px; border-bottom:1px solid #ddd; width:24%; font-weight:900; font-family:"Poynter Serif RE"; }
    .tableCell { display:inline-block; padding:10px; border-bottom:1px solid #ddd; width:24%; font-family:"Benton Sans"; }
    .tableBreak { clear:both; display:block; }
    .table { text-align:center; width:100%; overflow-x:hidden; overflow-y:auto; height:auto; }
    #filter input { border-radius:0 !important; }
    .chamberLabel { width:100%; display:block !important; text-align:center !important; margin-left:auto; margin-right:auto;  padding:7px; font-weight:900; }
    .district { display:inline-block; }
    .box { width:60px; height:40px; padding:3px; border:1px solid #000; vertical-align:middle; margin:2px; font-size:.7em; }
    .box:hover { background-color:#333; cursor:pointer; }

    /* HISTORICAL DATA */
    #historyview { width:540px; margin-left:auto; margin-right:auto; }
    .mapThumb { width:300px; margin-right:auto; margin-left:auto; }
    .mapThumb img { width:100%; }
    .chartTitle { text-align:center; }
    .turnout { text-align:center; }
    .d_history { float:left; }
    .r_history { float:right; }
    .historyBox { width:65%; margin-left:auto; margin-right:auto; padding:15px; }
    .smallbreak { clear:both; }

    /* INFOBOXES */
    .districtName { font-weight:900; font-size:1.2em; }
    .name { font-weight:900 !important; }
    .statRow { width:100%; }
    .cell { display:inline-block; text-align:center; }
    .statNum { padding:7px; font-size:1.2em; font-weight:400; }
    .statNum:hover { cursor:pointer; background-color:#333; color:#fff; }
    .raceRow .cell { width:50%; }
    .femaleRow .cell, .maleRow .cell, .schoolRow .cell { width:25%; }
    .incomeRow .cell { width:100%; }
    .stats .label { font-size:.5em; font-family:"Benton Sans",Helvetica,Arial,sans-serif; text-align:center; width:66% !important; }
    .pct path { stroke-width:.02px !important; }
    h2 { text-align:center; padding:10px; }
    .candidate { float:left; width:48%; }
    .pct { float:right; width:48%; }
    .tooltip { width:150px; }
    .resultsRow div { display:inline-block; width:24%; text-align:left; }
    .resultsRow { clear:both; }
    .resultsHead { font-weight:bold; }
    .reportingRow { margin-top:5px; float:right; color:#aaa; font-size:0.8em; }
    .tableRow { clear:both; text-align:left !important; margin:10px; }

    /* BREAKPOINTS */
     @media (max-width:920px) {
      #wrapper { width:100%; }
      .map { width:100%; }
      .carto { width:100%; }
      .raceSwitch { width:23%; }
      #rightSide, .dataviz { width:100%; float:none; }
      #historyview { width:100%; margin-left:auto; margin-right:auto; }
      #viewSwitches { display:block; border-right:0; }
     }
  </style>
</head>

<body>
  <div id="wrapper">

<!-- RACE SWITCHING BAR -->
<div id="raceSwitcher">
  <div class="raceSwitch" data="president"><a href="./?race=president"><img src="img/whitehouse.png" width="60px" /><div>Presidential</div></a></div>
  <div class="raceSwitch" data="mnhouse"><a href="./?race=mnhouse"><img src="img/mnleg_icon.png" width="60px" /><div>MN House</div></a></div>
  <div class="raceSwitch" data="mnsenate"><a href="./?race=mnsenate"><img src="img/mnleg_icon.png" width="60px" /><div>MN Senate</div></a></div>
  <div class="raceSwitch" data="local"><a href="./?race=local"><img src="img/local.png" width="60px" /><div>Local Races</div></a></div>
  <div class="raceSwitch" data="house"><a href="./?race=house"><img src="img/house.png" width="60px" /><div>U.S. House</div></a></div>
  <div class="raceSwitch" data="senate"><a href="./?race=senate"><img src="img/house.png" width="60px" /><div>U.S. Senate</div></a></div>
  <div class="raceSwitch" data="governors"><a href="./?race=governors"><img src="img/ballot.png" width="60px" /><div>Governors</div></a></div>
</div>

<!-- POWER BALANCE BAR -->
<div class="bars" id="powerbar">
<div id="partyLabels">
  <div class="label dparty demsLabel">DEM <span id="dMark" class="check"></span></div>
  <div class="label undLabel"></div>
  <div class="label indLabel"></div>
  <div class="label rparty gopLabel"><span id="rMark" class="check"></span> GOP</div>
</div>
<div id="partyBar">
  <div class="bar" id="AL" data="Alabama"></div>
  <div class="bar" id="AK" data="Alaska"></div>
  <div class="bar" id="AZ" data="Arizona"></div>
  <div class="bar" id="AR" data="Arkansas"></div>
  <div class="bar" id="CA" data="California"></div>
  <div class="bar" id="CO" data="Colorado"></div>
  <div class="bar" id="CT" data="Connecticut"></div>
  <div class="bar" id="DC" data="District_of_Columbia"></div>
  <div class="bar" id="DE" data="Delaware"></div>
  <div class="bar" id="FL" data="Florida"></div>
  <div class="bar" id="GA" data="Georgia"></div>
  <div class="bar" id="HI" data="Hawaii"></div>
  <div class="bar" id="ID" data="Idaho"></div>
  <div class="bar" id="IL" data="Illinois"></div>
  <div class="bar" id="IA" data="Iowa"></div>
  <div class="bar" id="IN" data="Indiana"></div>
  <div class="bar" id="KS" data="Kansas"></div>
  <div class="bar" id="KY" data="Kentucky"></div>
  <div class="bar" id="LA" data="Louisiana"></div>
  <div class="bar" id="ME" data="Maine"></div>
  <div class="bar" id="MD" data="Maryland"></div>
  <div class="bar" id="MA" data="Massachusetts"></div>
  <div class="bar" id="MI" data="Michigan"></div>
  <div class="bar" id="MN" data="Minnesota"></div>
  <div class="bar" id="MS" data="Mississippi"></div>
  <div class="bar" id="MO" data="Missouri"></div>
  <div class="bar" id="MT" data="Montana"></div>
  <div class="bar" id="NE" data="Nebraska"></div>
  <div class="bar" id="NV" data="Nevada"></div>
  <div class="bar" id="NH" data="New_Hampshire"></div>
  <div class="bar" id="NJ" data="New_Jersey"></div>
  <div class="bar" id="NM" data="New_Mexico"></div>
  <div class="bar" id="NY" data="New_York"></div>
  <div class="bar" id="NC" data="North_Carolina"></div>
  <div class="bar" id="ND" data="North_Dakota"></div>
  <div class="bar" id="OH" data="Ohio"></div>
  <div class="bar" id="OK" data="Oklahoma"></div>
  <div class="bar" id="OR" data="Oregon"></div>
  <div class="bar" id="PA" data="Pennsylvania"></div>
  <div class="bar" id="RI" data="Rhode_Island"></div>
  <div class="bar" id="SC" data="South_Carolina"></div>
  <div class="bar" id="SD" data="South_Dakota"></div>
  <div class="bar" id="TN" data="Tennessee"></div>
  <div class="bar" id="TX" data="Texas"></div>
  <div class="bar" id="UT" data="Utah"></div>
  <div class="bar" id="VT" data="Vermont"></div>
  <div class="bar" id="VA" data="Virginia"></div>
  <div class="bar" id="WA" data="Washington"></div>
  <div class="bar" id="WV" data="West_Virginia"></div>
  <div class="bar" id="WI" data="Wisconsin"></div>
  <div class="bar" id="WY" data="Wyoming"></div>
</div>
<div class="breaker"></div>
<div id="partyCount">
  <div class="count demsCount">0</div>
  <div class="count undCount"></div>
  <div class="count indCount"></div>
  <div class="count gopCount">0</div>
</div>
<div id="partyvotes">
  <div class="count demsVotes">0</div>
  <div class="count undVotes"></div>
  <div class="count indVotes"></div>
  <div class="count gopVotes">0</div>
</div>
<div id="barLabel">Electoral Votes</div>
</div>

<!-- DATAVIZ PANES -->

<!-- PRESIDENT PANES -->
<div id="president" class="dataviz">
<!-- MAPS -->
<div class="mapBox">
<div id="map" class="map geo"><svg id="USMAP" width="800" height="600" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid"></svg></div>
<div id="carto" class="map normal carto"><svg width="800" height="600" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid"></svg></div>
</div>
<div class="table" id="table" style="display:none;"><div class="filter"><input type="search" class="filter_box" placeholder="Search races"></input></div></div>
</div>

<!-- MNHOUSE PANES -->
<div id="mnhouse" class="dataviz">
<div class="mapBox">
      <div class="mapState map geo"><svg id="MNHOUSE" width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
      <div class="mapMetro map geo"><svg id="MNHOUSEMETRO" width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
      <div class="cartoState map normal carto"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
      <div class="cartoMetro map normal carto"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
</div>
<div class="table" id="table" style="display:none;"><div class="filter"><input type="search" class="filter_box" placeholder="Search races"></input></div></div>
</div>

<!-- MNSENATE PANES -->
<div id="mnsenate" class="dataviz">
<div class="mapBox">
      <div class="mapState map geo"><svg id="MNSENATE" width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
      <div class="mapMetro map geo"><svg id="MNSENATEMETRO" width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
      <div class="cartoState map normal carto"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
      <div class="cartoMetro map normal carto"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
</div>
<div class="table" id="table" style="display:none;"><div class="filter"><input type="search" class="filter_box" placeholder="Search races"></input></div></div>
</div>

<!-- LOCAL PANES -->
<div id="local" class="dataviz">
<div id="map" class="map geo"><svg width="800" height="600" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid"></svg></div>
<div id="carto" class="map normal carto"><svg width="800" height="600" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid"></svg></div>
</div>
<div class="table" id="table" style="display:none;"><div class="filter"><input type="search" class="filter_box" placeholder="Search races"></input></div></div>
</div>

<!-- HOUSE PANES -->
<div id="house" class="dataviz">
<div id="map" class="map geo"><svg id="USHOUSE" width="800" height="600" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid"></svg></div>
<div id="carto" class="map normal carto"><svg width="800" height="600" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid"></svg></div>
<div class="table" id="table" style="display:none;"><div class="filter"><input type="search" class="filter_box" placeholder="Search races"></input></div></div>
</div>

<!-- SENATE PANES -->
<div id="senate" class="dataviz">
<div id="map" class="map geo"><svg id="USSENATE" width="800" height="600" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid"></svg></div>
<div id="carto" class="map normal carto"><svg width="800" height="600" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid"></svg></div>
<div class="table" id="table" style="display:none;"><div class="filter"><input type="search" class="filter_box" placeholder="Search races"></input></div></div>
</div>

<!-- GOVERNORS PANES -->
<div id="governors" class="dataviz">
<div id="map" class="map geo"><svg id="USGOV" width="800" height="600" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid"></svg></div>
<div id="carto" class="map normal carto"><svg width="800" height="600" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid"></svg></div>
<div class="table" id="table" style="display:none;"><div class="filter"><input type="search" class="filter_box" placeholder="Search races"></input></div></div>
</div>
<!-- END DATAVIZ PANES -->

<!-- DETAILS PANE-->
<div id="rightSide">

<!-- COLOR SCALE LEGENDS -->
<div class="legendBox">
<div class="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>DEM</span>
          <span class='d1'></span>
          <span class='d2'></span>
          <span class='d3'></span>
          <span class='d4'></span>
        </nav>
      </span>
    </div>
    <small></small>
  </div>
</div>
<div class="legendBox">
<div class="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>GOP</span>
          <span class='r1'></span>
          <span class='r2'></span>
          <span class='r3'></span>
          <span class='r4'></span>
        </nav>
      </span>
    </div>
    <small></small>
  </div>
</div>
<div class="legendBox">
<div class="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>IND</span>
          <span class='independent'></span>
        </nav>
      </span>
    </div>
    <small></small>
  </div>
</div>
<div class="legendBox">
<div class="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>UND</span>
          <span class='mid'></span>
        </nav>
      </span>
    </div>
    <small></small>
  </div>
</div>

<div class="breaker"></div>

<!-- INFOBOX -->
<div id="infobox"></div>

<div class="breaker"></div>

<!-- RESET BUTTON -->
<div class="zoom">Reset View</div>

</div>
<!-- end rightSide -->

<div class="breaker"></div>

<!-- MAP VIEW TOGGLES -->
<div id="bottomSwitches">
<div id="viewSwitches">
<div class="toggle uszoom stateSwitch selected2" data="geo"><img src="img/map.png" /><p>US</p></div>
<div class="toggle mnzoom stateSwitch" data="geo"><img src="img/mnview.png" /><p>MN</p></div>
<div class="toggle metrozoom stateSwitch" data="geo"><img src="img/metroview.png" /><p>Metro</p></div>
</div>

<div class="toggle layerSwitch selected2" data="country"><img src="img/states.png" /><p>States</p></div>
<div class="toggle layerSwitch" data="counties"><img src="img/counties.png" /><p>County</p></div>
<div class="toggle typeSwitch cartoSwitch" data="carto"><img src="img/carto.png" /><p>Carto</p></div>
<!-- <div class="toggle layerSwitch" data="cd"><img src="img/ushouse_2014.png" /><p>CD</p></div> -->
<div class="toggle layerSwitch" data="pct" id="pctzoom" style="display:none;"><img src="img/pct.png" /><p>Precinct</p></div>
<div class="toggle uszoom stateSwitch" data="geo" id="tableView"><img src="img/tableview.png" /><p>Table</p></div>
</div> 
<!-- end bottomSwitches -->

</div>
<!-- end wrapper -->

<div id="dump" style="display:none;"></div>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="../_common_resources/interfaces/d3.slider-master/d3.slider.js"></script>
<script src="../_common_resources/charts/c3-master/c3.min.js"></script>
<!-- <script src="./js/require.js"></script>
<script src="./js/node_modules/ballot-tally/index.js"></script> -->
<script src="//d3js.org/topojson.v1.min.js"></script>

<script>
//president: cities = https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=P&raceTypeID=G&level=RU
//president = states https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=P&raceTypeID=G

</script>
<script>

</script>

<script>
//PARAMETERS = ?race=mncaucusd&date=2016-03-01 - ?tab=map&race=president&year=2012&geo=us&district=country
//https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&statePostal=MN&officeID=P&raceTypeID=G&level=RU

// $.urlParam = function(name){
//   var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
//   return results[1] || 0;
// }

// var race = $.urlParam('race');
// var year = $.urlParam('year');
// var tab = $.urlParam('tab');
// var geo = $.urlParam('geo');
// var district = $.urlParam('district');

// var apiStringUS = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=P&raceTypeID=G";
// var apiStringCounty = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=P&raceTypeID=G&level=RU";

// var apiStringSenate = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=S&raceTypeID=G&level=RU";
// var apiStringGov = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=G&raceTypeID=G&level=RU";

// var apiStringHouse = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=H&raceTypeID=G&level=RU";
// var apiStringMNH = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&statePostal=MN&officeID=Y&raceTypeID=G";
// var apiStringMNS = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&statePostal=MN&officeID=Z&raceTypeID=G";

var apiStringCounty = "data/prezCounty.json";

var apiStringSenate = "data/senate.json";
var apiStringGov = "data/gov.json";

var apiStringHouse = "data/house.json";
var apiStringMNH = "data/mnhouse.json";
var apiStringMNS = "data/mnsenate.json";

// var apiString = "./data/" + year + "_" + race + "_" + district + "_" + geo +".json"

// d3.json(apiStringUS, function(error, jsonUS) {
d3.json(apiStringCounty, function(error, jsonCounty) {
d3.json(apiStringSenate, function(error, jsonSenate) {
d3.json(apiStringHouse, function(error, jsonHouse) {
d3.json(apiStringGov, function(error, jsonGov) {
d3.json(apiStringMNH, function(error, jsonMNH) {
d3.json(apiStringMNS, function(error, jsonMNS) {

// var dataUS = jsonUS;
var dataCounty = jsonCounty;

var dataSenate = jsonSenate;
var dataHouse = jsonHouse;
var dataGov = jsonGov;

var dataMNH = jsonMNH;
var dataMNS = jsonMNS;

//data fetching function
function fetchData(district,state,type,dataCompare,race,ev,label){

  //base: officeName
  //.reportingUnits[i]: .reportingunitName, statePostal, stateName, precinctsReporting, precinctsTotal, precinctsReportingPct, lastUpdated, level, fipsCode
  //.reportingUnits[i].candidates[k]: first, last, party, voteCount, winner, incumbent

//USHOUSE, MNHOUSE, MNSENATE SPECIFIC
  //base: seatName, seatNum

var stateName = '';
var statePostal = '';
var precinctsReporting = 0;
var precinctsTotal = 0;
var precinctsReportingPct = 0;
var lastUpdated = 0;

var fipsCode = '';
var seatName = '';
var seatNum = '';

var firstR = '';
var lastR = '';
var partyR = '';
var incumbentR = false;
var voteCountR = 0;
var winnerR = '';
var pctR = 0;

var firstD = '';
var lastD = '';
var partyD = '';
var incumbentD = false;
var voteCountD = 0;
var winnerD = '';
var pctD = 0;

var voteCountO = 0;
var pctO = 0;

var voteCountT = 0;


  for (var i=0; i < dataCompare.races.length; i++) {
   if (race == "ushouse" || race == "mnhouse" || race == "mnsenate"){
      if (dataCompare.races[i].seatName == district) {
     for (var j=0; j < dataCompare.races[i].reportingUnits.length; j++) {
         if (dataCompare.races[i].reportingUnits[j].stateName == state){
              stateName = dataCompare.races[i].reportingUnits[j].stateName;
              statePostal = dataCompare.races[i].reportingUnits[j].statePostal;
              precinctsReporting = dataCompare.races[i].reportingUnits[j].precinctsReporting;
              precinctsTotal = dataCompare.races[i].reportingUnits[j].precinctsTotal;
              precinctsReportingPct = dataCompare.races[i].reportingUnits[j].precinctsReportingPct;
              lastUpdated = dataCompare.races[i].reportingUnits[j].lastUpdated;

           for (var k=0; k < dataCompare.races[i].reportingUnits[j].candidates.length; k++) {
              if (dataCompare.races[i].reportingUnits[j].candidates[k].party == "GOP") {
                firstR = dataCompare.races[i].reportingUnits[j].candidates[k].first;
                lastR = dataCompare.races[i].reportingUnits[j].candidates[k].last;
                partyR = dataCompare.races[i].reportingUnits[j].candidates[k].party;
                incumbentR = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
                voteCountR = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
                winnerR = dataCompare.races[i].reportingUnits[j].candidates[k].winner;
              } else if (dataCompare.races[i].reportingUnits[j].candidates[k].party == "Dem") {
                firstD = dataCompare.races[i].reportingUnits[j].candidates[k].first;
                lastD = dataCompare.races[i].reportingUnits[j].candidates[k].last;
                partyD = dataCompare.races[i].reportingUnits[j].candidates[k].party;
                incumbentD = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
                voteCountD = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
                winnerD = dataCompare.races[i].reportingUnits[j].candidates[k].winner;
              } else {
                voteCountO += dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
              }
           } //end k loop
         } //end if
     } //end j loop
    } //end if
     
   } else {
     for (var j=0; j < dataCompare.races[i].reportingUnits.length; j++) {
       if (state != null){
         if (dataCompare.races[i].reportingUnits[j].stateName == state){
              stateName = dataCompare.races[i].reportingUnits[j].stateName;
              statePostal = dataCompare.races[i].reportingUnits[j].statePostal;
              precinctsReporting = dataCompare.races[i].reportingUnits[j].precinctsReporting;
              precinctsTotal = dataCompare.races[i].reportingUnits[j].precinctsTotal;
              precinctsReportingPct = dataCompare.races[i].reportingUnits[j].precinctsReportingPct;
              lastUpdated = dataCompare.races[i].reportingUnits[j].lastUpdated;

           for (var k=0; k < dataCompare.races[i].reportingUnits[j].candidates.length; k++) { 
              if (dataCompare.races[i].reportingUnits[j].candidates[k].party == "GOP") {
                firstR = dataCompare.races[i].reportingUnits[j].candidates[k].first;
                lastR = dataCompare.races[i].reportingUnits[j].candidates[k].last;
                partyR = dataCompare.races[i].reportingUnits[j].candidates[k].party;
                incumbentR = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
                voteCountR = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
                winnerR = dataCompare.races[i].reportingUnits[j].candidates[k].winner;
              } else if (dataCompare.races[i].reportingUnits[j].candidates[k].party == "Dem") {
                firstD = dataCompare.races[i].reportingUnits[j].candidates[k].first;
                lastD = dataCompare.races[i].reportingUnits[j].candidates[k].last;
                partyD = dataCompare.races[i].reportingUnits[j].candidates[k].party;
                incumbentD = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
                voteCountD = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
                winnerD = dataCompare.races[i].reportingUnits[j].candidates[k].winner;
              } else {
                voteCountO += dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
              }
           } //end k loop
         }
      } else {
         if (dataCompare.races[i].reportingUnits[j].fipsCode == district){
              stateName = dataCompare.races[i].reportingUnits[j].stateName;
              statePostal = dataCompare.races[i].reportingUnits[j].statePostal;
              precinctsReporting = dataCompare.races[i].reportingUnits[j].precinctsReporting;
              precinctsTotal = dataCompare.races[i].reportingUnits[j].precinctsTotal;
              precinctsReportingPct = dataCompare.races[i].reportingUnits[j].precinctsReportingPct;
              lastUpdated = dataCompare.races[i].reportingUnits[j].lastUpdated;

           for (var k=0; k < dataCompare.races[i].reportingUnits[j].candidates.length; k++) { 
              if (dataCompare.races[i].reportingUnits[j].candidates[k].party == "GOP") {
                firstR = dataCompare.races[i].reportingUnits[j].candidates[k].first;
                lastR = dataCompare.races[i].reportingUnits[j].candidates[k].last;
                partyR = dataCompare.races[i].reportingUnits[j].candidates[k].party;
                incumbentR = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
                voteCountR = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
                winnerR = dataCompare.races[i].reportingUnits[j].candidates[k].winner;
              } else if (dataCompare.races[i].reportingUnits[j].candidates[k].party == "Dem") {
                firstD = dataCompare.races[i].reportingUnits[j].candidates[k].first;
                lastD = dataCompare.races[i].reportingUnits[j].candidates[k].last;
                partyD = dataCompare.races[i].reportingUnits[j].candidates[k].party;
                incumbentD = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
                voteCountD = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
                winnerD = dataCompare.races[i].reportingUnits[j].candidates[k].winner;
              } else {
                voteCountO += dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
              }
           } //end k loop
         }
      }
     } //end j loop
   }
   } //end i loop

   voteCountT = voteCountR + voteCountD + voteCountO;
   pctR = voteCountR / voteCountT;
   pctD = voteCountD / voteCountT;
   pctO = voteCountO / voteCountT;

  var evString = "";
  var stateString = state;

  if (ev != null) { evString = "<span class='ev'> - " + ev + " electoral votes</span>"; }
  if (label != null) { stateString = label; } else { stateString = state; }

  if (type == "tooltip"){
      if (pctR >= .80) { var colorR = "r4"; } 
      else if (pctR >= .70) { var colorR = "r3"; } 
      else if (pctR >= .60) { var colorR = "r2"; } 
      else if (pctR >= 0) { var colorR = "r1"; } 
      if (pctD >= .80) { var colorD = "d4"; }
      else if (pctD >= .70) { var colorD = "d3"; } 
      else if (pctD >= .60) { var colorD = "d2"; } 
      else if (pctD >= 0) { var colorD = "d1"; } 

    if (pctR > pctD) { return "<div class='districtName'>" + stateString + "</div><div class='candidate'>" + lastR + "</div><div class='pct " + colorR + "'>" + d3.format("%")(pctR) + "</div><div class='smallbreak'></div><div class='candidate'>" + lastD + "</div><div class='pct " + colorD + "'>" + d3.format("%")(pctD) + "</div>"; }
    else { return "<div class='districtName'>" + stateString + "</div><div class='candidate'>" + lastD + "</div><div class='pct " + colorD + "'>" + d3.format("%")(pctD) + "</div><div class='smallbreak'></div><div class='candidate'>" + lastR + "</div><div class='pct " + colorR + "'>" + d3.format("%")(pctR) + "</div>"; }
  } //end tooltip

  // if (type == "colors"){
  //   if (pctR > pctD) { 
  //     if (pctR >= .80) { return "r4"; } 
  //     else if (pctR >= .70) { return "r3"; } 
  //     else if (pctR >= .60) { return "r2"; } 
  //     else if (pctR >= 0) { return "r1"; } 
  //   }
  //   else if (pctD > pctR) { 
  //     if (pctD >= .80) { return "d4"; } 
  //     else if (pctD >= .70) { return "d3"; } 
  //     else if (pctD >= .60) { return "d2"; } 
  //     else if (pctD >= 0) { return "d1"; } 
  //   }
  //   else  { return 'mid'; }
  // } //end colors

  if (type == "colors"){
    if (pctR > pctD) { 
      if (pctR >= .80) { return "#8C1B17"; } 
      else if (pctR >= .70) { return "#A52129"; } 
      else if (pctR >= .60) { return "#A5484D"; } 
      else if (pctR >= 0) { return "#C68985"; } 
    }
    else if (pctD > pctR) { 
      if (pctD >= .80) { return "#3f88c5"; } 
      else if (pctD >= .70) { return "#4f97c4"; } 
      else if (pctD >= .60) { return "#5ca5c3"; } 
      else if (pctD >= 0) { return "#ABCEE8"; } 
    }
    else  { return 'mid'; }
  } //end colors


  if (type == "winner"){
    if (winnerD == "X") { return "DEM Win"; }
    else if (winnerR == "X") { return "GOP Win"; }
    else if (pctD > pctR) { return "DEM Lean"; }
    else if (pctR > pctD) { return "GOP Lean"; }
  }

  if (type == "votesR"){
    return voteCountR;
  }

  if (type == "votesD"){
    return voteCountD;
  }

  if (type == "table"){
      if (pctR >= .80) { var colorR = "r4"; } 
      else if (pctR >= .70) { var colorR = "r3"; } 
      else if (pctR >= .60) { var colorR = "r2"; } 
      else if (pctR >= 0) { var colorR = "r1"; } 
      if (pctD >= .80) { var colorD = "d4"; } 
      else if (pctD >= .70) { var colorD = "d3"; } 
      else if (pctD >= .60) { var colorD = "d2"; } 
      else if (pctD >= 0) { var colorD = "d1"; }

    if (pctR > pctD) { return "<div class='districtName'>" + stateString + " " + evString + "</div><div class='resultsRow'><div>Candidate</div><div class='counts'>#</div><div class='pct'>%</div></div><div class='resultsRow'><div class='candidate'>" + firstR + " " + lastR + "</div><div class='counts'>" + d3.format(",")(voteCountR) + "</div><div class='pct " + colorR + "'>" + d3.format("%")(pctR) + "</div></div><div class='resultsRow'><div class='candidate'>" + firstD + " " + lastD + "</div><div class='counts'>" + d3.format(",")(voteCountD) + "</div><div class='pct " + colorD + "'>" + d3.format("%")(pctD) + "</div></div><div class='resultsRow'><div class='candidate'>Other</div><div class='counts'>" + d3.format(",")(voteCountO) + "</div><div class='pct independent'>" + d3.format("%")(pctO) + "</div></div><div class='reportingRow'><span class='pctReported'>" + precinctsReporting + "</span> / <span class='pctAll'>" + precinctsTotal + "</span> (" + precinctsReportingPct + "%) precincts reporting</div>"; }
    else { return "<div class='districtName'>" + stateString +  " " + evString + "</div><div class='resultsRow'><div>Candidate</div><div class='counts'>#</div><div class='pct'>%</div></div><div class='resultsRow'><div class='candidate'>" + firstD + " " + lastD + "</div><div class='counts'>" + d3.format(",")(voteCountD) + "</div><div class='pct " + colorD + "'>" + d3.format("%")(pctD) + "</div></div><div class='resultsRow'><div class='candidate'>" + firstR + " " + lastR + "</div><div class='counts'>" + d3.format(",")(voteCountR) + "</div><div class='pct " + colorR + "'>" + d3.format("%")(pctR) + "</div></div><div class='resultsRow'><div class='candidate'>Other</div><div class='counts'>" + d3.format(",")(voteCountO) + "</div><div class='pct independent'>" + d3.format("%")(pctO) + "</div></div><div class='reportingRow'><span class='pctReported'>" + precinctsReporting + "</span> / <span class='pctAll'>" + precinctsTotal + "</span> (" + precinctsReportingPct + "%) precincts reporting</div>"; }
  } //end table

}//end fetchData

// console.log(fetchData("Alaska","Alaska","infobox",dataCounty,"president"));
console.log(fetchData('District 8',"Minnesota","tooltip",dataHouse,"ushouse"));


//table functions
function makeTable(race){
d3.json("https://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=1dmWuUyYnLo9599ikNdLY5ZfbPkFk8pmSPUWhlpgAfUU&sheet=us2016", function(error, dataLoad) {

var data = dataLoad.us2016;

function spitRankings(container){

  var dTotal = 0;
  var rTotal = 0;
  var uTotal = "";
  var votesD = 0;
  var votesR = 0;

d3.select(container).selectAll(".tableRow")
.data(data).enter().append("div")
.attr("id", function(d) { var str = d.district; return str.replace(new RegExp(" ", "g"),"-"); })
.attr("data","country")
.attr("class","tableRow")
.html(function (d){ 

  var winner = fetchData(d.district,d.district,"winner",dataCounty,race,d.ev);
  votesD += fetchData(d.district,d.district,"votesD",dataCounty,race,d.ev);
  votesR += fetchData(d.district,d.district,"votesR",dataCounty,race,d.ev);

  $("#" + d.ab).css("width",d3.format("%")((d.ev/575)));

  if (winner == "DEM Win") { $("#" + d.ab).addClass("d3"); $("#" + d.ab).addClass("demWin"); dTotal += d.ev; }
  else if (winner == "GOP Win") { $("#" + d.ab).addClass("r3"); $("#" + d.ab).addClass("gopWin"); rTotal += d.ev; }
  else if (winner == "DEM Lean") { $("#" + d.ab).addClass("d1"); $("#" + d.ab).addClass("demWin"); dTotal += d.ev; }
  else if (winner == "GOP Lean") { $("#" + d.ab).addClass("r1"); $("#" + d.ab).addClass("gopWin"); rTotal += d.ev; }
  else { $("#" + d.ab).addClass("mid"); uTotal += d.ev; }

      return fetchData(d.district,d.district,"table",dataCounty,race,d.ev);
});

$(".demsCount").html(d3.format(",")(dTotal));
$(".gopCount").html(d3.format(",")(rTotal));
$(".undCount").html("");
$(".demsVotes").html(d3.format(",")(votesD));
$(".gopVotes").html(d3.format(",")(votesR));

$(".bar").click(function() {

  $(".bar").removeClass("selected");
  $(this).addClass("selected");

  jQuery.fn.d3Click = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Down = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mousedown", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Up = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mouseup", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

    // clicked2();
    var findDistrict = $(this).attr("data") + "_us";
    
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Click();

    // var single = $(this).parent().attr("id");
    // if (single == "dLean") {

    //   console.log(findDistrict);

    // $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    // $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    // $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Click();
    // $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    // $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    // $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Click();
    // }
});

d3.select(container).selectAll(".bar")
.data(data).call(d3.helper.tooltip(function(d, i){
        return fetchData(d.district,d.district,"tooltip",dataCounty,race);
}));

     $('.filter input').keyup(function(i){
        $('.tableRow').hide();
        var txt = $(this).val();
        $('.tableRow').each(function(){
           if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
               $(this).show();
           }
        });
    });

} //end spillRankings

d3.helper = {};

d3.helper.tooltip = function(accessor){
    return function(selection){
        var tooltipDiv;
        var bodyNode = d3.select('body').node();
        selection.on("mouseover", function(d, i){
            // Clean up lost tooltips
            d3.select('body').selectAll('div.tooltip').remove();
            // Append tooltip
            tooltipDiv = d3.select('body').append('div').attr('class', 'tooltip');
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px')
                .style('position', 'absolute') 
                .style('z-index', 1001);
            // Add text using the accessor function
            var tooltipText = accessor(d, i) || '';
            // Crop text arbitrarily
            //tooltipDiv.style('width', function(d, i){return (tooltipText.length > 80) ? '300px' : null;})
            //    .html(tooltipText);
        })
        .on('mousemove', function(d, i) {
            // Move tooltip
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px');
            var tooltipText = accessor(d, i) || '';
            tooltipDiv.html(tooltipText);
        })
        .on("mouseout", function(d, i){
            // Remove tooltip
            tooltipDiv.remove();
        });

    };
};

  spitRankings("#" + race + " .table");

}); 

}//end table functions

//cartogram functions
var cartogram = [];

function cartoBuild(container, boxContainer, chartContainer, shape, race, dataCompare, geo, index, data){

  if (race == "mnhouse" || race == "mnsenate") { 
    var top = 40;
    var right = 250;
    var bottom = 0;
    var left = 100;
  } else {
    var top = 40;
    var right = 10;
    var bottom = 0;
    var left = 280;   
  }
cartogram[index] = {

    margin: {
        top: top,
        right: right,
        bottom: bottom,
        left: left
    },

    selector: container + ' svg',

    init: function() {
        var self = this;

        self.$el = $(self.selector);

        self.width = 800 - self.margin.left - self.margin.right; self.height = 600 - self.margin.top - self.margin.bottom;

       if (geo == "us") { self.width = 800 - self.margin.left - self.margin.right; self.height = 600 - self.margin.top - self.margin.bottom; }
       if (geo == "mn") { self.width = 600 - self.margin.left - self.margin.right; self.height = 400 - self.margin.top - self.margin.bottom; }
       if (geo == "metro") { self.width = 600 - self.margin.left - self.margin.right; self.height = 400 - self.margin.top - self.margin.bottom; }

        self.svg = d3.select(self.selector)
            .attr('height', self.height + self.margin.top + self.margin.bottom)
            .attr('width', self.width + self.margin.left + self.margin.right)

        self.state_size = self.width / 12;
        self.state_padding = 2;

        self.map = self.svg.append('g')
            .attr('transform', 'translate(' + self.margin.left + ','
                  + self.margin.top + ')')

        self.drawMap();
    },

    drawMap: function() {
        var self = this;

        var states = self.map.selectAll('.states')
            .data(self.state_pos_co2)
            .enter().append('g')
            .attr('class', 'state-groups');

        var state = states.append('rect')
            .attr('id', function(d) {
                var str = d.state_full + "_" + geo; return str.replace(new RegExp(" ", "g"),"-");
            })
            .style('fill', function(d) {
               if (race == "mnsenate" || race == "mnhouse") { return 'state ' + fetchData(d.state_full,"Minnesota","colors",dataCompare,race); }
                else { return 'state ' + fetchData(d.state_full,d.state_full,"colors",dataCompare,race); }
            })
            .attr('rx', 0)
            .attr('ry', 0)
            .attr('x', function(d) {
                return d.column * (self.state_size + self.state_padding); //d.column * (self.state_size + self.state_padding);
            })
            .attr('y', function(d) {
                return d.row * (self.state_size + self.state_padding);
            })
            .attr('width', function (d) { return d.state_total_old / self.state_size * 100; }) //d.state_total_old * 2 + "px"; })
            .attr('height', function (d) { return d.state_total_old / self.state_size * 100; }) //d.state_total_old  * 2 + "px"; })
            .on('click', function(d) {
              d3.selectAll("rect").classed('faded', true); 
              d3.selectAll("rect").classed('active', false); 
              d3.select(this).classed('faded', false); 
              d3.select(this).classed('active', true); 

              if (race == "president" || race == "senate" ||  race == "governors"){ $("#infobox").html(fetchData(d.state_full,d.state_full,"table",dataCompare,race)); }
              else if (race == "mnsenate" || race == "mnhouse") { $("#infobox").html(fetchData(d.state_full,"Minnesota","table",dataCompare,race,null,d.state_full)); }

        })
            .call(d3.helper.tooltip(function(d, i){
             if (race == "mnsenate" || race == "mnhouse") { return fetchData(d.state_full,"Minnesota","tooltip",dataCompare,race,null,d.state_full); }
             else { return fetchData(d.state_full,d.state_full,"tooltip",dataCompare,race); }
           }));

        var text = states.append('text')
            .attr('class', 'state-label')
            .attr('class', function(d) {
                // return mapColor(d, race, dataCompare);
            })
            .attr('dominant-baseline', 'central')
            .attr('x', function(d) {
                return (d.column * (self.state_size + self.state_padding))
                        + self.state_size / 2; })
            .attr('y', function(d) {
                return (d.row * (self.state_size + self.state_padding))
                    + self.state_size / 2; })
            .style('text-anchor', 'middle')
            .on('click', function(d) {
              d3.selectAll("rect").classed('faded', true); 
              d3.selectAll("rect").classed('active', false); 
              d3.select(this.parentNode).select("rect").classed('faded', false); 
              d3.select(this.parentNode).select("rect").classed('active', true);

              if (race == "president" || race == "senate" ||  race == "governors"){ $("#infobox").html(fetchData(d.state_full,d.state_full,"table",dataCompare,race)); }
              else if (race == "mnsenate" || race == "mnhouse") { $("#infobox").html(fetchData(d.state_full,"Minnesota","table",dataCompare,race,null,d.state_full)); }
      })
            .text(function(d) {
                return d.state_postal;
            })
            .call(d3.helper.tooltip(function(d, i){
             if (race == "mnsenate" || race == "mnhouse") { return fetchData(d.state_full,"Minnesota","tooltip",dataCompare,race,null,d.state_full); }
             else { return fetchData(d.state_full,d.state_full,"tooltip",dataCompare,race); }
           }));
    },

    state_pos_co2: data

};

$(document).ready(function() {
cartogram[index].init();
});

} //end cartoBuild

function cartoData(race,geo){
var usCarto = [{'state_full':'Alabama','state_postal':'AL','row':5,'column':6,'state_total_old':9,'state_total_new':'25','state_change':'-63%','color':'dq1'},
        {'state_full':'Alaska','state_postal':'AK','row':6,'column':0,'state_total_old':3,'state_total_new':'0','state_change':'Insufficient data','color':'none'},
        {'state_full':'Arizona','state_postal':'AZ','row':4,'column':1,'state_total_old':11,'state_total_new':'36','state_change':'+36%','color':'dq7'},
        {'state_full':'Arkansas','state_postal':'AR','row':4,'column':4,'state_total_old':6,'state_total_new':'43','state_change':'-33%','color':'dq3'},
        {'state_full':'California','state_postal':'CA','row':3,'column':0,'state_total_old':55,'state_total_new':'267','state_change':'-25%','color':'dq3'},
        {'state_full':'Colorado','state_postal':'CO','row':3,'column':2,'state_total_old':9,'state_total_new':'93','state_change':'-33%','color':'dq3'},
        {'state_full':'Connecticut','state_postal':'CT','row':2,'column':9,'state_total_old':7,'state_total_new':'6','state_change':'Insufficient data','color':'none'},
        {'state_full':'District of Columbia','state_postal':'DC','row':4,'column':8,'state_total_old':3,'state_total_new':'0','state_change':'Insufficient data','color':'none'},
        {'state_full':'Delaware','state_postal':'DE','row':3,'column':9,'state_total_old':3,'state_total_new':'3','state_change':'-100%','color':'dq1'},
        {'state_full':'Florida','state_postal':'FL','row':6,'column':8,'state_total_old':29,'state_total_new':'136','state_change':'-14%','color':'dq4'},
        {'state_full':'Georgia','state_postal':'GA','row':5,'column':7,'state_total_old':16,'state_total_new':'59','state_change':'-38%','color':'dq3'},
        {'state_full':'Hawaii','state_postal':'HI','row':6,'column':-1,'state_total_old':4,'state_total_new':'11','state_change':'Insufficient data','color':'none'},
        {'state_full':'Idaho','state_postal':'ID','row':1,'column':1,'state_total_old':4,'state_total_new':'68','state_change':'-21%','color':'dq3'},
        {'state_full':'Illinois','state_postal':'IL','row':1,'column':6,'state_total_old':20,'state_total_new':'221','state_change':'-14%','color':'dq4'},
        {'state_full':'Indiana','state_postal':'IN','row':2,'column':5,'state_total_old':11,'state_total_new':'220','state_change':'0%','color':'mid'},
        {'state_full':'Iowa','state_postal':'IA','row':2,'column':4,'state_total_old':6,'state_total_new':'295','state_change':'+29%','color':'dq6'},
        {'state_full':'Kansas','state_postal':'KS','row':4,'column':3,'state_total_old':6,'state_total_new':'205','state_change':'-6%','color':'dq4'},
        {'state_full':'Kentucky','state_postal':'KY','row':3,'column':5,'state_total_old':8,'state_total_new':'162','state_change':'-49%','color':'dq2'},
        {'state_full':'Louisiana','state_postal':'LA','row':5,'column':4,'state_total_old':8,'state_total_new':'26','state_change':'-53%','color':'dq1'},
        {'state_full':'Maine','state_postal':'ME','row':-1,'column':10,'state_total_old':4,'state_total_new':'14','state_change':'Insufficient data','color':'none'},
        {'state_full':'Maryland','state_postal':'MD','row':3,'column':8,'state_total_old':10,'state_total_new':'27','state_change':'-46%','color':'dq2'},
        {'state_full':'Massachusetts','state_postal':'MA','row':1,'column':9,'state_total_old':11,'state_total_new':'11','state_change':'Insufficient data','color':'none'},
        {'state_full':'Michigan','state_postal':'MI','row':1,'column':7,'state_total_old':16,'state_total_new':'179','state_change':'+74%','color':'dq8'},
        {'state_full':'Minnesota','state_postal':'MN','row':1,'column':4,'state_total_old':10,'state_total_new':'210','state_change':'+37%','color':'dq7'},
        {'state_full':'Mississippi','state_postal':'MS','row':5,'column':5,'state_total_old':6,'state_total_new':'46','state_change':'-57%','color':'dq1'},
        {'state_full':'Missouri','state_postal':'MO','row':3,'column':4,'state_total_old':10,'state_total_new':'288','state_change':'+5%','color':'dq5'},
        {'state_full':'Montana','state_postal':'MT','row':1,'column':2,'state_total_old':3,'state_total_new':'139','state_change':'-10%','color':'dq4'},
        {'state_full':'Nebraska','state_postal':'NE','row':3,'column':3,'state_total_old':5,'state_total_new':'179','state_change':'-11%','color':'dq4'},
        {'state_full':'Nevada','state_postal':'NV','row':2,'column':1,'state_total_old':6,'state_total_new':'11','state_change':'Insufficient data','color':'none'},
        {'state_full':'New Hampshire','state_postal':'NH','row':0,'column':10,'state_total_old':4,'state_total_new':'4','state_change':'Insufficient data','color':'none'},
        {'state_full':'New Jersey','state_postal':'NJ','row':2,'column':8,'state_total_old':14,'state_total_new':'19','state_change':'+50%','color':'dq8'},
        {'state_full':'New Mexico','state_postal':'NM','row':4,'column':2,'state_total_old':5,'state_total_new':'14','state_change':'-100%','color':'dq1'},
        {'state_full':'New York','state_postal':'NY','row':1,'column':8,'state_total_old':29,'state_total_new':'135','state_change':'-38%','color':'dq3'},
        {'state_full':'North Carolina','state_postal':'NC','row':4,'column':6,'state_total_old':15,'state_total_new':'111','state_change':'-35%','color':'dq3'},
        {'state_full':'North Dakota','state_postal':'ND','row':1,'column':3,'state_total_old':3,'state_total_new':'117','state_change':'+36%','color':'dq7'},
        {'state_full':'Ohio','state_postal':'OH','row':2,'column':6,'state_total_old':18,'state_total_new':'217','state_change':'-18%','color':'dq4'},
        {'state_full':'Oklahoma','state_postal':'OK','row':5,'column':3,'state_total_old':7,'state_total_new':'53','state_change':'-30%','color':'dq3'},
        {'state_full':'Oregon','state_postal':'OR','row':2,'column':0,'state_total_old':7,'state_total_new':'61','state_change':'+20%','color':'dq6'},
        {'state_full':'Pennsylvania','state_postal':'PA','row':2,'column':7,'state_total_old':20,'state_total_new':'182','state_change':'-34%','color':'dq3'},
        {'state_full':'Rhode Island','state_postal':'RI','row':2,'column':10,'state_total_old':4,'state_total_new':'0','state_change':'Insufficient data','color':'none'},
        {'state_full':'South Carolina','state_postal':'SC','row':4,'column':7,'state_total_old':9,'state_total_new':'30','state_change':'+38%','color':'dq7'},
        {'state_full':'South Dakota','state_postal':'SD','row':2,'column':3,'state_total_old':3,'state_total_new':'108','state_change':'+17%','color':'dq6'},
        {'state_full':'Tennessee','state_postal':'TN','row':4,'column':5,'state_total_old':11,'state_total_new':'147','state_change':'-42%','color':'dq2'},
        {'state_full':'Texas','state_postal':'TX','row':6,'column':3,'state_total_old':38,'state_total_new':'159','state_change':'+29%','color':'dq3'},
        {'state_full':'Utah','state_postal':'UT','row':3,'column':1,'state_total_old':6,'state_total_new':'24','state_change':'-67%','color':'dq1'},
        {'state_full':'Vermont','state_postal':'VT','row':0,'column':9,'state_total_old':3,'state_total_new':'15','state_change':'-57%','color':'dq1'},
        {'state_full':'Virginia','state_postal':'VA','row':3,'column':7,'state_total_old':13,'state_total_new':'123','state_change':'-10%','color':'dq4'},
        {'state_full':'Washington','state_postal':'WA','row':1,'column':0,'state_total_old':12,'state_total_new':'63','state_change':'-39%','color':'dq3'},
        {'state_full':'West Virginia','state_postal':'WV','row':3,'column':6,'state_total_old':5,'state_total_new':'22','state_change':'0%','color':'mid'},
        {'state_full':'Wisconsin','state_postal':'WI','row':1,'column':5,'state_total_old':10,'state_total_new':'242','state_change':'-15%','color':'dq4'},
        {'state_full':'Wyoming','state_postal':'WY','row':2,'column':2,'state_total_old':3,'state_total_new':'37','state_change':'-21%','color':'dq3'}]

var usCDCarto = [{'state_full':'Alabama','state_postal':'AL','row':5,'column':6,'state_total_old':'32','state_total_new':'25','state_change':'-63%','color':'dq1'},
        {'state_full':'Alaska','state_postal':'AK','row':6,'column':0,'state_total_old':'0','state_total_new':'0','state_change':'Insufficient data','color':'none'},
        {'state_full':'Arizona','state_postal':'AZ','row':4,'column':1,'state_total_old':'14','state_total_new':'36','state_change':'+36%','color':'dq7'},
        {'state_full':'Arkansas','state_postal':'AR','row':4,'column':4,'state_total_old':'36','state_total_new':'43','state_change':'-33%','color':'dq3'},
        {'state_full':'California','state_postal':'CA','row':3,'column':0,'state_total_old':'358','state_total_new':'267','state_change':'-25%','color':'dq3'},
        {'state_full':'Colorado','state_postal':'CO','row':3,'column':2,'state_total_old':'124','state_total_new':'93','state_change':'-33%','color':'dq3'},
        {'state_full':'Connecticut','state_postal':'CT','row':2,'column':9,'state_total_old':'0','state_total_new':'6','state_change':'Insufficient data','color':'none'},
        {'state_full':'District of Columbia','state_postal':'DC','row':4,'column':8,'state_total_old':'0','state_total_new':'0','state_change':'Insufficient data','color':'none'},
        {'state_full':'Delaware','state_postal':'DE','row':3,'column':9,'state_total_old':'3','state_total_new':'3','state_change':'-100%','color':'dq1'},
        {'state_full':'Florida','state_postal':'FL','row':6,'column':8,'state_total_old':'150','state_total_new':'136','state_change':'-14%','color':'dq4'},
        {'state_full':'Georgia','state_postal':'GA','row':5,'column':7,'state_total_old':'77','state_total_new':'59','state_change':'-38%','color':'dq3'},
        {'state_full':'Hawaii','state_postal':'HI','row':6,'column':-1,'state_total_old':'0','state_total_new':'11','state_change':'Insufficient data','color':'none'},
        {'state_full':'Idaho','state_postal':'ID','row':1,'column':1,'state_total_old':'71','state_total_new':'68','state_change':'-21%','color':'dq3'},
        {'state_full':'Illinois','state_postal':'IL','row':1,'column':6,'state_total_old':'251','state_total_new':'221','state_change':'-14%','color':'dq4'},
        {'state_full':'Indiana','state_postal':'IN','row':2,'column':5,'state_total_old':'216','state_total_new':'220','state_change':'0%','color':'mid'},
        {'state_full':'Iowa','state_postal':'IA','row':2,'column':4,'state_total_old':'228','state_total_new':'295','state_change':'+29%','color':'dq6'},
        {'state_full':'Kansas','state_postal':'KS','row':4,'column':3,'state_total_old':'215','state_total_new':'205','state_change':'-6%','color':'dq4'},
        {'state_full':'Kentucky','state_postal':'KY','row':3,'column':5,'state_total_old':'308','state_total_new':'162','state_change':'-49%','color':'dq2'},
        {'state_full':'Louisiana','state_postal':'LA','row':5,'column':4,'state_total_old':'30','state_total_new':'26','state_change':'-53%','color':'dq1'},
        {'state_full':'Maine','state_postal':'ME','row':-1,'column':10,'state_total_old':'0','state_total_new':'14','state_change':'Insufficient data','color':'none'},
        {'state_full':'Maryland','state_postal':'MD','row':3,'column':8,'state_total_old':'26','state_total_new':'27','state_change':'-46%','color':'dq2'},
        {'state_full':'Massachusetts','state_postal':'MA','row':1,'column':9,'state_total_old':'0','state_total_new':'11','state_change':'Insufficient data','color':'none'},
        {'state_full':'Michigan','state_postal':'MI','row':1,'column':7,'state_total_old':'102','state_total_new':'179','state_change':'+74%','color':'dq8'},
        {'state_full':'Minnesota','state_postal':'MN','row':1,'column':4,'state_total_old':'153','state_total_new':'210','state_change':'+37%','color':'dq7'},
        {'state_full':'Mississippi','state_postal':'MS','row':5,'column':5,'state_total_old':'65','state_total_new':'46','state_change':'-57%','color':'dq1'},
        {'state_full':'Missouri','state_postal':'MO','row':3,'column':4,'state_total_old':'264','state_total_new':'288','state_change':'+5%','color':'dq5'},
        {'state_full':'Montana','state_postal':'MT','row':1,'column':2,'state_total_old':'145','state_total_new':'139','state_change':'-10%','color':'dq4'},
        {'state_full':'Nebraska','state_postal':'NE','row':3,'column':3,'state_total_old':'199','state_total_new':'179','state_change':'-11%','color':'dq4'},
        {'state_full':'Nevada','state_postal':'NV','row':2,'column':1,'state_total_old':'0','state_total_new':'11','state_change':'Insufficient data','color':'none'},
        {'state_full':'New Hampshire','state_postal':'NH','row':0,'column':10,'state_total_old':'0','state_total_new':'4','state_change':'Insufficient data','color':'none'},
        {'state_full':'New Jersey','state_postal':'NJ','row':2,'column':8,'state_total_old':'8','state_total_new':'19','state_change':'+50%','color':'dq8'},
        {'state_full':'New Mexico','state_postal':'NM','row':4,'column':2,'state_total_old':'24','state_total_new':'14','state_change':'-100%','color':'dq1'},
        {'state_full':'New York','state_postal':'NY','row':1,'column':8,'state_total_old':'203','state_total_new':'135','state_change':'-38%','color':'dq3'},
        {'state_full':'North Carolina','state_postal':'NC','row':4,'column':6,'state_total_old':'156','state_total_new':'111','state_change':'-35%','color':'dq3'},
        {'state_full':'North Dakota','state_postal':'ND','row':1,'column':3,'state_total_old':'84','state_total_new':'117','state_change':'+36%','color':'dq7'},
        {'state_full':'Ohio','state_postal':'OH','row':2,'column':6,'state_total_old':'258','state_total_new':'217','state_change':'-18%','color':'dq4'},
        {'state_full':'Oklahoma','state_postal':'OK','row':5,'column':3,'state_total_old':'46','state_total_new':'53','state_change':'-30%','color':'dq3'},
        {'state_full':'Oregon','state_postal':'OR','row':2,'column':0,'state_total_old':'40','state_total_new':'61','state_change':'+20%','color':'dq6'},
        {'state_full':'Pennsylvania','state_postal':'PA','row':2,'column':7,'state_total_old':'276','state_total_new':'182','state_change':'-34%','color':'dq3'},
        {'state_full':'Rhode Island','state_postal':'RI','row':2,'column':10,'state_total_old':'0','state_total_new':'0','state_change':'Insufficient data','color':'none'},
        {'state_full':'South Carolina','state_postal':'SC','row':4,'column':7,'state_total_old':'16','state_total_new':'30','state_change':'+38%','color':'dq7'},
        {'state_full':'South Dakota','state_postal':'SD','row':2,'column':3,'state_total_old':'88','state_total_new':'108','state_change':'+17%','color':'dq6'},
        {'state_full':'Tennessee','state_postal':'TN','row':4,'column':5,'state_total_old':'244','state_total_new':'147','state_change':'-42%','color':'dq2'},
        {'state_full':'Texas','state_postal':'TX','row':6,'column':3,'state_total_old':'223','state_total_new':'159','state_change':'+29%','color':'dq3'},
        {'state_full':'Utah','state_postal':'UT','row':3,'column':1,'state_total_old':'24','state_total_new':'24','state_change':'-67%','color':'dq1'},
        {'state_full':'Vermont','state_postal':'VT','row':0,'column':9,'state_total_old':'7','state_total_new':'15','state_change':'-57%','color':'dq1'},
        {'state_full':'Virginia','state_postal':'VA','row':3,'column':7,'state_total_old':'130','state_total_new':'123','state_change':'-10%','color':'dq4'},
        {'state_full':'Washington','state_postal':'WA','row':1,'column':0,'state_total_old':'88','state_total_new':'63','state_change':'-39%','color':'dq3'},
        {'state_full':'West Virginia','state_postal':'WV','row':3,'column':6,'state_total_old':'9','state_total_new':'22','state_change':'0%','color':'mid'},
        {'state_full':'Wisconsin','state_postal':'WI','row':1,'column':5,'state_total_old':'279','state_total_new':'242','state_change':'-15%','color':'dq4'},
        {'state_full':'Wyoming','state_postal':'WY','row':2,'column':2,'state_total_old':'33','state_total_new':'37','state_change':'-21%','color':'dq3'}]


var mnCountyCarto = [{'state_full':'Kittson','state_postal':'KITT','row':0,'column':0,'color_value':34},
        {'state_full':'Lake of the Woods','state_postal':'LW','row':-1,'column':1,'color_value':38},
        {'state_full':'Roseau','state_postal':'ROS','row':0,'column':1,'color_value':67},
        {'state_full':'Koochiching','state_postal':'KOO','row':0,'column':2,'color_value':35},
        {'state_full':'Saint Louis','state_postal':'STL','row':0,'column':3,'color_value':71},
        {'state_full':'Lake','state_postal':'LAKE','row':0,'column':4,'color_value':37},
        {'state_full':'Cook','state_postal':'COOK','row':0,'column':5,'color_value':15},
        {'state_full':'Marshall','state_postal':'MAR','row':1,'column':0,'color_value':43},
        {'state_full':'Beltrami','state_postal':'BEL','row':1,'column':1,'color_value':3},
        {'state_full':'Itasca','state_postal':'ITAS','row':1,'column':2,'color_value':30},
        {'state_full':'Aitkin','state_postal':'AITK','row':1,'column':3,'color_value':0},
        {'state_full':'Carlton','state_postal':'CARL','row':1,'column':4,'color_value':8},
        {'state_full':'Polk','state_postal':'POLK','row':2,'column':0,'color_value':59},
        {'state_full':'Pennington','state_postal':'PENN','row':2,'column':1,'color_value':56},
        {'state_full':'Red Lake','state_postal':'RL','row':2,'column':2,'color_value':62},
        {'state_full':'Clearwater','state_postal':'CW','row':2,'column':3,'color_value':14},
        {'state_full':'Hubbard','state_postal':'HUB','row':2,'column':4,'color_value':28},
        {'state_full':'Norman','state_postal':'NORM','row':3,'column':0,'color_value':53},
        {'state_full':'Mahnomen','state_postal':'MAHN','row':3,'column':1,'color_value':42},
        {'state_full':'Cass','state_postal':'CASS','row':3,'column':2,'color_value':10},
        {'state_full':'Crow Wing','state_postal':'CROW','row':3,'column':3,'color_value':17},
        {'state_full':'Pine','state_postal':'PINE','row':3,'column':4,'color_value':57},
        {'state_full':'Clay','state_postal':'CLAY','row':4,'column':0,'color_value':13},
        {'state_full':'Becker','state_postal':'BECK','row':4,'column':1,'color_value':2},
        {'state_full':'Wadena','state_postal':'WAD','row':4,'column':2,'color_value':79},
        {'state_full':'Mille Lacs','state_postal':'ML','row':4,'column':3,'color_value':47},
        {'state_full':'Kanabec','state_postal':'KANA','row':4,'column':4,'color_value':32},
        {'state_full':'Wilkin','state_postal':'WILK','row':5,'column':0,'color_value':83},
        {'state_full':'Ottertail','state_postal':'OT','row':5,'column':1,'color_value':44},
        {'state_full':'Todd','state_postal':'TODD','row':5,'column':2,'color_value':76},
        {'state_full':'Morrison','state_postal':'MORR','row':5,'column':3,'color_value':48},
        {'state_full':'Benton','state_postal':'BEN','row':5,'column':4,'color_value':4},
        {'state_full':'Traverse','state_postal':'TRAV','row':6,'column':0,'color_value':77},
        {'state_full':'Grant','state_postal':'GRANT','row':6,'column':1,'color_value':25},
        {'state_full':'Douglas','state_postal':'DOUG','row':6,'column':2,'color_value':20},
        {'state_full':'Stearns','state_postal':'STRNS','row':6,'column':3,'color_value':72},
        {'state_full':'Isanti','state_postal':'ISA','row':6,'column':4,'color_value':29},
        {'state_full':'Big Stone','state_postal':'BIG','row':7,'column':0,'color_value':5},
        {'state_full':'Stevens','state_postal':'STEVE','row':7,'column':1,'color_value':74},
        {'state_full':'Pope','state_postal':'POP','row':7,'column':2,'color_value':60},
        {'state_full':'Sherburne','state_postal':'SB','row':7,'column':3,'color_value':69},
        {'state_full':'Anoka','state_postal':'AK','row':7,'column':4,'color_value':1},
        {'state_full':'Chisago','state_postal':'CHIS','row':7,'column':5,'color_value':12},
        {'state_full':'Swift','state_postal':'SWIFT','row':8,'column':0,'color_value':75},
        {'state_full':'Kandiyohi','state_postal':'KAN','row':8,'column':1,'color_value':33},
        {'state_full':'Meeker','state_postal':'MEEK','row':8,'column':2,'color_value':46},
        {'state_full':'Wright','state_postal':'WR','row':8,'column':3,'color_value':85},
        {'state_full':'Hennepin','state_postal':'HENN','row':8,'column':4,'color_value':26},
        {'state_full':'Ramsey','state_postal':'RAM','row':8,'column':5,'color_value':61},
        {'state_full':'Washington','state_postal':'WA','row':8,'column':6,'color_value':81},
        {'state_full':'Yellow Medicine','state_postal':'YM','row':9,'column':0,'color_value':86},
        {'state_full':'Renville','state_postal':'REN','row':9,'column':1,'color_value':64},
        {'state_full':'McLeod','state_postal':'MCL','row':9,'column':2,'color_value':45},
        {'state_full':'Sibley','state_postal':'SIB','row':9,'column':3,'color_value':70},
        {'state_full':'Carver','state_postal':'CV','row':9,'column':4,'color_value':9},
        {'state_full':'Scott','state_postal':'SCT','row':9,'column':5,'color_value':68},
        {'state_full':'Dakota','state_postal':'DAK','row':9,'column':6,'color_value':18},
        {'state_full':'Goodhue','state_postal':'GOOD','row':9,'column':7,'color_value':24},
        {'state_full':'Lincoln','state_postal':'LIN','row':10,'column':0,'color_value':40},
        {'state_full':'Lyon','state_postal':'LYON','row':10,'column':1,'color_value':41},
        {'state_full':'Redwood','state_postal':'RW','row':10,'column':2,'color_value':63},
        {'state_full':'Brown','state_postal':'BR','row':10,'column':3,'color_value':7},
        {'state_full':'Nicollet','state_postal':'NIC','row':10,'column':4,'color_value':51},
        {'state_full':'Blue Earth','state_postal':'BLUE','row':10,'column':5,'color_value':6},
        {'state_full':'Le Sueur','state_postal':'LS','row':10,'column':6,'color_value':39},
        {'state_full':'Rice','state_postal':'RICE','row':10,'column':7,'color_value':65},
        {'state_full':'Wabasha','state_postal':'WAB','row':10,'column':8,'color_value':78},
        {'state_full':'Pipestone','state_postal':'PS','row':11,'column':0,'color_value':58},
        {'state_full':'Murray','state_postal':'MURR','row':11,'column':1,'color_value':50},
        {'state_full':'Cottonwood','state_postal':'CW','row':11,'column':2,'color_value':16},
        {'state_full':'Watonwan','state_postal':'WTW','row':11,'column':3,'color_value':82},
        {'state_full':'Waseca','state_postal':'WAS','row':11,'column':4,'color_value':80},
        {'state_full':'Steele','state_postal':'ST','row':11,'column':5,'color_value':73},
        {'state_full':'Dodge','state_postal':'DG','row':11,'column':6,'color_value':19},
        {'state_full':'Olmsted','state_postal':'OLM','row':11,'column':7,'color_value':54},
        {'state_full':'Winona','state_postal':'WIN','row':11,'column':8,'color_value':84},
        {'state_full':'Rock','state_postal':'ROCK','row':12,'column':0,'color_value':66},
        {'state_full':'Nobles','state_postal':'NOB','row':12,'column':1,'color_value':52},
        {'state_full':'Jackson','state_postal':'JACK','row':12,'column':2,'color_value':31},
        {'state_full':'Martin','state_postal':'MART','row':12,'column':3,'color_value':44},
        {'state_full':'Faribault','state_postal':'FB','row':12,'column':4,'color_value':21},
        {'state_full':'Freeborn','state_postal':'FREE','row':12,'column':5,'color_value':23},
        {'state_full':'Mower','state_postal':'MOW','row':12,'column':6,'color_value':49},
        {'state_full':'Fillmore','state_postal':'FILL','row':12,'column':7,'color_value':22},
        {'state_full':'Houston','state_postal':'HOU','row':12,'column':8,'color_value':27}
        ]

var mnlegMetroCarto = [{'state_full':'District 30A','state_postal':'30A','row':0,'column':2,'color_value':53},
        {'state_full':'District 30B','state_postal':'30B','row':0,'column':3,'color_value':54},
        {'state_full':'District 35A','state_postal':'35A','row':0,'column':4,'color_value':61},
        {'state_full':'District 35B','state_postal':'35B','row':0,'column':5,'color_value':62},
        {'state_full':'District 31B','state_postal':'31B','row':0,'column':6,'color_value':55},
        {'state_full':'District 32B','state_postal':'32B','row':0,'column':7,'color_value':57},
        {'state_full':'District 34A','state_postal':'34A','row':1,'column':1,'color_value':0},
        {'state_full':'District 36A','state_postal':'36A','row':1,'column':2,'color_value':63},
        {'state_full':'District 36B','state_postal':'36B','row':1,'column':3,'color_value':64},
        {'state_full':'District 37A','state_postal':'37A','row':1,'column':4,'color_value':65},
        {'state_full':'District 37B','state_postal':'37B','row':1,'column':5,'color_value':66},
        {'state_full':'District 38A','state_postal':'38A','row':1,'column':6,'color_value':67},
        {'state_full':'District 38B','state_postal':'38B','row':1,'column':7,'color_value':68},
        {'state_full':'District 39A','state_postal':'39A','row':1,'column':8,'color_value':69},
        {'state_full':'District 34B','state_postal':'34B','row':2,'column':1,'color_value':60},
        {'state_full':'District 40A','state_postal':'40A','row':2,'column':2,'color_value':71},
        {'state_full':'District 40B','state_postal':'40B','row':2,'column':3,'color_value':72},
        {'state_full':'District 41A','state_postal':'41A','row':2,'column':4,'color_value':73},
        {'state_full':'District 41B','state_postal':'41B','row':2,'column':5,'color_value':74},
        {'state_full':'District 42A','state_postal':'42A','row':2,'column':6,'color_value':75},
        {'state_full':'District 42B','state_postal':'42B','row':2,'column':7,'color_value':76},
        {'state_full':'District 43A','state_postal':'43A','row':2,'column':8,'color_value':77},
        {'state_full':'District 44A','state_postal':'44A','row':3,'column':0,'color_value':79},
        {'state_full':'District 45A','state_postal':'45A','row':3,'column':1,'color_value':81},
        {'state_full':'District 45B','state_postal':'45B','row':3,'column':2,'color_value':82},
        {'state_full':'District 59A','state_postal':'59A','row':3,'column':3,'color_value':108},
        {'state_full':'District 60A','state_postal':'60A','row':3,'column':4,'color_value':110},
        {'state_full':'District 66A','state_postal':'66A','row':3,'column':5,'color_value':122},
        {'state_full':'District 66B','state_postal':'66B','row':3,'column':6,'color_value':123},
        {'state_full':'District 67A','state_postal':'67A','row':3,'column':7,'color_value':124},
        {'state_full':'District 43B','state_postal':'43B','row':3,'column':8,'color_value':78},
        {'state_full':'District 39B','state_postal':'39B','row':3,'column':9,'color_value':70},
        {'state_full':'District 44B','state_postal':'44B','row':4,'column':1,'color_value':80},
        {'state_full':'District 46A','state_postal':'46A','row':4,'column':2,'color_value':83},
        {'state_full':'District 59B','state_postal':'59B','row':4,'column':3,'color_value':109},
        {'state_full':'District 60B','state_postal':'60B','row':4,'column':4,'color_value':111},
        {'state_full':'District 64A','state_postal':'64A','row':4,'column':5,'color_value':118},
        {'state_full':'District 65A','state_postal':'65A','row':4,'column':6,'color_value':120},
        {'state_full':'District 67B','state_postal':'67B','row':4,'column':7,'color_value':125},
        {'state_full':'District 53A','state_postal':'53A','row':4,'column':8,'color_value':96},
        {'state_full':'District 33B','state_postal':'33B','row':5,'column':1,'color_value':59},
        {'state_full':'District 46B','state_postal':'46B','row':5,'column':2,'color_value':84},
        {'state_full':'District 61A','state_postal':'61A','row':5,'column':3,'color_value':112},
        {'state_full':'District 62A','state_postal':'62A','row':5,'column':4,'color_value':114},
        {'state_full':'District 63A','state_postal':'63A','row':5,'column':5,'color_value':116},
        {'state_full':'District 65B','state_postal':'65B','row':5,'column':6,'color_value':121},
        {'state_full':'District 53B','state_postal':'53B','row':5,'column':7,'color_value':96},
        {'state_full':'District 54B','state_postal':'54B','row':5,'column':8,'color_value':99},
        {'state_full':'District 48A','state_postal':'48A','row':6,'column':1,'color_value':86},
        {'state_full':'District 49A','state_postal':'49A','row':6,'column':2,'color_value':88},
        {'state_full':'District 61B','state_postal':'61B','row':6,'column':3,'color_value':113},
        {'state_full':'District 62B','state_postal':'62B','row':6,'column':4,'color_value':115},
        {'state_full':'District 63B','state_postal':'63B','row':6,'column':5,'color_value':117},
        {'state_full':'District 64B','state_postal':'64B','row':6,'column':6,'color_value':119},
        {'state_full':'District 52A','state_postal':'52A','row':6,'column':7,'color_value':94},
        {'state_full':'District 54A','state_postal':'54A','row':6,'column':8,'color_value':98},
        {'state_full':'District 47B','state_postal':'47B','row':7,'column':1,'color_value':0},
        {'state_full':'District 48B','state_postal':'48B','row':7,'column':2,'color_value':87},
        {'state_full':'District 49B','state_postal':'49B','row':7,'column':3,'color_value':89},
        {'state_full':'District 50A','state_postal':'50A','row':7,'column':4,'color_value':90},
        {'state_full':'District 50B','state_postal':'50B','row':7,'column':5,'color_value':91},
        {'state_full':'District 51A','state_postal':'51A','row':7,'column':6,'color_value':92},
        {'state_full':'District 51B','state_postal':'51B','row':7,'column':7,'color_value':93},
        {'state_full':'District 52B','state_postal':'52B','row':7,'column':8,'color_value':95},
        {'state_full':'District 55A','state_postal':'55A','row':8,'column':2,'color_value':100},
        {'state_full':'District 55B','state_postal':'55B','row':8,'column':3,'color_value':101},
        {'state_full':'District 56A','state_postal':'56A','row':8,'column':4,'color_value':102},
        {'state_full':'District 56B','state_postal':'56B','row':8,'column':5,'color_value':103},
        {'state_full':'District 58A','state_postal':'58A','row':8,'column':6,'color_value':109},
        {'state_full':'District 57A','state_postal':'57A','row':8,'column':7,'color_value':104},
        {'state_full':'District 57B','state_postal':'57B','row':8,'column':8,'color_value':105}
        ]

var mnlegMNCarto = [{'state_full':'District 1A','state_postal':'1A','row':0,'column':0,'color_value':1},
        {'state_full':'District 2A','state_postal':'2A','row':-1,'column':1,'color_value':3},
        {'state_full':'District 1B','state_postal':'1B','row':0,'column':1,'color_value':2},
        {'state_full':'District 2B','state_postal':'2B','row':0,'column':2,'color_value':4},
        {'state_full':'District 6A','state_postal':'6A','row':0,'column':3,'color_value':11},
        {'state_full':'District 6B','state_postal':'6B','row':0,'column':4,'color_value':12},
        {'state_full':'District 3B','state_postal':'3B','row':0,'column':5,'color_value':6},
        {'state_full':'District 3A','state_postal':'3A','row':0,'column':6,'color_value':5},
        {'state_full':'District 4A','state_postal':'4A','row':1,'column':0,'color_value':7},
        {'state_full':'District 4B','state_postal':'4B','row':1,'column':1,'color_value':8},
        {'state_full':'District 5A','state_postal':'5A','row':1,'column':2,'color_value':9},
        {'state_full':'District 5B','state_postal':'5B','row':1,'column':3,'color_value':10},
        {'state_full':'District 7B','state_postal':'7B','row':1,'column':4,'color_value':14},
        {'state_full':'District 7A','state_postal':'7A','row':1,'column':5,'color_value':13},
        {'state_full':'District 8A','state_postal':'8A','row':2,'column':0,'color_value':15},
        {'state_full':'District 8B','state_postal':'8B','row':2,'column':1,'color_value':16},
        {'state_full':'District 10A','state_postal':'10A','row':2,'column':2,'color_value':19},
        {'state_full':'District 10B','state_postal':'10B','row':2,'column':3,'color_value':20},
        {'state_full':'District 11A','state_postal':'11A','row':2,'column':4,'color_value':21},
        {'state_full':'District 12A','state_postal':'12A','row':3,'column':0,'color_value':23},
        {'state_full':'District 9A','state_postal':'9A','row':3,'column':1,'color_value':17},
        {'state_full':'District 9B','state_postal':'9B','row':3,'column':2,'color_value':18},
        {'state_full':'District 15B','state_postal':'15B','row':3,'column':3,'color_value':29},
        {'state_full':'District 11B','state_postal':'11B','row':3,'column':4,'color_value':22},
        {'state_full':'District 12B','state_postal':'12B','row':4,'column':0,'color_value':24},
        {'state_full':'District 13A','state_postal':'13A','row':4,'column':1,'color_value':25},
        {'state_full':'District 13B','state_postal':'13B','row':4,'column':2,'color_value':0},
        {'state_full':'District 15A','state_postal':'15A','row':4,'column':3,'color_value':28},
        {'state_full':'District 32A','state_postal':'32A','row':4,'column':4,'color_value':56},
        {'state_full':'District 17A','state_postal':'17A','row':5,'column':0,'color_value':32},
        {'state_full':'District 17B','state_postal':'17B','row':5,'column':1,'color_value':33},
        {'state_full':'District 14A','state_postal':'14A','row':5,'column':2,'color_value':26},
        {'state_full':'District 14B','state_postal':'14B','row':5,'column':3,'color_value':27},
        {'state_full':'District 31A','state_postal':'31A','row':5,'column':4,'color_value':0},
        {'state_full':'District 15A','state_postal':'15A','row':6,'column':0,'color_value':28},
        {'state_full':'District 18A','state_postal':'18A','row':6,'column':1,'color_value':34},
        {'state_full':'District 29A','state_postal':'29A','row':6,'column':2,'color_value':0},
        {'state_full':'District 29B','state_postal':'29B','row':6,'column':3,'color_value':0},
        {'state_full':'District 16B','state_postal':'16B','row':7,'column':0,'color_value':31},
        {'state_full':'District 18B','state_postal':'18B','row':7,'column':1,'color_value':35},
        {'state_full':'District 47A','state_postal':'47A','row':7,'column':2,'color_value':85},
        {'state_full':'District 33A','state_postal':'33A','row':7,'column':3,'color_value':58},
        {'state_full':'District 19A','state_postal':'19A','row':8,'column':0,'color_value':36},
        {'state_full':'District 20A','state_postal':'20A','row':8,'column':1,'color_value':38},
        {'state_full':'District 20B','state_postal':'20B','row':8,'column':2,'color_value':39},
        {'state_full':'District 58B','state_postal':'58B','row':8,'column':3,'color_value':103},
        {'state_full':'District 21A','state_postal':'21A','row':8,'column':4,'color_value':40},
        {'state_full':'District 21B','state_postal':'21B','row':8,'column':5,'color_value':41},
        {'state_full':'District 22B','state_postal':'22B','row':9,'column':0,'color_value':43},
        {'state_full':'District 19B','state_postal':'19B','row':9,'column':1,'color_value':37},
        {'state_full':'District 23B','state_postal':'23B','row':9,'column':2,'color_value':0},
        {'state_full':'District 25B','state_postal':'25B','row':9,'column':3,'color_value':0},
        {'state_full':'District 24B','state_postal':'24B','row':9,'column':4,'color_value':46},
        {'state_full':'District 25A','state_postal':'25A','row':9,'column':5,'color_value':0},
        {'state_full':'District 28A','state_postal':'28A','row':9,'column':6,'color_value':51},
        {'state_full':'District 22A','state_postal':'22A','row':10,'column':0,'color_value':42},
        {'state_full':'District 22B','state_postal':'22B','row':10,'column':1,'color_value':43},
        {'state_full':'District 24A','state_postal':'24A','row':10,'column':2,'color_value':45},
        {'state_full':'District 26B','state_postal':'26B','row':10,'column':3,'color_value':48},
        {'state_full':'District 26A','state_postal':'26A','row':10,'column':4,'color_value':47},
        {'state_full':'District 27A','state_postal':'27A','row':10,'column':5,'color_value':49},
        {'state_full':'District 27B','state_postal':'27B','row':10,'column':6,'color_value':50},
        {'state_full':'District 28B','state_postal':'28B','row':10,'column':7,'color_value':52}
        ]

var mnsenMetroCarto = [{'state_full':'District 30','state_postal':'30','row':0,'column':2,'color_value':53},
        {'state_full':'District 30','state_postal':'30','row':0,'column':3,'color_value':54},
        {'state_full':'District 35','state_postal':'35','row':0,'column':4,'color_value':61},
        {'state_full':'District 35','state_postal':'35','row':0,'column':5,'color_value':62},
        {'state_full':'District 31','state_postal':'31','row':0,'column':6,'color_value':55},
        {'state_full':'District 32','state_postal':'32','row':0,'column':7,'color_value':57},
        {'state_full':'District 34','state_postal':'34','row':1,'column':1,'color_value':0},
        {'state_full':'District 36','state_postal':'36','row':1,'column':2,'color_value':63},
        {'state_full':'District 36','state_postal':'36','row':1,'column':3,'color_value':64},
        {'state_full':'District 37','state_postal':'37','row':1,'column':4,'color_value':65},
        {'state_full':'District 37','state_postal':'37','row':1,'column':5,'color_value':66},
        {'state_full':'District 38','state_postal':'38','row':1,'column':6,'color_value':67},
        {'state_full':'District 38','state_postal':'38','row':1,'column':7,'color_value':68},
        {'state_full':'District 39','state_postal':'39','row':1,'column':8,'color_value':69},
        {'state_full':'District 34','state_postal':'34','row':2,'column':1,'color_value':60},
        {'state_full':'District 40','state_postal':'40','row':2,'column':2,'color_value':71},
        {'state_full':'District 40','state_postal':'40','row':2,'column':3,'color_value':72},
        {'state_full':'District 41','state_postal':'41','row':2,'column':4,'color_value':73},
        {'state_full':'District 41','state_postal':'41','row':2,'column':5,'color_value':74},
        {'state_full':'District 42','state_postal':'42','row':2,'column':6,'color_value':75},
        {'state_full':'District 42','state_postal':'42','row':2,'column':7,'color_value':76},
        {'state_full':'District 43','state_postal':'43','row':2,'column':8,'color_value':77},
        {'state_full':'District 44','state_postal':'44','row':3,'column':0,'color_value':79},
        {'state_full':'District 45','state_postal':'45','row':3,'column':1,'color_value':81},
        {'state_full':'District 45','state_postal':'45','row':3,'column':2,'color_value':82},
        {'state_full':'District 59','state_postal':'59','row':3,'column':3,'color_value':108},
        {'state_full':'District 60','state_postal':'60','row':3,'column':4,'color_value':110},
        {'state_full':'District 66','state_postal':'66','row':3,'column':5,'color_value':122},
        {'state_full':'District 66','state_postal':'66','row':3,'column':6,'color_value':123},
        {'state_full':'District 67','state_postal':'67','row':3,'column':7,'color_value':124},
        {'state_full':'District 43','state_postal':'43','row':3,'column':8,'color_value':78},
        {'state_full':'District 39','state_postal':'39','row':3,'column':9,'color_value':70},
        {'state_full':'District 44','state_postal':'44','row':4,'column':1,'color_value':80},
        {'state_full':'District 46','state_postal':'46','row':4,'column':2,'color_value':83},
        {'state_full':'District 59','state_postal':'59','row':4,'column':3,'color_value':109},
        {'state_full':'District 60','state_postal':'60','row':4,'column':4,'color_value':111},
        {'state_full':'District 64','state_postal':'64','row':4,'column':5,'color_value':118},
        {'state_full':'District 65','state_postal':'65','row':4,'column':6,'color_value':120},
        {'state_full':'District 67','state_postal':'67','row':4,'column':7,'color_value':125},
        {'state_full':'District 53','state_postal':'53','row':4,'column':8,'color_value':96},
        {'state_full':'District 33','state_postal':'33','row':5,'column':1,'color_value':59},
        {'state_full':'District 46','state_postal':'46','row':5,'column':2,'color_value':84},
        {'state_full':'District 61','state_postal':'61','row':5,'column':3,'color_value':112},
        {'state_full':'District 62','state_postal':'62','row':5,'column':4,'color_value':114},
        {'state_full':'District 63','state_postal':'63','row':5,'column':5,'color_value':116},
        {'state_full':'District 65','state_postal':'65','row':5,'column':6,'color_value':121},
        {'state_full':'District 53','state_postal':'53','row':5,'column':7,'color_value':96},
        {'state_full':'District 54','state_postal':'54','row':5,'column':8,'color_value':99},
        {'state_full':'District 48','state_postal':'48','row':6,'column':1,'color_value':86},
        {'state_full':'District 49','state_postal':'49','row':6,'column':2,'color_value':88},
        {'state_full':'District 61','state_postal':'61','row':6,'column':3,'color_value':113},
        {'state_full':'District 62','state_postal':'62','row':6,'column':4,'color_value':115},
        {'state_full':'District 63','state_postal':'63','row':6,'column':5,'color_value':117},
        {'state_full':'District 64','state_postal':'64','row':6,'column':6,'color_value':119},
        {'state_full':'District 52','state_postal':'52','row':6,'column':7,'color_value':94},
        {'state_full':'District 54','state_postal':'54','row':6,'column':8,'color_value':98},
        {'state_full':'District 47','state_postal':'47','row':7,'column':1,'color_value':0},
        {'state_full':'District 48','state_postal':'48','row':7,'column':2,'color_value':87},
        {'state_full':'District 49','state_postal':'49','row':7,'column':3,'color_value':89},
        {'state_full':'District 50','state_postal':'50','row':7,'column':4,'color_value':90},
        {'state_full':'District 50','state_postal':'50','row':7,'column':5,'color_value':91},
        {'state_full':'District 51','state_postal':'51','row':7,'column':6,'color_value':92},
        {'state_full':'District 51','state_postal':'51','row':7,'column':7,'color_value':93},
        {'state_full':'District 52','state_postal':'52','row':7,'column':8,'color_value':95},
        {'state_full':'District 55','state_postal':'55','row':8,'column':2,'color_value':100},
        {'state_full':'District 55','state_postal':'55','row':8,'column':3,'color_value':101},
        {'state_full':'District 56','state_postal':'56','row':8,'column':4,'color_value':102},
        {'state_full':'District 56','state_postal':'56','row':8,'column':5,'color_value':103},
        {'state_full':'District 58','state_postal':'58','row':8,'column':6,'color_value':109},
        {'state_full':'District 57','state_postal':'57','row':8,'column':7,'color_value':104},
        {'state_full':'District 57','state_postal':'57','row':8,'column':8,'color_value':105}
        ]

var mnsenMNCarto = [{'state_full':'District 1','state_postal':'1','row':0,'column':0,'color_value':1},
        {'state_full':'District 2','state_postal':'2','row':-1,'column':1,'color_value':3},
        {'state_full':'District 1','state_postal':'1','row':0,'column':1,'color_value':2},
        {'state_full':'District 2','state_postal':'2','row':0,'column':2,'color_value':4},
        {'state_full':'District 6','state_postal':'6','row':0,'column':3,'color_value':11},
        {'state_full':'District 6','state_postal':'6','row':0,'column':4,'color_value':12},
        {'state_full':'District 3','state_postal':'3','row':0,'column':5,'color_value':6},
        {'state_full':'District 3','state_postal':'3','row':0,'column':6,'color_value':5},
        {'state_full':'District 4','state_postal':'4','row':1,'column':0,'color_value':7},
        {'state_full':'District 4','state_postal':'4','row':1,'column':1,'color_value':8},
        {'state_full':'District 5','state_postal':'5','row':1,'column':2,'color_value':9},
        {'state_full':'District 5','state_postal':'5','row':1,'column':3,'color_value':10},
        {'state_full':'District 7','state_postal':'7','row':1,'column':4,'color_value':14},
        {'state_full':'District 7','state_postal':'7','row':1,'column':5,'color_value':13},
        {'state_full':'District 8','state_postal':'8','row':2,'column':0,'color_value':15},
        {'state_full':'District 8','state_postal':'8','row':2,'column':1,'color_value':16},
        {'state_full':'District 10','state_postal':'10','row':2,'column':2,'color_value':19},
        {'state_full':'District 10','state_postal':'10','row':2,'column':3,'color_value':20},
        {'state_full':'District 11','state_postal':'11','row':2,'column':4,'color_value':21},
        {'state_full':'District 12','state_postal':'12','row':3,'column':0,'color_value':23},
        {'state_full':'District 9','state_postal':'9','row':3,'column':1,'color_value':17},
        {'state_full':'District 9','state_postal':'9','row':3,'column':2,'color_value':18},
        {'state_full':'District 15','state_postal':'15','row':3,'column':3,'color_value':29},
        {'state_full':'District 11','state_postal':'11','row':3,'column':4,'color_value':22},
        {'state_full':'District 12','state_postal':'12','row':4,'column':0,'color_value':24},
        {'state_full':'District 13','state_postal':'13','row':4,'column':1,'color_value':25},
        {'state_full':'District 13','state_postal':'13','row':4,'column':2,'color_value':0},
        {'state_full':'District 15','state_postal':'15','row':4,'column':3,'color_value':28},
        {'state_full':'District 32','state_postal':'32','row':4,'column':4,'color_value':56},
        {'state_full':'District 17','state_postal':'17','row':5,'column':0,'color_value':32},
        {'state_full':'District 17','state_postal':'17','row':5,'column':1,'color_value':33},
        {'state_full':'District 14','state_postal':'14','row':5,'column':2,'color_value':26},
        {'state_full':'District 14','state_postal':'14','row':5,'column':3,'color_value':27},
        {'state_full':'District 31','state_postal':'31','row':5,'column':4,'color_value':0},
        {'state_full':'District 15','state_postal':'15','row':6,'column':0,'color_value':28},
        {'state_full':'District 18','state_postal':'18','row':6,'column':1,'color_value':34},
        {'state_full':'District 29','state_postal':'29','row':6,'column':2,'color_value':0},
        {'state_full':'District 29','state_postal':'29','row':6,'column':3,'color_value':0},
        {'state_full':'District 16','state_postal':'16','row':7,'column':0,'color_value':31},
        {'state_full':'District 18','state_postal':'18','row':7,'column':1,'color_value':35},
        {'state_full':'District 47','state_postal':'47','row':7,'column':2,'color_value':85},
        {'state_full':'District 33','state_postal':'33','row':7,'column':3,'color_value':58},
        {'state_full':'District 19','state_postal':'19','row':8,'column':0,'color_value':36},
        {'state_full':'District 20','state_postal':'20','row':8,'column':1,'color_value':38},
        {'state_full':'District 20','state_postal':'20','row':8,'column':2,'color_value':39},
        {'state_full':'District 58','state_postal':'58','row':8,'column':3,'color_value':103},
        {'state_full':'District 21','state_postal':'21','row':8,'column':4,'color_value':40},
        {'state_full':'District 21','state_postal':'21','row':8,'column':5,'color_value':41},
        {'state_full':'District 22','state_postal':'22','row':9,'column':0,'color_value':43},
        {'state_full':'District 19','state_postal':'19','row':9,'column':1,'color_value':37},
        {'state_full':'District 23','state_postal':'23','row':9,'column':2,'color_value':0},
        {'state_full':'District 25','state_postal':'25','row':9,'column':3,'color_value':0},
        {'state_full':'District 24','state_postal':'24','row':9,'column':4,'color_value':46},
        {'state_full':'District 25','state_postal':'25','row':9,'column':5,'color_value':0},
        {'state_full':'District 28','state_postal':'28','row':9,'column':6,'color_value':51},
        {'state_full':'District 22','state_postal':'22','row':10,'column':0,'color_value':42},
        {'state_full':'District 22','state_postal':'22','row':10,'column':1,'color_value':43},
        {'state_full':'District 24','state_postal':'24','row':10,'column':2,'color_value':45},
        {'state_full':'District 26','state_postal':'26','row':10,'column':3,'color_value':48},
        {'state_full':'District 26','state_postal':'26','row':10,'column':4,'color_value':47},
        {'state_full':'District 27','state_postal':'27','row':10,'column':5,'color_value':49},
        {'state_full':'District 27','state_postal':'27','row':10,'column':6,'color_value':50},
        {'state_full':'District 28','state_postal':'28','row':10,'column':7,'color_value':52}
        ]

var mnCDCarto = [{'state_full':'Congressional District 7','state_postal':'7','row':0,'column':0,'color_value':6},
        {'state_full':'Congressional District 8','state_postal':'8','row':0,'column':1,'color_value':7},
        {'state_full':'Congressional District 6','state_postal':'6','row':1,'column':0,'color_value':5},
        {'state_full':'Congressional District 3','state_postal':'3','row':1,'column':1,'color_value':2},
        {'state_full':'Congressional District 5','state_postal':'5','row':2,'column':0,'color_value':4},
        {'state_full':'Congressional District 4','state_postal':'4','row':2,'column':1,'color_value':3},
        {'state_full':'Congressional District 1','state_postal':'1','row':3,'column':0,'color_value':0},
        {'state_full':'Congressional District 2','state_postal':'2','row':3,'column':1,'color_value':1}
        ]

if (race=="president" && geo=="us"){ return usCarto; }
if (race=="president" && geo=="mn"){ return mnCarto; }

if (race=="ushouse" && geo=="us"){ return usCDCarto; }
if (race=="ushouse" && geo=="mn"){ return mnCDCarto; }

if (race=="senate" && geo=="us"){ return usCarto; }
if (race=="senate" && geo=="mn"){ return mnCarto; }

if (race=="mnhouse" && geo=="mn"){ return mnlegMNCarto; }
if (race=="mnhouse" && geo=="metro"){ return mnlegMetroCarto; }

if (race=="mnsenate" && geo=="mn"){ return mnsenMNCarto; }
if (race=="mnsenate" && geo=="metro"){ return mnsenMetroCarto; }

if (race=="governors" && geo=="us"){ return usCarto; }
} //end cartoData

//US HOUSE CARTOGRAM
(function(){
    var margin = {top: 10, left: 10, bottom: 50, right: 10}
    , width = 800
    , width = width - margin.left - margin.right
    , mapRatio = .5
    , height = 800;

    var projection = d3.geo.equirectangular()
              .scale(width/1.3)//this makes it larger or smaller for the space you have
              .translate([width / 4, height / 2.5])
              .center([-102, 47 ]); //move the map center to fit in the spsace

    var path = d3.geo.path()
          .projection(projection);

    var svg = d3.select("#house .carto svg")
          .attr("width", width)
          .attr("height", height);

    var g = svg.append("g").attr('transform',"translate(150,25)").attr('class','house-group-g');

    makeCartogram();

function makeCartogram() {
        d3.json("shapefiles/usdistricts_cartogram.json", function(error, us) {

            g.append("g").attr("id", "districts").selectAll("path")
            .data(topojson.feature(us, us.objects['cart113']).features)
            .enter().append("path")
                .attr("d", path)
                .attr("class", function(d){return 'district ' + d.properties.State,false,null + '-' + d.properties['d'] + '-House'})
                .attr('data-hash-key',function(d){ return d.properties.State + '-' + d.properties['d']});
            g.append("g")
            .attr("id", "states")
            .selectAll("path")
            .data(topojson.feature(us, us.objects.states).features)
            .enter().append("path")
            .attr("d", path)
            .attr('class', function(d){return 'state ' + d.properties.State.replace(/ /g,'')})
            .attr('data-hash-key', function(d){ return d.properties.State});
        })
    }
})();

//map functions
function mapReshade(container, shape, subject, race, dataCompare, visible, demoData, demoData2) {
d3.selectAll(container + " svg g path")
      .data(us.features)
      .style("opacity",visible)
      .attr("class", function(d){
        return "orange2";
        });

} //end mapReshade

function mapColor(d, race, dataCompare, demoData, demoData2){
  
if (race == "president"){
  var color_scaleD = d3.scale.linear().domain([.48,1]).range(['#67B4C2','#022642']);
  var color_scaleR = d3.scale.linear().domain([.48,1]).range(['#FF8572','#4E0002']);

  for (var i=0; i < dataCompare.length; i++){
    var district = d;
    if (district == dataCompare[i].district){
      if (dataCompare[i].party == "GOP") { 
        return color_scaleR(dataCompare[i].r_pct);
        if (dataCompare[i].r_pct >= .80) { return "r4"; }
        else if (dataCompare[i].r_pct >= .70) { return "r3"; }
        else if (dataCompare[i].r_pct >= .60) { return "r2"; }
        else if (dataCompare[i].r_pct >= .50) { return "r1"; }
      }
      if (dataCompare[i].party == "DEM") { 
        return color_scaleD(dataCompare[i].d_pct);
        if (dataCompare[i].d_pct >= .80) { return "d4"; }
        else if (dataCompare[i].d_pct >= .70) { return "d3"; }
        else if (dataCompare[i].d_pct >= .60) { return "d2"; }
        else if (dataCompare[i].d_pct >= .50) { return "d1"; }
      }
    }
  }
}

if (race == "cd"){
  var color_scaleD = d3.scale.linear().domain([48,1]).range(['#67B4C2','#022642']);
  var color_scaleR = d3.scale.linear().domain([48,1]).range(['#FF8572','#4E0002']);

  for (var i=0; i < dataCompare.length; i++){
    var district = d;
    if (district == dataCompare[i].district){
      if (dataCompare[i].party == "GOP") { 
        return color_scaleR(dataCompare[i].r_pct);
        if (dataCompare[i].r_pct >= 80) { return "r4"; }
        else if (dataCompare[i].r_pct >= 70) { return "r3"; }
        else if (dataCompare[i].r_pct >= 60) { return "r2"; }
        else if (dataCompare[i].r_pct >= 50) { return "r1"; }
      }
      if (dataCompare[i].party == "DEM") { 
        return color_scaleD(dataCompare[i].d_pct);
        if (dataCompare[i].d_pct >= 80) { return "d4"; }
        else if (dataCompare[i].d_pct >= 70) { return "d3"; }
        else if (dataCompare[i].d_pct >= 60) { return "d2"; }
        else if (dataCompare[i].d_pct >= 50) { return "d1"; }
      }
    }
  }
}

if (race == "county"){
  var color_scaleD = d3.scale.linear().domain([48,100]).range(['#67B4C2','#022642']);
  var color_scaleR = d3.scale.linear().domain([48,100]).range(['#FF8572','#4E0002']);

  for (var i=0; i < dataCompare.length; i++){
    var district = d;
    if (Number(district) == Number(dataCompare[i].FIPS)){
      if (dataCompare[i].winner == "GOP") { 
        return color_scaleR(dataCompare[i].r_pct);
        if (dataCompare[i].r_pct >= 80) { return "r4"; }
        else if (dataCompare[i].r_pct >= 70) { return "r3"; }
        else if (dataCompare[i].r_pct >= 60) { return "r2"; }
        else if (dataCompare[i].r_pct >= 50) { return "r1"; }
      }
      if (dataCompare[i].winner == "DEM") { 
        return color_scaleD(dataCompare[i].d_pct);
        if (dataCompare[i].d_pct >= 80) { return "d4"; }
        else if (dataCompare[i].d_pct >= 70) { return "d3"; }
        else if (dataCompare[i].d_pct >= 60) { return "d2"; }
        else if (dataCompare[i].d_pct >= 50) { return "d1"; }
    }
  }
 }
}

if (race == "pct"){
  var color_scaleD = d3.scale.linear().domain([48,100]).range(['#67B4C2','#022642']);
  var color_scaleR = d3.scale.linear().domain([48,100]).range(['#FF8572','#4E0002']);

  for (var i=0; i < dataCompare.length; i++){
    var district = d;
    if (Number(district) == Number(dataCompare[i].pct_id)){
      if (dataCompare[i].party_id == "R" && dataCompare[i].vote_pct >= 48) { 
        // return color_scaleR(dataCompare[i].vote_pct);
        if (dataCompare[i].vote_pct >= 80) { return "#8C1B17"; }
        else if (dataCompare[i].vote_pct >= 70) { return "#A52129"; }
        else if (dataCompare[i].vote_pct >= 60) { return "#A5484D"; }
        else if (dataCompare[i].vote_pct >= 48) { return "#C68985"; }
      }
      if (dataCompare[i].party_id == "DFL" && dataCompare[i].vote_pct >= 48) { 
        // return color_scaleD(dataCompare[i].vote_pct);
        if (dataCompare[i].vote_pct >= 80) { return "#3f88c5"; }
        else if (dataCompare[i].vote_pct >= 70) { return "#4f97c4"; }
        else if (dataCompare[i].vote_pct >= 60) { return "#5ca5c3"; }
        else if (dataCompare[i].vote_pct >= 48) { return "#ABCEE8"; }
      }
    }
  }
}


    return "#ddd";
} //end mapColor

function mapTips(d, subject, dataCompare, level){

if (subject == "president"){
for (var i=0; i < dataCompare.length; i++){
  var district = d;

  if (district == dataCompare[i].district){
      if (dataCompare[i].party == "GOP") { 
        if  (dataCompare[i].PCT2012 >= .80) { return "<div class='name'><strong>" + dataCompare[i].district + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r4'>" +  d3.format("%")(dataCompare[i].PCT2012) + " 2012 WIN</div><div>" + dataCompare[i].ev + " electoral votes</div>"; }
        else if  (dataCompare[i].PCT2012 >= .70) { return "<div><strong>" + d.district + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r3'>" +  d3.format("%")(dataCompare[i].PCT2012) + " 2012 WIN</div><div>" + dataCompare[i].ev + " electoral votes</div>"; }
        else if  (dataCompare[i].PCT2012 >= .60) { return "<div><strong>" + dataCompare[i].district + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r2'>" +  d3.format("%")(dataCompare[i].PCT2012) + " 2012 WIN</div><div>" + dataCompare[i].ev + " electoral votes</div>"; }
        else if  (dataCompare[i].PCT2012 >= .50) { return "<div><strong>" + dataCompare[i].district + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r1'>" +  d3.format("%")(dataCompare[i].PCT2012) + " 2012 WIN</div><div>" + dataCompare[i].ev + " electoral votes</div>"; }
      }
      else if (dataCompare[i].party == "DEM") { 
        if  (dataCompare[i].PCT2012 >= .80) { return "<div class='name'><strong>" + dataCompare[i].district + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d4'>" +  d3.format("%")(dataCompare[i].PCT2012) + " 2012 WIN</div><div>" + dataCompare[i].ev + " electoral votes</div>"; }
        else if  (dataCompare[i].PCT2012 >= .70) { return "<div><strong>" + dataCompare[i].district + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d3'>" +  d3.format("%")(d.PCT2012) + " 2012 WIN</div><div>" + dataCompare[i].ev + " electoral votes</div>"; }
        else if  (dataCompare[i].PCT2012 >= .60) { return "<div><strong>" + dataCompare[i].district + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d2'>" +  d3.format("%")(d.PCT2012) + " 2012 WIN</div><div>" + dataCompare[i].ev + " electoral votes</div>"; }
        else if  (dataCompare[i].PCT2012 >= .50) { return "<div><strong>" + dataCompare[i].district + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d1'>" +  d3.format("%")(dataCompare[i].PCT2012) + " 2012 WIN</div><div>" + dataCompare[i].ev + " electoral votes</div>"; }
      }
    } 
  }
 return "<div><strong>" + district + "</strong></div>";
}
else if (subject == "county"){
for (var i=0; i < dataCompare.length; i++){
  var district = d;

  if (Number(district) == Number(dataCompare[i].FIPS)){
      if (dataCompare[i].winner == "GOP") { 
        if  (dataCompare[i].r_pct >= 80) { return "<div class='name'><strong>" + dataCompare[i].county + " County , " + dataCompare[i].ab + "</strong></div><div>Romney</div><div class='r4'>" +  dataCompare[i].r_pct + "% 2012 WIN</div>"; }
        else if  (dataCompare[i].r_pct >= 70) { return "<div class='name'><strong>" + dataCompare[i].county + " County , " + dataCompare[i].ab + "</strong></div><div>Romney</div><div class='r3'>" +  dataCompare[i].r_pct + "% 2012 WIN</div>"; }
        else if  (dataCompare[i].r_pct >= 60) { return "<div class='name'><strong>" + dataCompare[i].county + " County , " + dataCompare[i].ab + "</strong></div><div>Romney</div><div class='r2'>" +  dataCompare[i].r_pct + "% 2012 WIN</div>"; }
        else if  (dataCompare[i].r_pct >= 50) { return "<div class='name'><strong>" + dataCompare[i].county + " County , " + dataCompare[i].ab + "</strong></div><div>Romney</div><div class='r1'>" +  dataCompare[i].r_pct + "% 2012 WIN</div>"; }
      }
      else if (dataCompare[i].winner == "DEM") { 
        if  (dataCompare[i].d_pct >= 80) { return "<div class='name'><strong>" + dataCompare[i].county + " County , " + dataCompare[i].ab + "</strong></div><div>Obama</div><div class='d4'>" +  dataCompare[i].d_pct + "% 2012 WIN</div>"; }
        else if  (dataCompare[i].d_pct >= 70) { return "<div class='name'><strong>" + dataCompare[i].county + " County , " + dataCompare[i].ab + "</strong></div><div>Obama</div><div class='d3'>" +  dataCompare[i].d_pct + "% 2012 WIN</div>"; }
        else if  (dataCompare[i].d_pct >= 60) { return "<div class='name'><strong>" + dataCompare[i].county + " County , " + dataCompare[i].ab + "</strong></div><div>Obama</div><div class='d2'>" +  dataCompare[i].d_pct + "% 2012 WIN</div>"; }
        else if  (dataCompare[i].d_pct >= 50) { return "<div class='name'><strong>" + dataCompare[i].county + " County , " + dataCompare[i].ab + "</strong></div><div>Obama</div><div class='d1'>" +  dataCompare[i].d_pct + "% 2012 WIN</div>"; }
      }
   } 
 }

return "<div><strong>" + district + "</strong></div>";

}
else if (subject == "pct"){
for (var i=0; i < dataCompare.length; i++){
  if (Number(d.properties.PCTCODE) == dataCompare[i].pct_id){
          if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct >= 80) { return "<div class='name'><strong>" + d.properties.PCTNAME + "</strong></div><div>" + dataCompare[i].candidate +"</div><div class='r4'>" +  dataCompare[i].vote_pct + "% 2012 WIN</div>"; }
        else if (dataCompare[i].vote_pct >= 70) { return "<div class='name'><strong>" + d.properties.PCTNAME + "</strong></div><div>" + dataCompare[i].candidate +"</div><div class='r3'>" +  dataCompare[i].vote_pct + "% 2012 WIN</div>"; }
        else if (dataCompare[i].vote_pct >= 60) { return "<div class='name'><strong>" + d.properties.PCTNAME + "</strong></div><div>" + dataCompare[i].candidate +"</div><div class='r2'>" +  dataCompare[i].vote_pct + "% 2012 WIN</div>"; }
        else if  (dataCompare[i].vote_pct >= 50) { return "<div class='name'><strong>" + d.properties.PCTNAME + "</strong></div><div>" + dataCompare[i].candidate +"</div><div class='r1'>" +  dataCompare[i].vote_pct + "% 2012 WIN</div>"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct >= 80) { return "<div class='name'><strong>" + d.properties.PCTNAME + "</strong></div><div>" + dataCompare[i].candidate +"</div><div class='d3'>" +  dataCompare[i].vote_pct + "% 2012 WIN</div>"; }
        else if  (dataCompare[i].vote_pct >= 70) { return "<div class='name'><strong>" + d.properties.PCTNAME + "</strong></div><div>" + dataCompare[i].candidate +"</div><div class='d3'>" +  dataCompare[i].vote_pct + "% 2012 WIN</div>"; }
        else if  (dataCompare[i].vote_pct >= 60) { return "<div class='name'><strong>" + d.properties.PCTNAME + "</strong></div><div>" + dataCompare[i].candidate +"</div><div class='d2'>" +  dataCompare[i].vote_pct + "% 2012 WIN</div>"; }
        else if  (dataCompare[i].vote_pct >= 50) { return "<div class='name'><strong>" + d.properties.PCTNAME + "</strong></div><div>" + dataCompare[i].candidate +"</div><div class='d1'>" +  dataCompare[i].vote_pct + "% 2012 WIN</div>"; }
      }
    }
  }

  return "<div class='name'><strong>" + d.properties.PCTNAME + "</strong></div>"
}


} //end mapTips


function mapBuild(container, boxContainer, chartContainer, shape, race, geo, level, dataCompare, index, visible) {

if (geo=="us") { var width = 800, height = 600, centered; var projection = d3.geo.albersUsa().scale(1000).translate([400, 210]); }
else if (geo=="mn") { var width = 350, height = 350, centered; var projection = d3.geo.mercator().scale([3200]).center([-89.736328,46.377254]); }
else if (geo=="metro") { var width = 350, height = 350, centered; var projection = d3.geo.mercator().scale([16500]).center([-92.403259,44.988113]); }

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select(container + " svg")
    .attr("width", width)
    .attr("height", height);

// svg.append("rect")
//     .attr("class", "background " + race + " " + level)
//     .attr("width", width)
//     .attr("height", height);

var g = svg.append("g").attr("class", "mappage states " + race + " " + level);

d3.json("shapefiles/" + shape, function(error, us) {

  g.selectAll("path")
      .data(us.features)
    .enter().append("path")
      .attr("d", path)
      .on("click", clicked)
      .attr("id", function(d) { var str = d.properties.NAME + "_" + geo; return str.replace(new RegExp(" ", "g"),"-"); })
      .attr("precinctName", function(d){ return d.properties.NAME })
      .style("fill", function(d){
         if (race == "president" || race == "senate" || race == "governors") { return fetchData(d.properties.NAME,d.properties.NAME,"colors",dataCompare,race); }
         else if (race == "county") { return fetchData(d.properties.GEOID,null,"colors",dataCompare,race); }
         else if (race == "pct") { return mapColor(d.properties.PCTCODE, race, dataCompare); }
         else if (race == "house") { return fetchData(d.properties.NAME,d.properties.NAME,"colors",dataCompare,race); }
         else if (race == "mnsenate" || race == "mnhouse") { return fetchData("District " + d.properties.DISTRICT,"Minnesota","colors",dataCompare,race); }
        })
       .on("mousedown", function(d, i){

        var str = d.properties.NAME; 
        $(".district").removeClass("selected");
        // $("#" + str.replace(new RegExp(" ", "g"),"-")).addClass("selected");
        
      
if (race == "president" || race == "senate" ||  race == "governors"){ $("#infobox").html(fetchData(d.properties.NAME,d.properties.NAME,"table",dataCompare,race)); }
else if (race == "county"){ $("#infobox").html(fetchData(d.properties.GEOID,null,"table",dataCompare,race,null,d.properties.NAME)); }
else if (race == "mnsenate" || race == "mnhouse") { $("#infobox").html(fetchData("District " + d.properties.DISTRICT,"Minnesota","table",dataCompare,race,null,"District " + d.properties.DISTRICT)); }

else if (race == "pct"){
              $("#candidatePCTR, #candidatePCTD").removeClass("d4");
              $("#candidatePCTR, #candidatePCTD").removeClass("d3");
              $("#candidatePCTR, #candidatePCTD").removeClass("d2");
              $("#candidatePCTR, #candidatePCTD").removeClass("d1");
              $("#candidatePCTR, #candidatePCTD").removeClass("r4");
              $("#candidatePCTR, #candidatePCTD").removeClass("r3");
              $("#candidatePCTR, #candidatePCTD").removeClass("r2");
              $("#candidatePCTR, #candidatePCTD").removeClass("r1");
              $("#pctReported").html(0);
              $("#pctAll").html(0);
              $("#pctPCT").html(0);

    for (var i=0; i < dataCompare.length; i++){
    if (Number(d.properties.PCTCODE) == Number(dataCompare[i].pct_id)){
      if (dataCompare[i].party_id == "R" && dataCompare[i].vote_pct >= 48) { 
        $("#candidatePCTR").html(dataCompare[i].vote_pct + "%");
        $("#candidateVotesR").html(0);
        $("#candidatePCTR").css("background-color", mapColor(d.properties.PCTCODE, race, dataCompare));
      }
      if (dataCompare[i].party_id == "DFL" && dataCompare[i].vote_pct >= 48) { 
        $("#candidateVotesD").html(0);
        $("#candidatePCTD").html(dataCompare[i].vote_pct + "%");
        $("#candidatePCTD").css("background-color", mapColor(d.properties.PCTCODE, race, dataCompare));
      }
    }
  }
}
       })
      .style("stroke-width", "0")
      .style("stroke", "#fff")
      .call(d3.helper.tooltip(function(d, i){
         if (race == "president" || race == "senate" || race == "governors") { return fetchData(d.properties.NAME,d.properties.NAME,"tooltip",dataCompare,race); }
         else if (race == "county") { return fetchData(d.properties.GEOID,null,"tooltip",dataCompare,race,"Minnesota",d.properties.NAME); }
         else if (race == "pct") { return mapTips(d, race, dataCompare, level); }
         else if (race == "mnsenate" || race == "mnhouse") { return fetchData("District " + d.properties.DISTRICT,"Minnesota","tooltip",dataCompare,race,null,"District " + d.properties.DISTRICT); }
      }));

  g.append("path")
      //.datum(topojson.mesh(us, us.features, function(a, b) { return a !== b; }))
      .attr("class", "state-borders")
      .attr("d", path);

});

var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("circle")
            .attr("d", path.projection(projection));
        g.selectAll("path")
            .attr("d", path.projection(projection));

  });

$(".zoom").click(function() {
  clicked2();
  $("#infobox").html("");
  $(".bar").removeClass("selected");
  d3.selectAll("rect").classed('active', false); 
  d3.selectAll("rect").classed('faded', false); 
  d3.selectAll("text").classed('active', false); 
  d3.selectAll("text").classed('faded', false); 
  $("#candidatePCTR").html("47.2%");
  $("#candidatePCTD").html("51.1%");
  $("#candidatePCTR, #candidatePCTD").removeClass("d4");
  $("#candidatePCTR, #candidatePCTD").removeClass("d3");
  $("#candidatePCTR, #candidatePCTD").removeClass("d2");
  $("#candidatePCTR, #candidatePCTD").removeClass("d1");
  $("#candidatePCTR, #candidatePCTD").removeClass("r4");
  $("#candidatePCTR, #candidatePCTD").removeClass("r3");
  $("#candidatePCTR, #candidatePCTD").removeClass("r2");
  $("#candidatePCTR, #candidatePCTD").removeClass("r1");
});

$(".uszoom").click(function() {
  clicked2();
});

$(".mnzoom").click(function() {
    $("#pctzoom").show();
    mnzoom();
});

$(".metrozoom").click(function() {
    $("#pctzoom").show();
    metrozoom();
});

function clicked(d) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    console.log(centroid + " " + x + " " + y);
    k = 3;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 3;
    centered = null;
  }

  g.selectAll("." + race + " path")
      .classed("faded", true)
      .classed("active", centered && function(d) { return d === centered; });

  g.transition()
      .duration(750)
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      // .style("stroke-width", 1.5 / k + "px");

  g.selectAll("path").style("stroke-width", "0");
}

function mnzoom(d) {
  var x, y, k;

    var centroid = path.centroid(d);
    x = 429.8542649319006;
    y = 76.27472769218944;
    k = 5;

  g.transition()
      .duration(750)
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", "0");

  g.selectAll("path").style("stroke-width", "0");
}

function metrozoom(d) {
  var x, y, k;

    var centroid = path.centroid(d);
    x = 439.8542649319006;
    y = 103.27472769218944;
    k = 25;

  g.transition()
      .duration(750)
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", "0");

  g.selectAll("path").style("stroke-width", "0");
}

function clicked2(d) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 1;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("." + race + " path")
      .classed("faded", false)
      .classed("active", centered && function(d) { return d === centered; });

  g.transition()
      .duration(750)
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      // .style("stroke-width","0.5px");

  g.selectAll("path").style("stroke-width", "0");
}

d3.helper = {};

d3.helper.tooltip = function(accessor){
    return function(selection){
        var tooltipDiv;
        var bodyNode = d3.select('body').node();
        selection.on("mouseover", function(d, i){
            // Clean up lost tooltips
            d3.select('body').selectAll('div.tooltip').remove();
            // Append tooltip
            tooltipDiv = d3.select('body').append('div').attr('class', 'tooltip');
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px')
                .style('position', 'absolute')
                .style('z-index', 1001);
            // Add text using the accessor function
            var tooltipText = accessor(d, i) || '';
            // Crop text arbitrarily
            //tooltipDiv.style('width', function(d, i){return (tooltipText.length > 80) ? '300px' : null;})
            //    .html(tooltipText);
        })
        .on('mousemove', function(d, i) {
            // Move tooltip
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px');
            var tooltipText = accessor(d, i) || '';
            tooltipDiv.html(tooltipText);
        })
        .on("mouseout", function(d, i){
            // Remove tooltip
            tooltipDiv.remove();
        });

    };
};

//RESPONSIVENESS

if (race != "mnsenate" && race != "mnhouse"){
var aspect = 800 / 600, chart = $(".map svg"), chart2 = $(".carto svg");

$(window).on("resize", function() {
  var targetWidth = chart.parent().width();
  chart.attr("width", targetWidth);
  chart.attr("height", targetWidth / aspect);
  var targetWidth2 = chart2.parent().width();
  chart2.attr("width", targetWidth2);
  chart2.attr("height", targetWidth2 / aspect);
});
} else {
var aspect = 320 / 350, chart = $(".map svg"), chart2 = $(".carto svg");

$(window).on("resize", function() {
  var targetWidth = chart.parent().width();
  chart.attr("width", targetWidth);
  chart.attr("height", targetWidth / aspect);
  var targetWidth2 = chart2.parent().width();
  chart2.attr("width", targetWidth2);
  chart2.attr("height", targetWidth2 / aspect);
});

}


} //end mapBuild


//history functions
var lineChart;
function buildLines(container,subject,rParty,dParty,rResults,dResults,years) {
var  padding = {
        top: 20,
        right: 40,
        bottom: 20,
        left: 40,
    };

lineChart = c3.generate({
        bindto: container,
        size: { height: 200 },
        padding: padding,
        data: {
        x: 'x',
        columns: [
            years,
            rResults,
            dResults
        ]
        },
       bar: {
        width: {
            ratio: 0.5 // this makes bar width 50% of length between ticks
        }
      },
        axis: {
          y: {
            tick: {
             max: .45,
             min: 0,
             count: 3
             // format: d3.format('%')
            }
        },
        x: {
            type: 'category',
            tick: {
                // format: '%Y',
                count: 3,
                multiline: false
            }
          }
        },
      subchart: { show: false },
        color: { pattern: ['#9C0004','#0D4773'] },
    });

var previous = "Metro";
} //end buildLines

//HISTORICAL DATA DUMP
function loadHistory(container,race,dParty,rParty){

//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=1bNmXI3Dq7XHcHs5UKIa9mHZjOJEm2nb9PHDrt54ToDw&sheet=races

//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=1dmWuUyYnLo9599ikNdLY5ZfbPkFk8pmSPUWhlpgAfUU&sheet=mn2012

d3.json("https://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=1bNmXI3Dq7XHcHs5UKIa9mHZjOJEm2nb9PHDrt54ToDw&sheet=races", function(error, json) {

var history = json.races;

d3.select(container).selectAll(".historyBox")
.data(history.filter(function(d){ return d.race == race; })).enter().append("div")
.attr("class","historyBox")
.html(function (d){ 
    return "<h2>" + d.date + ", " + d.year + "</h2><div class='mapThumb'><a href='./index.html?year=" + d.year + "&race=" + d.race + "&tab=map'><img src='./img/" + d.race + "_" + d.year + ".png' /></a><div class='smallbreak'></div></div><div class='yearCount'><div class='d_history'>" + d.d_party + "</div><div class='r_history'>" + d.r_party + "</div><div class='smallbreak'></div><div class='d_history'>" + d.d_count + "</div><div class='r_history'>" + d.r_count + "</div></div><div class='smallbreak'></div><div class='turnout'>Voter Turnout: " + d3.format("%")(d.turnout) + "</div>";
});

var dResults = [];
var rResults = [];
var years = [];

years[0] = 'x';
dResults[0] = dParty;
rResults[0] = rParty;

var index = 1;

 for (var i=0; i < history.length; i++){
  if (history[i].race == race){
    dResults[index] = history[i].d_count;
    rResults[index] = history[i].r_count;
    years[index] = String(history[i].year);
    index++;
  }
}

buildLines("#historyChart",race,rParty,dParty,rResults,dResults,years);

}); //end history

}

//show/hide parameters
$.urlParam = function(name){
  var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
  return results[1] || 0;
}

var race = $.urlParam('race');
$(".raceSwitch").removeClass("selected2");
$(".raceSwitch[data=" + race + "]").addClass("selected2");
// var year = $.urlParam('year');
// var tab = $.urlParam('tab');
// var geo = $.urlParam('geo');
// var district = $.urlParam('district');

// var race = "president";
// var year = 2012;
// var tab = "president";
// var geo = "country";
// var district = "us";

function mapShow(container, race){
 d3.selectAll(".mappage").each(function(i){
  if (!d3.select(this).classed(race)) { d3.select(this).style("display","none"); }
  else { d3.select(this).style("display","block"); }
 });
} //end mapShow

function mapSpill(race,data){

if (race == "president"){
  mapBuild("#president .geo", "#districtName", "#chart", "us_states.json", race, "us", "country", data);
  mapBuild("#president .geo", "#districtName", "#chart", "us_counties.json", "county", "us", "counties", data);
  mapBuild("#president .geo", "#districtName", "#chart", "us_congress.json", "cd", "us", "cd", data);

  d3.json("https://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=1dmWuUyYnLo9599ikNdLY5ZfbPkFk8pmSPUWhlpgAfUU&sheet=mnPCT2012", function(error, json) {

  var data = json.mnPCT2012;
  mapBuild("#president .geo", "#districtName", "#chart", "mnprecincts.json", "pct", "us", "pct", data);

  });

  cartoBuild("#president .carto", "#districtName", "#chart", null, race, data, "us", 0, cartoData(race,"us"));
  makeTable("president");

  //RESPONSIVENESS
var aspect = 800 / 600, chart = $(".map svg"), chart2 = $(".carto svg");
  var targetWidth = chart.parent().width();
  chart.attr("width", targetWidth);
  chart.attr("height", targetWidth / aspect);
  var targetWidth2 = chart2.parent().width();
  chart2.attr("width", targetWidth2);
  chart2.attr("height", targetWidth2 / aspect);
}

if (race == "local"){
  mapBuild("#local .geo", "#districtName", "#chart", "us_states.json", race, "mn", "country", data);
  mapBuild("#local .geo", "#districtName", "#chart", "us_counties.json", "county", "mn", "counties", data);
  mapBuild("#local .geo", "#districtName", "#chart", "us_congress.json", "cd", "mn", "cd", data);
  mapBuild("#local .geo", "#districtName", "#chart", "mnprecincts.json", "pct", "mn", "pct", data);
  cartoBuild("#local .carto", "#districtName", "#chart", null, race, data, "us", 0, cartoData(race,"us"));

  //RESPONSIVENESS
var aspect = 800 / 600, chart = $(".map svg"), chart2 = $(".carto svg");
  var targetWidth = chart.parent().width();
  chart.attr("width", targetWidth);
  chart.attr("height", targetWidth / aspect);
  var targetWidth2 = chart2.parent().width();
  chart2.attr("width", targetWidth2);
  chart2.attr("height", targetWidth2 / aspect);
}

if (race == "mnhouse"){
  mapBuild("#mnhouse .mapState", "#districtName", "#chart", "mnleg.json", race, "mn", "country", data);
  mapBuild("#mnhouse .mapMetro", "#districtName", "#chart", "mnleg_metro.json", race, "metro", "country", data);
  cartoBuild("#mnhouse .cartoState", "#districtName", "#chart", null, race, data, "us", 0, cartoData(race,"mn"));
  cartoBuild("#mnhouse .cartoMetro", "#districtName", "#chart", null, race, data, "us", 0, cartoData(race,"metro"));

  //RESPONSIVENESS
var aspect = 320 / 350, chart = $(".map svg"), chart2 = $(".carto svg");
  var targetWidth = chart.parent().width();
  chart.attr("width", targetWidth);
  chart.attr("height", targetWidth / aspect);
  var targetWidth2 = chart2.parent().width();
  chart2.attr("width", targetWidth2);
  chart2.attr("height", targetWidth2 / aspect);
}

if (race == "mnsenate"){
  mapBuild("#mnsenate .mapState", "#districtName", "#chart", "mnsenate.json", race, "mn", "country", data);
  mapBuild("#mnsenate .mapMetro", "#districtName", "#chart", "mnsenate_metro.json", race, "metro", "country", data);
  cartoBuild("#mnsenate .cartoState", "#districtName", "#chart", null, race, data, "us", 0, cartoData(race,"mn"));
  cartoBuild("#mnsenate .cartoMetro", "#districtName", "#chart", null, race, data, "us", 0, cartoData(race,"metro"));

  //RESPONSIVENESS
var aspect = 320 / 350, chart = $(".map svg"), chart2 = $(".carto svg");
  var targetWidth = chart.parent().width();
  chart.attr("width", targetWidth);
  chart.attr("height", targetWidth / aspect);
  var targetWidth2 = chart2.parent().width();
  chart2.attr("width", targetWidth2);
  chart2.attr("height", targetWidth2 / aspect);
}

if (race == "house"){
  mapBuild("#house .geo", "#districtName", "#chart", "us_congress.json", race, "us", "country", data);

  //RESPONSIVENESS
var aspect = 800 / 600, chart = $(".map svg"), chart2 = $(".carto svg");
  var targetWidth = chart.parent().width();
  chart.attr("width", targetWidth);
  chart.attr("height", targetWidth / aspect);
  var targetWidth2 = chart2.parent().width();
  chart2.attr("width", targetWidth2);
  chart2.attr("height", targetWidth2 / aspect);
}

if (race == "senate"){
  mapBuild("#senate .geo", "#districtName", "#chart", "us_states.json", race, "us", "country", data);
  mapBuild("#senate .geo", "#districtName", "#chart", "us_counties.json", "county", "us", "counties", data);
   d3.json("https://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=1Vk4a_VNKyqN20F1NdAAwKeHwtR0Z1oGRqXypYH4Ge_4&sheet=mnPCT2012", function(error, json) {

  var data = json.mnPCT2012;
  mapBuild("#senate .geo", "#districtName", "#chart", "mnprecincts.json", "pct", "us", "pct", data);

  });
  cartoBuild("#senate .carto", "#districtName", "#chart", null, race, data, "us", 0, cartoData(race,"us"));
  makeTable("president");

  //RESPONSIVENESS
var aspect = 800 / 600, chart = $(".map svg"), chart2 = $(".carto svg");
  var targetWidth = chart.parent().width();
  chart.attr("width", targetWidth);
  chart.attr("height", targetWidth / aspect);
  var targetWidth2 = chart2.parent().width();
  chart2.attr("width", targetWidth2);
  chart2.attr("height", targetWidth2 / aspect);
}

if (race == "governors"){
  mapBuild("#governors .geo", "#districtName", "#chart", "us_states.json", race, "us", "country", data);
  mapBuild("#governors .geo", "#districtName", "#chart", "us_counties.json", "county", "us", "counties", data);
  cartoBuild("#governors .carto", "#districtName", "#chart", null, race, data, "us", 0, cartoData(race,"us"));

  //RESPONSIVENESS
var aspect = 800 / 600, chart = $(".map svg"), chart2 = $(".carto svg");
  var targetWidth = chart.parent().width();
  chart.attr("width", targetWidth);
  chart.attr("height", targetWidth / aspect);
  var targetWidth2 = chart2.parent().width();
  chart2.attr("width", targetWidth2);
  chart2.attr("height", targetWidth2 / aspect);
}

} //end mapSpill

if (race == "president"){ var dataStuff = dataCounty; }
if (race == "senate"){ var dataStuff = dataSenate; }
if (race == "governors"){ var dataStuff = dataGov; }
if (race == "mnsenate"){ var dataStuff = dataMNS; }
if (race == "mnhouse"){ var dataStuff = dataMNH; }
if (race == "house"){ var dataStuff = dataHouse; }

mapSpill(race,dataStuff);

// mapSpill("mnhouse","us",dataCounty);
// mapSpill("mnsenate","us",dataCounty);
// mapSpill("local","us",dataCounty);
// mapSpill("house","us",dataCounty);
// mapSpill("senate","us",dataCounty);
// mapSpill("governors","us",dataCounty);

var loadState = 0;

$(document).ready(function() {
    $(".dataviz").hide();
    $("#" + race).show();
    mapShow(".map","country");
});

//switches and interface triggers
$(".layerSwitch, .district").click(function() {
  $(".layerSwitch").removeClass("selected2");
  $(this).addClass("selected2");
  $(".map").hide();
  $("." + $(this).attr("data")).show();
});

$(".typeSwitch").click(function() {
  $(".layerSwitch").removeClass("selected2");
  $(this).addClass("selected2");
  $(".map").hide();
  $("." + $(this).attr("data")).show();
  $("." + $(this).attr("data")).css('display','inline-block');
});

$(".raceSwitch").click(function() {
  $(".raceSwitch").removeClass("selected2");
  $(this).addClass("selected2");
  $(".dataviz").hide();
  $("#" + $(this).attr("data")).show();
});

$(".stateSwitch").click(function() {
  $(".stateSwitch").removeClass("selected2");
  $(this).addClass("selected2");
  $("#pctzoom").hide();
  if ($(this).attr("id") == "tableView") { $(".mapBox").hide(); $("#" + race + " .table").show();  }
  else { $(".mapBox").show(); $("#" + race + " .table").hide();  }
});

$(".layerSwitch").click(function() {
  loadState++;
  $(".typeSwitch, .layerSwitch").removeClass("selected2");
  $(this).addClass("selected2");
  mapShow(".map",$(this).attr("data"));
    $(".map").show();
  $(".carto").hide();
});

//dataviz population
//SPILL EVERYTHING ELSE
function populate(race,year,tab){
  for (var i=0; i<directory.length; i++){
    if (directory[i].year == year && directory[i].race == race){
        //How to label the legends and candidates?
        $('.dparty, #candidateNameD').html(directory[i].d_party + "<span id='dMark' class='check'></div>");
        $('.rparty, #candidateNameR').html(directory[i].r_party + "<span id='rMark' class='check'></div>");

        if (directory[i].d_count > directory[i].r_count) { $("#dMark").addClass("democrat"); $("#dMark").html("&#10004;"); }
        else if (directory[i].d_count < directory[i].r_count) { $("#rMark").addClass("republican"); $("#rMark").html("&#10004;"); }

        //Powerbar data
        powerBars(directory[i].d_count,directory[i].r_count,directory[i].i_count,directory[i].u_count,directory[i].d_votes,directory[i].r_votes);

        //What historical data to spill?
        loadHistory("#historyview",race,directory[i].d_party,directory[i].r_party);

        break;
    }
  }
} //end populate


// populate(race,year,tab);

});
});
});
});
});
});
</script>

</html>