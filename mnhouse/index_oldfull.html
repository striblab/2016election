<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>2016 Minnesota Legislature</title>
  <meta name="description" content="Title Here">
  <meta name="author" content="Frey Hargarten - StarTribune">

  <link href="../_common_resources/charts/nvd3-master/build/nv.d3.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  
  <style>
  #wrapper { width:100%; margin-right:auto; margin-left:auto; }
  #viewSelect { text-align:center; }
  .switch { padding:10px; display:inline-block; text-align:center; width:49.5%; background-color:#fff; font-weight:900; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border:1px solid black; }
  .switch:hover, .selected, .hSort:hover, .sSort:hover, .metroSwitch:hover { background-color:#4C4C39 !important; color:#fff !important; cursor:pointer; }

  p { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }

  .metro, .mn { width:45%; display:inline-block; }
  .infobox { width:100%; height:190px; font-family:"Benton Sans",Helvetica,Arial,sans-serif; }

  .tableHead { display:inline-block; padding:10px; border-bottom:1px solid #ddd; width:24%; font-weight:900; font-family:"Poynter Serif RE"; }
  .tableCell { display:inline-block; padding:10px; border-bottom:1px solid #ddd; width:24%; font-family:"Benton Sans"; }
  .tableBreak { clear:both; display:block; }
  .table { text-align:center; width:100%; overflow-x:hidden; overflow-y:auto; height:670px; }
  .campaigns { text-align:center; }
  .campaignsRPM, .campaignsDFL { display:inline-block; vertical-align:top; padding:7px; text-align:left; width:49%; }
  .campaignsRPM { border-left:2px solid #9C0004; }
  .campaignsDFL { border-left:2px solid #0D4773; }
  .votes, .dollars { font-family:"Popular"; font-weight:900; font-size:1.2em; }

  #chatterBox { height:160px; }
  #chatterBox span { padding:3px; }

  .map { width:100%; }

  .toggleTables { text-align:center; font-family:"Benton Sans",Helvetica,Arial,sans-serif; font-weight:900; padding:15px; }
  .toggleTables:hover { cursor:pointer; }

  h2 { text-align:center; font-family:"Poynter Serif RE"; font-weight:900; }
  .districtSelect { width:100%; text-align:center; font-family:"Benton Sans",Helvetica,Arial,sans-serif; display:none; }
  .column { display:inline-block; width:48%; vertical-align:top; text-align:center; }
  .title { font-family:"Poynter Serif RE"; font-size:1.7em; text-align:center; font-weight:bold; }
  .district:hover, .districtH:hover, .districtS:hover { background-color:#4C4C39 !important; cursor:pointer; color:#fff; }

  #senate { display:none; }

  #senateToggle { display:none; }

  #viewSwitch { text-align:center; }
  #viewSwitch div { display:inline-block; }
  .zoom { float:none !important; padding:15px; }
  .legends { width:390px; height:auto; text-align:center; margin-right:auto; margin-left:auto; }

  .republican { color:#9C0004; fill:#9C0004 !important; pointer-events: all; font-weight:bold; }
  .r1 { background-color:#FF8572; fill:#FF8572 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .r2 { background-color:#F2634C; fill:#F2634C !important; color:white !important; pointer-events: all; font-weight:bold; }
  .r3 { background-color:#9C0004; fill:#9C0004 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .r4 { background-color:#4E0002; fill:#4E0002 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .mid { background-color:#ddd; fill:#ddd !important; color:white !important; pointer-events: all; font-weight:bold; }
  .democrat { color:#0D4773; fill:#0D4773 !important; pointer-events: all; font-weight:bold; }
  .d1 { background-color:#67B4C2; fill:#67B4C2 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .d2 { background-color:#4192A1; fill:#4192A1 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .d3 { background-color:#0D4773; fill:#0D4773 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .d4 { background-color:#022642; fill:#022642 !important; color:white !important; pointer-events: all; font-weight:bold; }

  .demSwatch { background-color:#0D4773; fill:#0D4773 !important; pointer-events: all; font-weight:bold; }
  .gopSwatch { background-color:#9C0004; fill:#9C0004 !important; pointer-events: all; font-weight:bold; }

  small { font-family:"Benton Sans",Helvetica,Arial,sans-serif; color:#808080; clear:both; display:block; }

  .mapBox { float:left; width:48%; }
  .demoBox { float:right; width:48%; }
  .cfBox { height:160px; display:none; }


  #houseStepper { text-align:center; max-width:100%; min-width:100%; height:auto; overflow-x:auto; overflow-y:hidden; white-space:nowrap; }
  .step { width:126px; display:inline-block; border:1px solid #ddd; height:80px; font-family:"Benton Sans",Helvetica,Arial,sans-serif; word-wrap: break-word; white-space:normal !important; }
  .step:hover, .stepSelect { border:1px solid #4C4C39; cursor:pointer; }

  .statRow { width:100%; }
  .cell { display:inline-block; text-align:center; }
  .statNum, .incomeNum { padding:7px; font-size:1.2em; font-weight:900; }
  .statNum:hover, .incomeNum:hover { cursor:pointer; background-color:#333; color:#fff; }
  .raceRow .cell { width:50%; }
  .miRow .cell { width:100%; }
  .femaleRow .cell, .maleRow .cell, .schoolRow .cell, .incomeRow .cell { width:25%; }
  .label { font-size:.8em; font-family:"Benton Sans",Helvetica,Arial,sans-serif; text-align:center; }

  .districtName { text-align:center; }

  .powerBar { text-align:center; vertical-align:top; }
  .rows { width:30%; display:inline-block; vertical-align:middle; }
  .campaigns { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }

  .metro { display:none; }
  .metroSwitch { padding:10px; display:inline-block; text-align:center; width:150px; background-color:#fff; font-weight:900; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border:1px solid black; }
 
  .caucusR, .caucusD, .president { display:none; }

  .legends { display:none; }

  .carson { fill:#D97171; background-color:#D97171; font-weight:900; color:#fff; }
  .kasich { fill:#DF95AF; background-color:#DF95AF; font-weight:900; color:#fff; }
  .gray3 { font-weight:900; color:#fff; }

  .blue5 { fill:#325998; background-color:#325998; font-weight:900; }
  .blue4 { fill:#5a82ad; background-color:#5a82ad; font-weight:900; }
  .blue3 { fill:#83acc3; background-color:#83acc3; font-weight:900; }
  .blue2 { fill:#abd5d8; background-color:#abd5d8; font-weight:900; }

  .green5 { fill:#604a8f; background-color:#604a8f; font-weight:900; }
  .green4 { fill:#8672a8; background-color:#8672a8; font-weight:900; }
  .green3 { fill:#ad9ac1; background-color:#ad9ac1; font-weight:900; }
  .green2 { fill:#d3c2da; background-color:#d3c2da; font-weight:900; }

  .orange5  { fill:#c73d2b; background-color:#c73d2b; font-weight:900; }
  .orange4 { fill:#d76256; background-color:#d76256; font-weight:900; }
  .orange3 { fill:#e78682; background-color:#e78682; font-weight:900; }
  .orange2 { fill:#f7abad; background-color:#f7abad; font-weight:900; }

  .purple5 { fill:#cc7133; background-color:#cc7133; font-weight:900; }
  .purple4 { fill:#d58e4e; background-color:#d58e4e; font-weight:900; }
  .purple3 { fill:#ddac6a; background-color:#ddac6a; font-weight:900; }
  .purple2 { fill:#e6c985; background-color:#e6c985; font-weight:900; }

  .grayblue5 { fill:#9e5d52; background-color:#9e5d52; font-weight:900; }
  .grayblue4 { fill:#b57f73; background-color:#b57f73; font-weight:900; }
  .grayblue3 { fill:#cba093; background-color:#cba093; font-weight:900; }
  .grayblue2 { fill:#e2c2b4; background-color:#e2c2b4; font-weight:900; }

  .schoolRow { display:none; }

  .incomeRow { display:none; }
  .bar { height:50px; width:100%; }
  .half { display:inline-block; height:50px; }
  #dBar { width:45%; }
  #rBar { width:54%; }
  
  #houseInfo.active { pointer-events:auto !important; }
  #houseInfo.inactive { pointer-events:none !important; -webkit-filter:grayscale(1); opacity:.5; }

/*
  #viewSelect { display:none; }*/

  @media (max-width:820px) {
  .mapBox { width:100%; float:none; text-align:center; }
  .metro { display:none; }
  .infobox { height:auto; }
  .demoBox { width:100%; float:none; text-align:center; }
  .tableHead, .tableCell { font-size:.75em; }
  .step { width:19%; }
  .card { vertical-align:top; }
  }
  </style> 
</head>

<body>
  <div id="wrapper">

<!-- <div id="viewSelect">
<div class="switch selected" data="house" year="2014">House</div>
<div class="switch" data="senate" year="2012">Senate</div>
</div> -->

<div id="houseToggle" class="toggleTables">DISTRICT SELECT</div>
<div id="senateToggle" class="toggleTables">DISTRICT SELECT</div>

<div id="house" class="section">  
    
<div id="analysisHouse">

<div id="houseStepper">
<div class="step stepSelect" data="house" map="mnleg" legend="mnlegend" id="firstStep" explain="The 2016 election year presents the DFL with an opportunity to take the state House of Representatives back from Republicans who took control in the 2014 midterm. Democrats need to win 7 additional seats to retake the chamber.">Who controls the House?</div>
<div region="mn" class="step" data="hot" map="mnleg" legend="mnlegend" explain='<p>Both parties have vulnerable seats to defend in November, which are often in districts that saw close races in 2014, while others are open.</p><p>RPM races to watch: <span region="mn" class="district r1">02A</span> <span region="mn" class="district r1">10A</span> <span region="mn" class="district r1">10B</span> <span region="mn" class="district r1">12A</span> <span region="mn" class="district r1">11B</span> <span region="mn" class="district r1">17A</span> <span region="mn" class="district r1">17B</span> <span region="mn" class="district r2">21A</span> <span region="mn" class="district r1">24B</span> <span region="mn" class="district r1">37B</span> <span region="mn" class="district r1">50B</span> <span region="mn" class="district r1">56B</span> <span region="mn" class="district r1">57A</span></p> <p>DFL races to watch: <span region="mn" class="district d1">04B</span> <span region="mn" class="district d1">05B</span> <span region="mn" class="district d4">25B</span> <span region="mn" class="district d1">36B</span> <span region="mn" class="district d1">42A</span> <span region="mn" class="district d1">42B</span> <span region="mn" class="district d1">43A</span> <span region="mn" class="district d1">48A</span> <span region="mn" class="district d1">49A</span> <span region="mn" class="district d1">49B</span> <span region="mn" class="district d1">51B</span> <span region="mn" class="district d1">52B</span> <span region="mn" class="district d1">54A</span></p>'>This year's hot races</div>
<div region="mn" class="step" data="open" map="mnleg" legend="mnlegend"  explain='<p>Since 2014, four seats have opened where there used to be DFL legislators: <span region="mn" class="district d4">25B</span> <span region="mn" class="district d1">42B</span> <span region="mn" class="district d2">52B</span> <span region="mn" class="district d1">54A</span></p>'>Seats without an incumbant</div>
<div region="mn" class="step" data="rematch" map="mnleg" legend="mnlegend"  explain='<p>Several seats and rematches between candidates who have run against each other before: <span region="mn" class="district r1">02A</span> <span region="mn" class="district r1">10A</span> <span region="mn" class="district r1">10B</span> <span region="mn" class="district r1">11B</span> <span region="mn" class="district r1">12A</span> <span region="mn" class="district r1">14B</span> <span region="mn" class="district r1">17A</span> <span region="mn" class="district r1">17B</span> <span region="mn" class="district r1">24B</span> <span region="mn" class="district r1">27A</span> and <span region="mn" class="district r1">56B</span>.</p><p>In <span region="mn" class="district r3">50B</span>, there was recently a special election to replace a retiring legislator, and those candidates will also face off against each other again this November.</p>'>This year's rematches</div>
<div class="step" data="president" map="president" legend="prezlegend" explain="Barack Obama won Minnesota handily in 2014, but was primarily carried by the metro area. The rest of the state was a patchwork of political loyalties on the county level.">Last Presidential Election</div>
<div class="step" data="democrats" map="caucusD" legend="dlegend" explain="Bernie Sanders won Minnesota overwhelmingly in this year's DFL presidential caucus, including in areas with Republican legislators.">2016 Democrat Caucus</div>
<div class="step" data="republicans" map="caucusR" legend="rlegend" explain="Areas that voted for Ted Cruz in this year's RPM presidential caucus are more likely locks for Republican legislative races in November.">2016 Republican Caucus</div>

</div>

<div class="breaker"></div>

<div class="mapBox">
<div class="legends" id="mnlegend">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>DFL</span>
          <span class='d4'></span>
          <span class='d3'></span>
          <span class='d2'></span>
          <span class='d1'></span>
          <span class='mid'></span>
          <span class='r1'></span>
          <span class='r2'></span>
          <span class='r3'></span>
          <span class='r4'></span>
          <span style='background:#fff;'>RPM</span>
        </nav>
      </span>
    </div>
    <small><!-- <span id="year">2014</span>  -->Win Percentage</small>
  </div>

<div class="legends" id="prezlegend">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>DEM</span>
          <span class='d4'></span>
          <span class='d3'></span>
          <span class='d2'></span>
          <span class='d1'></span>
          <span class='mid'></span>
          <span class='r1'></span>
          <span class='r2'></span>
          <span class='r3'></span>
          <span class='r4'></span>
          <span style='background:#fff;'>GOP</span>
        </nav>
      </span>
    </div>
    <small><!-- <span id="year">2014</span>  -->Win Percentage</small>
  </div>

<div class="legends" id="dlegend" style="display:none;">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>Clinton</span>
          <span class='blue5'></span>
          <span class='blue4'></span>
          <span class='blue3'></span>
          <span class='blue2'></span>
          <span class='gray3'></span>
          <span class='green2'></span>
          <span class='green3'></span>
          <span class='green4'></span>
          <span class='green5'></span>
          <span style='background:#fff;'>Sanders</span>
        </nav>
      </span>
    </div>
     <small>Win Percentage</small>
  </div>

<div class="legends" id="rlegend" style="display:none;">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span class='purple2'></span>
          <span class='purple5'></span>
          <span style='background:#fff;'>Rubio</span>
          <span class='grayblue2'></span>
          <span class='grayblue5'></span>
          <span style='background:#fff;'>Cruz</span>
          <span class='orange2'></span>
          <span class='orange5'></span>
          <span style='background:#fff;'>Trump</span>
        </nav>
      </span>
    </div>
     <small>Win Percentage</small>
  </div>

<div class="mnleg">
<div id="mapHouse" class="map mn"><svg width="100%" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
<div id="mapHouseMetro" class="map metro"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
</div>

<div class="caucusD">
<div id="mapCaucusD" class="map mn"><svg width="100%" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
<div id="mapCaucusDMetro" class="map metro"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
</div>

<div class="caucusR">
<div id="mapCaucusR" class="map mn"><svg width="100%" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
<div id="mapCaucusRMetro" class="map metro"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
</div>

<div class="president">
<div id="mapCounties" class="map mn"><svg width="100%" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
<div id="mapCountiesMetro" class="map metro"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
</div>

  <div class="powerBar">
<div class="rows"><div class="dflCount column bigNum democrat">61</div><div>DFL</div></div>
<div class="rows"><div class="bar"><div class="half d3" id="dBar"></div><div class="half r3" id="rBar"></div></div></div>
<div class="rows"><div class="gopCount column bigNum republican">73</div><div>RPM</div></div>
  </div>
</div>

<div class="demoBox">
<div class="cfBox">
<div class="label">Campaign Finance</div>
  <div class="campaigns">
    <div class="campaignsRPM"></div>
    <div class="campaignsDFL"></div>
  </div>
</div>

<div class="chatter" id="chatterBox">The 2016 election year presents the DFL with an opportunity to take the state House of Representatives back from Republicans who took control in the 2014 midterm.</div>

<div id="houseInfo" class="infobox">
<div id="houseExplain" class="explain">
  <div class="districtName"><div class="r3">Minnesota</div></div>
  <div class="stats">
<div class='miRow' class='statRow'>
  <div class='cell'>
    <div class='label'>Median Income</div>
    <div class='incomeNum' data='mi'>58476</div>
  </div>
</div>
<div class='raceRow' class='statRow'>
  <div class='cell'>
    <div class='label'>White Population</div>
    <div class='statNum' data='whites'>.83</div>
  </div><div class='cell'>
    <div class='label'>Minority Population</div>
    <div class='statNum' data='minorities'>.17</div>
  </div>
</div>
  <div class='schoolRow' class='statRow'>
    <div class='cell'>
      <div class='label'>High School</div>
      <div class='statNum' data='highschool'>.35</div>
    </div><div class='cell'>
      <div class='label'>Some/Associates</div>
      <div class='statNum' data='associates'>.33</div>
    </div><div class='cell'>
      <div class='label'>Bachelor's</div>
      <div class='statNum' data='bachelors'>.22</div>
    </div><div class='cell'>
      <div class='label'>Graduate</div>
      <div class='statNum' data='graduate'>.11</div>
    </div>
  </div>
    <div class='incomeRow' class='statRow'>
      <div class='cell'>
        <div class='label'>< $40k</div>
        <div class='statNum' data='low'>.20</div>
      </div><div class='cell'>
        <div class='label'>$40k-$75k</div>
        <div class='statNum' data='mid' data='graduate'>.20</div>
      </div><div class='cell'>
        <div class='label'>$75k-$100k</div>
        <div class='statNum' data='high'>.20</div>
      </div><div class='cell'>
        <div class='label'>$100k+</div>
        <div class='statNum' data='highest'>.20</div>
      </div>
    </div>
    <div class='maleRow' class='statRow'>
      <div class='cell'>
        <div class='label'>Men 18-34</div>
        <div class='statNum' data='mYoung'>.12</div>
      </div><div class='cell'>
        <div class='label'>Males 35-49</div>
        <div class='statNum' data='mMiddle'>.07</div>
      </div><div class='cell'>
        <div class='label'>Males 50-64</div>
        <div class='statNum' data='mOld'>.10</div>
      </div><div class='cell'>
        <div class='label'>Males 65+</div>
        <div class='statNum' data='mOldest'>.06</div>
      </div>
    </div>
    <div class='femaleRow' class='statRow'>
      <div class='cell'>
        <div class='label'>Females 18-34</div>
        <div class='statNum' data='fYoung'>.08</div>
      </div><div class='cell'>
        <div class='label'>Females 35-49</div>
        <div class='statNum' data='fMiddle'>.10</div>
      </div><div class='cell'>
        <div class='label'>Females 50-64</div>
        <div class='statNum' data='fOld'>.10</div>
      </div><div class='cell'>
        <div class='label'>Females 65+</div>
        <div class='statNum' data='fOldest'>.07</div>
      </div>
    </div>
  </div>

  <div class="breaker"></div>

  <div id="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>Less</span>
          <span class='gray1'></span>
          <span class='gray2'></span>
          <span class='gray3'></span>
          <span class='gray4'></span>
          <span class='gray5'></span>
          <span style='background:#fff;'>More</span>
        </nav>
      </span>
    </div>
  </div>
</div>
</div>
</div>

</div>

  <div class="breaker"></div>

<div id="filterHouse" class="filter"><input type="search" class="filter_box" placeholder="Search by keyword"></input></div>

<div id="tableHouse" class="table" data="finance">
<div class='tableHead partyBar hSort' data="candidate">Incumbant</div><div class='tableHead hSort selected' data="district">District</div><div class='tableHead hSort' data="party">Party</div><div class='tableHead hSort' data="vote">2014 Vote</div>
</div>

</div>

<div id="senate" class="section">
<div id="analysisSenate" data="senate">

<div id="senateStepper">
<div class="step">
  step
</div>
<div class="step">
  step
</div>
<div class="step">
  step
</div>
<div class="step">
  step
</div>
<div class="step">
  step
</div>
</div>

<div class="breaker"></div>


<div class="districtSelect">
<div id="gopColumn" class="column">
<div class="district republican selected" region="mn">21</div>
<div class="district republican" region="mn">35</div>
<div class="district republican" region="mn">56</div>
<div class="district republican" region="mn">58</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="distric" region="mn">-</div>
<div class="district" region="mn">-</div>
</div>
<div id="dflColumn" class="column">
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
</div>
</div>

<div class="mapBox" data="senate">
<div class="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>DFL</span>
          <span class='d4'></span>
          <span class='d3'></span>
          <span class='d2'></span>
          <span class='d1'></span>
          <span class='mid'></span>
          <span class='r1'></span>
          <span class='r2'></span>
          <span class='r3'></span>
          <span class='r4'></span>
          <span style='background:#fff;'>RPM</span>
        </nav>
      </span>
    </div>
    <small><span id="year">2012</span> Win Percentage</small>
  </div>

<div id="mapSenate" class="map mn" data="finance"><svg width="100%" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>

<div id="mapSenateMetro" class="map metro" data="finance"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>

  <div class="powerBar">
<div class="rows"><div class="dflCount democrat bigNum column">39</div></div>
<div class="rows"><h2>Minnesota Senate</h2></div>
<div class="rows"><div class="gopCount republican bigNum column">28</div></div>
  </div>
</div>

<div class="demoBox">
<div class="chatterBox">
<div class="label">Campaign Finance</div>
  <div class="campaigns">
    <div class="campaignsRPM"></div>
    <div class="campaignsDFL"></div>
  </div>
</div>

<div id="senateInfo" class="infobox">
<div id="senateExplain" class="explain">
  <div class="districtName"><div class="d3">Minnesota</div></div>
    <div class="stats">
<div class='miRow' class='statRow'>
  <div class='cell'>
    <div class='label'>Median Income</div>
    <div class='incomeNum' data='mi'>58476</div>
  </div>
</div>
<div class='raceRow' class='statRow'>
  <div class='cell'>
    <div class='label'>White Population</div>
    <div class='statNum' data='whites'>.83</div>
  </div><div class='cell'>
    <div class='label'>Minority Population</div>
    <div class='statNum' data='minorities'>.17</div>
  </div>
</div>
  <div class='schoolRow' class='statRow'>
    <div class='cell'>
      <div class='label'>High School</div>
      <div class='statNum' data='highschool'>.35</div>
    </div><div class='cell'>
      <div class='label'>Some/Associates</div>
      <div class='statNum' data='associates'>.33</div>
    </div><div class='cell'>
      <div class='label'>Bachelor's</div>
      <div class='statNum' data='bachelors'>.22</div>
    </div><div class='cell'>
      <div class='label'>Graduate</div>
      <div class='statNum' data='graduate'>.11</div>
    </div>
  </div>
    <div class='incomeRow' class='statRow'>
      <div class='cell'>
        <div class='label'>< $40k</div>
        <div class='statNum' data='low'>.20</div>
      </div><div class='cell'>
        <div class='label'>$40k-$75k</div>
        <div class='statNum' data='mid' data='graduate'>.20</div>
      </div><div class='cell'>
        <div class='label'>$75k-$100k</div>
        <div class='statNum' data='high'>.20</div>
      </div><div class='cell'>
        <div class='label'>$100k+</div>
        <div class='statNum' data='highest'>.20</div>
      </div>
    </div>
    <div class='maleRow' class='statRow'>
      <div class='cell'>
        <div class='label'>Men 18-34</div>
        <div class='statNum' data='mYoung'>.12</div>
      </div><div class='cell'>
        <div class='label'>Males 35-49</div>
        <div class='statNum' data='mMiddle'>.07</div>
      </div><div class='cell'>
        <div class='label'>Males 50-64</div>
        <div class='statNum' data='mOld'>.10</div>
      </div><div class='cell'>
        <div class='label'>Males 65+</div>
        <div class='statNum' data='mOldest'>.06</div>
      </div>
    </div>
    <div class='femaleRow' class='statRow'>
      <div class='cell'>
        <div class='label'>Females 18-34</div>
        <div class='statNum' data='fYoung'>.08</div>
      </div><div class='cell'>
        <div class='label'>Females 35-49</div>
        <div class='statNum' data='fMiddle'>.10</div>
      </div><div class='cell'>
        <div class='label'>Females 50-64</div>
        <div class='statNum' data='fOld'>.10</div>
      </div><div class='cell'>
        <div class='label'>Females 65+</div>
        <div class='statNum' data='fOldest'>.07</div>
      </div>
    </div>
  </div>

<div class="breaker"></div>

<div id="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>Less</span>
          <span class='gray1'></span>
          <span class='gray2'></span>
          <span class='gray3'></span>
          <span class='gray4'></span>
          <span class='gray5'></span>
          <span style='background:#fff;'>More</span>
        </nav>
      </span>
    </div>
</div>

</div>
</div>
</div>

</div>

  <div class="breaker"></div>

<div id="filterSenate" class="filter"><input type="search" class="filter_box" placeholder="Search by keyword"></input></div>

<div id="tableSenate" class="table" data="finance">
<div class='tableHead partyBar sSort' data="candidate">Incumbant</div><div class='tableHead sSort selected' data="district">District</div><div class='tableHead sSort' data="party">Party</div><div class='tableHead sSort' data="vote">2012 Vote</div>
</div>
  </div>

<div id="viewSwitch"><div class="metroSwitch selected" data="mn">State</div> <div class="metroSwitch" data="metro">Metro</div> <div class="zoom">Reset View</div></div>

</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="../_common_resources/charts/nvd3-master/build/nv.d3.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/utils.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/tooltip.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/models/legend.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/models/axis.js"></script>
<script src="../_common_resources/charts/nvd3-master/test/stream_layers.js"></script>

<script>
$(".table, .filter").hide();

//LIVE JSON MAGIC

//http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=house_age_sex
//http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=senate_age_sex
//http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnsenate2012
//http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnhouse2014
//http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnleg_chatter
//http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=cand_disc_filings
//http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=candidates2016
//http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=demographics2
//http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=median_income

//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=house_age_sex
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=senate_age_sex
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnsenate2012
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnhouse2014
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnleg_chatter
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=cand_disc_filings
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=candidates2016
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=demographics2
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=median_income

d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=house_age_sex", function(error, dataLoadAHouse) {
// d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=senate_age_sex", function(error, dataLoadASenate) {
// d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnsenate2012", function(error, dataLoadSenate) {
d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnhouse2014", function(error, dataLoadHouse) {
// d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnleg_chatter", function(error, dataLoadChatter) {
d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=cand_disc_filings", function(error, dataLoadCF) {
d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=candidates2016", function(error, dataLoadCandidates) {
d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=demographics2", function(error, dataLoadEI) {
d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=median_income", function(error, dataLoadMI) {

// dataCF - BeginCash, TotReceipts, TotalExpend, District, CandRegNumb
// dataCandidates - CandRegistrationNumber, CandFirstName, CandLastName, OfficeSought, Party
// dataChatter - district, chatter
// mnsenate_2012_results - candidate, party_id, vote_pct
// mnhouse_2014_results - candidate, party_id, vote_pct
// senate_age_sex - district, population, male_18_to_34, male_35_to_49, male_50_to_64, male_65_over, female_18_to_34, female_35_to_49, female_50_to_64, female_65_over
// house_age_sex - district, population, male_18_to_34, male_35_to_49, male_50_to_64, male_65_over, female_18_to_34, female_35_to_49, female_50_to_64, female_65_over

var dataHouseAge = dataLoadAHouse.house_age_sex;
// var dataSenateAge = dataLoadASenate.senate_age_sex;
var dataHouse = dataLoadHouse.mnhouse2014;
// var dataSenate = dataLoadSenate.mnsenate2012;
// var dataChatter = dataLoadChatter.mnleg_chatter;
var dataCandidates = dataLoadCandidates.candidates2016;
var dataCF = dataLoadCF.cand_disc_filings;
var dataEI = dataLoadEI.demographics2;
var dataMI = dataLoadMI.median_income;

//TOGGLES
$(".switch").click(function() {
  $(".switch").removeClass("selected");
  $(this).addClass("selected");
  $(".section, .toggleTables").hide();
  $("#" + $(this).attr("data") + "Toggle").show();
  $("#" + $(this).attr("data")).show();
  $("#year").text($(this).attr("year"));
});

$("#mnlegend").show();


$(".statNum, .incomeNum").click(function() {
  $(".statNum,.incomeNum").removeClass("selected");
  $(this).addClass("selected");
  $(".caucusD, .caucusR, .president, .cfBox").hide();
  $(".mnleg, #chatterBox").show();
  mapReshade("#mapHouse", "mnleg.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapHouseMetro", "mnleg_metro.json", $(this).attr("data"), "house", dataHouse);
  // mapReshade("#mapSenate", "mnsenate.json", $(this).attr("data"), "senate", dataSenate);
  // mapReshade("#mapSenateMetro", "mnsenate_metro.json", $(this).attr("data"), "senate", dataSenate);
});

$(".step").click(function() {
  $(".step").removeClass("stepSelect");
  $(this).addClass("stepSelect");
  $(".chatter").html($(this).attr("explain"));
  $(".mnleg, .caucusD, .caucusR, .president, .legends").hide();
  $("." + $(this).attr("map")).show();
  $("#" + $(this).attr("legend")).show();
  $(".cfBox").hide();
  $("#chatterBox").show();
  mapReshade("#mapHouse", "mnleg.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapHouseMetro", "mnleg_metro.json", $(this).attr("data"), "house", dataHouse);

   $('#house .districtName').html("<div class='r3'>Minnesota</div>");

    $('.stats').html("<div class='miRow' class='statRow'><div class='cell'><div class='label'>Median Income</div><div class='incomeNum' data='mi'>58476</div></div></div><div class='raceRow' class='statRow'><div class='cell'><div class='label'>White Population</div><div class='statNum' data='whites'>.83</div></div><div class='cell'><div class='label'>Minority Population</div><div class='statNum' data='minorities'>.17</div></div></div><div class='schoolRow' class='statRow'><div class='cell'><div class='label'>High School</div><div class='statNum' data='highschool'>.35</div></div><div class='cell'><div class='label'>Some/Associates</div><div class='statNum' data='associates'>.33</div></div><div class='cell'><div class='label'>Bachelor's</div><div class='statNum' data='bachelors'>.22</div></div><div class='cell'><div class='label'>Graduate</div><div class='statNum' data='graduate'>.11</div></div></div><div class='incomeRow' class='statRow'><div class='cell'><div class='label'>< $40k</div><div class='statNum'>.20</div></div><div class='cell'><div class='label'>$40k-$75k</div><div class='statNum'>.20</div></div><div class='cell'><div class='label'>$75k-$100k</div><div class='statNum'>.20</div></div><div class='cell'><div class='label'>$100k+</div><div class='statNum'>.20</div></div></div><div class='maleRow' class='statRow'><div class='cell'><div class='label'>Men 18-34</div><div class='statNum' data='mYoung'>.12</div></div><div class='cell'><div class='label'>Males 35-49</div><div class='statNum' data='mMiddle'>.07</div></div><div class='cell'><div class='label'>Males 50-64</div><div class='statNum' data='mOld'>.10</div></div><div class='cell'><div class='label'>Males 65+</div><div class='statNum' data='mOldest'>.06</div></div></div><div class='femaleRow' class='statRow'><div class='cell'><div class='label'>Females 18-34</div><div class='statNum' data='fYoung'>.08</div></div><div class='cell'><div class='label'>Females 35-49</div><div class='statNum' data='fMiddle'>.10</div></div><div class='cell'><div class='label'>Females 50-64</div><div class='statNum' data='fOld'>.10</div></div><div class='cell'><div class='label'>Females 65+</div><div class='statNum' data='fOldest'>.07</div></div></div>");

    $(".statNum, .incomeNum").click(function() {
  $(".statNum,.incomeNum").removeClass("selected");
  $(this).addClass("selected");
  $(".caucusD, .caucusR, .president, .cfBox").hide();
  $(".mnleg, #chatterBox").show();
  mapReshade("#mapHouse", "mnleg.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapHouseMetro", "mnleg_metro.json", $(this).attr("data"), "house", dataHouse);
  // mapReshade("#mapSenate", "mnsenate.json", $(this).attr("data"), "senate", dataSenate);
  // mapReshade("#mapSenateMetro", "mnsenate_metro.json", $(this).attr("data"), "senate", dataSenate);
});

  $(".district").click(function() {
  $(".district").removeClass("selected");
  $(this).addClass("selected");

      $(".districtName").html("District " + $(this).text());

  // for (var i=0; i < dataChatter.length; i++){
  //     if ($(this).text() == dataChatter[i].district) {  
  //       $("#candidateGOP").html(dataChatter[i].candidateGOP); 
  //       $("#candidateDFL").html(dataChatter[i].candidateDFL);
  //     }
  // }

  jQuery.fn.d3Click = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Down = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mousedown", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Up = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mouseup", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

    // clicked2();
    var findDistrict = "mn_" + $(this).text();
    var findMetro = "metro_" + $(this).text();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Click();
    $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Click();

});

  if ($(this).attr("data") == "democrats" || $(this).attr("data") == "republicans" || $(this).attr("data") == "president"){
    $(".powerBar").hide();
  } else { $(".powerBar").show(); }

});

$(".metroSwitch").click(function() {
  $(".metroSwitch").removeClass("selected");
  $(this).addClass("selected");
  $(".mn, .metro").hide();
  $("." + $(this).attr("data")).show();
});

$(".hSort").click(function() {
  $(".hSort").removeClass("selected");
  $(this).addClass("selected");
  if ($(this).hasClass("toggled")) { $(this).removeClass("toggled"); var sorted = "ascend"; }
  else if ($(this).hasClass("selected")) { $(this).addClass("toggled"); var sorted ="descend"; } 
  tableSort("#tableHouse","republican",dataHouse,$(this).attr("data"),sorted);
});

$(".sSort").click(function() {
  $(".sSort").removeClass("selected");
  $(this).addClass("selected");
  if ($(this).hasClass("toggled")) { $(this).removeClass("toggled"); var sorted = "ascend"; }
  else if ($(this).hasClass("selected")) { $(this).addClass("toggled"); var sorted ="descend"; } 
  tableSort("#tableSenate","democrat",dataSenate,$(this).attr("data"),sorted);
});

$("#houseToggle").click(function() {
  $("#tableHouse, #filterHouse").slideToggle( "slow", function() {});
  $("#analysisHouse").slideToggle( "slow", function() {});
});

$("#senateToggle").click(function() {
  $("#tableSenate").slideToggle( "slow", function() {});
  $("#analysisSenate, #filterSenate").slideToggle( "slow", function() {});
});

// $(document).bind('DOMNodeInserted', function(event) {
$(".district").click(function() {
  $(".district").removeClass("selected");
  $(this).addClass("selected");

      $(".districtName").html("District " + $(this).text());

  // for (var i=0; i < dataChatter.length; i++){
  //     if ($(this).text() == dataChatter[i].district) {  
  //       $("#candidateGOP").html(dataChatter[i].candidateGOP); 
  //       $("#candidateDFL").html(dataChatter[i].candidateDFL);
  //     }
  // }

  jQuery.fn.d3Click = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Down = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mousedown", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Up = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mouseup", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

    // clicked2();
    var findDistrict = $(this).text() + "_" + $(this).attr("region");
    var findMetro = $(this).text() + "_metro";
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Click();
    $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Click();
});


//TABLES
function tableSort(container,party,data,candidate,sorted){
   
  d3.select(container).selectAll(".card").sort(function(a, b) {
          if (candidate == "candidate") { 
        if (sorted == "descend") { return d3.descending(a.candidate, b.candidate); }
        if (sorted == "ascend") { return d3.ascending(a.candidate, b.candidate); }
     }
          if (candidate == "district") { 
        if (sorted == "descend") { return d3.descending(a.district, b.district); }
        if (sorted == "ascend") { return d3.ascending(a.district, b.district); }
     }
           if (candidate == "party") { 
        if (sorted == "descend") { return d3.descending(a.party_id, b.party_id); }
        if (sorted == "ascend") { return d3.ascending(a.party_id, b.party_id); }
     }
           if (candidate == "vote") { 
        if (sorted == "descend") { return d3.descending(a.vote_pct, b.vote_pct); }
        if (sorted == "ascend") { return d3.ascending(a.vote_pct, b.vote_pct); }
     }
    })
    .transition().duration(500);
}

function tableBuild(container,race,data,state,county,index){

if (race == "senate") { var select = "districtS"; }
if (race == "house") { var select = "districtH"; }

d3.select(container).selectAll(".card")
.data(data.filter(function(d){ return d.vote_pct > 50; })).enter().append("div")
.attr("class","card")
.html(function (d){ 
    if (d.party_id == "R") { 
      var shade = "republican"; var party = "RPM";
        if  (d.vote_pct > 80) { var swatch = "r4"; }
        else if  (d.vote_pct > 70) { var swatch = "r3"; }
        else if  (d.vote_pct > 60) { var swatch = "r2"; }
        else if  (d.vote_pct > 50) { var swatch = "r1"; }
    }
    else if (d.party_id == "DFL") { 
      var party = "DFL"; var shade="democrat";
        if  (d.vote_pct > 80) { var swatch = "d4"; }
        else if  (d.vote_pct > 70) { var swatch = "d3"; }
        else if  (d.vote_pct > 60) { var swatch = "d2"; }
        else if  (d.vote_pct > 50) { var swatch = "d1"; }
     }
    return "<div class='tableCell candidate'>" + d.candidate + "</div><div class='tableCell " + select + "' region='mn'>" + d.district + "</div><div class='tableCell party " + shade + "'>" + party + "</div><div class='tableCell votes "  + swatch +  "'>" + Math.round(d.vote_pct) + "%</div>";
});

$("." + select).click(function() {
 $(".caucusD, .caucusR, .president").hide();
 $(".mnleg").show();
  $(".step").removeClass("stepSelect");
  $("#firstStep").addClass("stepSelect");
 $("." + select).removeClass("selected");
 $(".district").removeClass("selected");
 $(this).addClass("selected");

  $(".districtName").html("District " + $(this).text());

  jQuery.fn.d3Click = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Down = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mousedown", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Up = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mouseup", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

  $("#tableHouse, #filterHouse").slideToggle( "slow", function() {});
  $("#tableSenate").slideToggle( "slow", function() {});
  $("#analysisHouse").slideToggle( "slow", function() {});
  $("#analysisSenate, #filterSenate").slideToggle( "slow", function() {});

    // clicked2();
    var findDistrict = $(this).attr("region") + "_" + $(this).text();
    var findMetro = "metro_" + $(this).text();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Click();
    $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    $("[id='" + findMetro.replace(new RegExp(" ", "g"),"-") + "']").d3Click();
});

}

//SEARCH
$( document ).ready(function() {
     $('#filterSenate input').keyup(function(i){
        $('.card').hide();
        var txt = $('#filterSenate input').val();
        $('.card').each(function(){
           if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
               $(this).show();
           }
        });
    });
     $('#filterHouse input').keyup(function(i){
        $('.card').hide();
        var txt = $('#filterHouse input').val();
        $('.card').each(function(){
           if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
               $(this).show();
           }
        });
    });
  });

//MAPS
function mapStats(d, race, dataCompare){
 $('.campaignsRPM, .campaignsDFL, .stats').html("");

  population = Number(d.properties.POPULATION);
  whites = d.properties.F_NH18_WHT;
  minorities = Number(d.properties.F_NH18_DO2) + Number(d.properties.F_NH18_DO1) + Number(d.properties.F_NH18_DOJ) + Number(d.properties.F_H18_POP) + Number(d.properties.F_NH18_DO3) + Number(d.properties.F_NH18_DO4);

  var income = 0;

  var ageData ;
  if (race == "house") { ageData = dataHouseAge; }
  else if (race == "senate") { ageData = dataSenateAge; }

    for (var i=0; i < ageData.length; i++){
  if (ageData[i].district == d.properties.DISTRICT) {  
   var maleYoung = ageData[i].male_18_to_34 / population;
   var maleMiddle = ageData[i].male_35_to_49 / population;
   var maleOld = ageData[i].male_50_to_64 / population;
   var maleOldest = ageData[i].male_65_over / population;
   var femaleYoung = ageData[i].female_18_to_34 / population;
   var femaleMiddle = ageData[i].female_35_to_49 / population;
   var femaleOld = ageData[i].female_50_to_64 / population;
   var femaleOldest = ageData[i].female_65_over / population;
     for (var j=0; j < dataEI.length; j++){
      if (dataEI[j].county == ageData[i].county){
        var highschool = dataEI[j].highschool_pct;
        var associates = dataEI[j].associates_pct;
        var bachelors = dataEI[j].bachelors_pct;
        var graduate = dataEI[j].grad_degree_pct;
      }
       
     }
   }
  }

  for (var i=0; i < dataCF.length; i++){
    if (dataCF[i].District == d.properties.DISTRICT) { 
      for (var j=0; j < dataCandidates.length; j++){ 
       if (dataCandidates[j].CandRegistrationNumber == dataCF[i].CandRegNumb){
        if (dataCandidates[j].Party == "RPM") {
        $('.campaignsRPM').append("<div class='candidates'>" + dataCandidates[j].CandFirstName + " " + dataCandidates[j].CandLastName + "</div><div class='dollars'>" + d3.format("$,")(Math.round(dataCF[i].TotReceipts)) + "</div>");
        }
        if (dataCandidates[j].Party == "DFL") {
        $('.campaignsDFL').append("<div class='candidates'>" + dataCandidates[j].CandFirstName + " " + dataCandidates[j].CandLastName + "</div><div class='dollars'>" + d3.format("$,")(Math.round(dataCF[i].TotReceipts)) + "</div>");
        }
       }
      }
       

    }
  }

  for (var i=0; i < dataMI.length; i++){
    if (dataMI[i].district == d.properties.DISTRICT) { 
        income = dataMI[i].median_income;
    }
  }

  // $('.campaignsRPM').append("<div class='candidates'>" + dataCandidates[j].CandFirstName + " " + dataCandidates[j].CandLastName + " (<span class='republican'>" + dataCandidates[j].Party + "</span>)</div><div class='dollars'>" + d3.format("$,")(dataCF[i].TotReceipts) + "</div>");

  $('.stats').append("<div class='miRow' class='statRow'><div class='cell'><div class='label'>Median Income</div><div class='incomeNum' data='mi'>" + income + "</div></div></div><div class='raceRow' class='statRow'><div class='cell'><div class='label'>White Population</div><div class='statNum' data='whites'>" + whites + "</div></div><div class='cell'><div class='label'>Minority Population</div><div class='statNum' data='minorities'>" + minorities + "</div></div></div><div class='schoolRow' class='statRow'><div class='cell'><div class='label'>High School</div><div class='statNum' data='highschool'>" + highschool + "</div></div><div class='cell'><div class='label'>Some/Associates</div><div class='statNum' data='associates'>" + associates + "</div></div><div class='cell'><div class='label'>Bachelor's</div><div class='statNum' data='bachelors'>" + bachelors + "</div></div><div class='cell'><div class='label'>Graduate</div><div class='statNum' data='graduate'>" + graduate + "</div></div></div><div class='incomeRow' class='statRow'><div class='cell'><div class='label'>< $40k</div><div class='statNum' data='low'>0</div></div><div class='cell'><div class='label'>$40k-$75k</div><div class='statNum' data='mid' data='graduate'>0</div></div><div class='cell'><div class='label'>$75k-$100k</div><div class='statNum' data='high'>0</div></div><div class='cell'><div class='label'>$100k+</div><div class='statNum' data='highest'>0</div></div></div><div class='maleRow' class='statRow'><div class='cell'><div class='label'>Men 18-34</div><div class='statNum' data='mYoung'>" + maleYoung + "</div></div><div class='cell'><div class='label'>Males 35-49</div><div class='statNum' data='mMiddle'>" + maleMiddle + "</div></div><div class='cell'><div class='label'>Males 50-64</div><div class='statNum' data='mOld'>" + maleOld + "</div></div><div class='cell'><div class='label'>Males 65+</div><div class='statNum' data='mOldest'>" + maleOldest + "</div></div></div><div class='femaleRow' class='statRow'><div class='cell'><div class='label'>Females 18-34</div><div class='statNum' data='fYoung'>" + femaleYoung + "</div></div><div class='cell'><div class='label'>Females 35-49</div><div class='statNum' data='fMiddle'>" + femaleMiddle + "</div></div><div class='cell'><div class='label'>Females 50-64</div><div class='statNum' data='fOld'>" + femaleOld + "</div></div><div class='cell'><div class='label'>Females 65+</div><div class='statNum' data='fOldest'>" + femaleOldest + "</div></div></div>");

$(".statNum, .incomeNum").click(function() {
  $(".statNum,.incomeNum").removeClass("selected");
  $(this).addClass("selected");
  $(".caucusD, .caucusR, .president, .cfBox").hide();
  $(".mnleg, #chatterBox").show();
  mapReshade("#mapHouse", "mnleg.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapHouseMetro", "mnleg_metro.json", $(this).attr("data"), "house", dataHouse);
  // mapReshade("#mapSenate", "mnsenate.json", $(this).attr("data"), "senate", dataSenate);
  // mapReshade("#mapSenateMetro", "mnsenate_metro.json", $(this).attr("data"), "senate", dataSenate);
});

}

$(document).bind('DOMNodeInserted', function(event) {

   $('.raceRow .cell .statNum').first().each(function() {
    var num = $(this).text();
      if (num >= .80) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .60) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .40) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .20) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
   $('.raceRow .cell .statNum:nth-child(2)').each(function() {
    var num = $(this).text();
      if (num >= .25) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .20) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .15) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .10) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
   $('.schoolRow .cell .statNum').each(function() {
    var num = $(this).text();
      if (num >= .35) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .30) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .20) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .10) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
   $('.incomeRow .cell .statNum').each(function() {
    var num = $(this).text();
      if (num >= .35) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .30) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .20) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .10) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
   $('.maleRow .cell  .statNum').each(function() {
    var num = $(this).text();
      if (num > .10) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .09) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .07) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .04) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
   $('.femaleRow .cell .statNum').each(function() {
    var num = $(this).text();
      if (num > .10) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .09) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .07) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .04) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
   $('.miRow .cell .incomeNum').each(function() {
    var num = $(this).text();
      if (num > 90000) { $(this).addClass("gray5"); $(this).html(d3.format("$,")(num)); }
      else if (num >= 75000) { $(this).addClass("gray4"); $(this).html(d3.format("$,")(num)); } 
      else if (num >= 50000) { $(this).addClass("gray3"); $(this).html(d3.format("$,")(num)); }
      else if (num >= 40000) { $(this).addClass("gray2"); $(this).html(d3.format("$,")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("$,")(num)); }
    });

   if ($('.campaignsRPM').html() == "" && $('.campaignsDFL').html() == "") {
  $('.campaignsRPM, .campaignsDFL').html("No data");
  }
});


function mapColor(d, race, dataCompare){
  if (race == "president"){
    for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].district == Number(d.properties.COUNTYFIPS)){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "r4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "r3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "r2"; }
        else if  (dataCompare[i].vote_pct > 48) { return "r1"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "d4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "d3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "d2"; }
        else if  (dataCompare[i].vote_pct > 48) { return "d1"; }
      }
    }
     
  }
}

if (race == "republicans"){
  for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].DistrictNumber == d.properties.COUNTYNAME || dataCompare[i].DistrictNumber == d.properties.DISTRICT){
  
     if (dataCompare[i].Winner == "RUBIO") {
      if (dataCompare[i].WinnerPct >= .70){ return "purple5"; }
      else if (dataCompare[i].WinnerPct >= .50){ return "purple4"; }
      else if (dataCompare[i].WinnerPct >= .30){ return "purple3"; }
      else if (dataCompare[i].WinnerPct > 0){ return "purple2"; } 
     }
     if (dataCompare[i].Winner == "CRUZ") {
      if (dataCompare[i].WinnerPct >= .70){ return "grayblue5"; }
      else if (dataCompare[i].WinnerPct >= .50){ return "grayblue3"; }
      else if (dataCompare[i].WinnerPct >= .30){ return "grayblue4"; }
      else if (dataCompare[i].WinnerPct > 0){ return "grayblue2"; } 
     }
     if (dataCompare[i].Winner == "TRUMP") {
      if (dataCompare[i].WinnerPct >= .70){ return "orange5"; }
      else if (dataCompare[i].WinnerPct >= .50){ return "orange4"; }
      else if (dataCompare[i].WinnerPct >= .30){ return "orange3"; }
      else if (dataCompare[i].WinnerPct > 0){ return "orange2"; }
     }
     if (dataCompare[i].Winner == "ROMNEY") {
      if (dataCompare[i].WinnerPct >= .70){ return "purple5"; }
      else if (dataCompare[i].WinnerPct >= .50){ return "purple4"; }
      else if (dataCompare[i].WinnerPct >= .30){ return "purple3"; }
      else if (dataCompare[i].WinnerPct > 0){ return "purple2"; } 
     }
     if (dataCompare[i].Winner == "HUCKABEE") {
      if (dataCompare[i].WinnerPct >= .70){ return "grayblue5"; }
      else if (dataCompare[i].WinnerPct >= .50){ return "grayblue3"; }
      else if (dataCompare[i].WinnerPct >= .30){ return "grayblue4"; }
      else if (dataCompare[i].WinnerPct > 0){ return "grayblue2"; } 
     }
     if (dataCompare[i].Winner == "MCCAIN") {
      if (dataCompare[i].WinnerPct >= .70){ return "orange5"; }
      else if (dataCompare[i].WinnerPct >= .50){ return "orange4"; }
      else if (dataCompare[i].WinnerPct >= .30){ return "orange3"; }
      else if (dataCompare[i].WinnerPct > 0){ return "orange2"; }
     }
     if (dataCompare[i].Winner == "PAUL") {
      if (dataCompare[i].WinnerPct >= .70){ return "kasich"; }
      else if (dataCompare[i].WinnerPct >= .50){ return "kasich"; }
      else if (dataCompare[i].WinnerPct >= .30){ return "kasich"; }
      else if (dataCompare[i].WinnerPct > 0){ return "kasich"; }
     }
     if (dataCompare[i].Winner == "TIE") { return "gray3"; }

    }
  }
}
  if (race == "democrats"){
  for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].DistrictNumber == d.properties.COUNTYNAME || dataCompare[i].DistrictNumber == d.properties.DISTRICT){
     if (dataCompare[i].Winner == "SANDERS") {
      if (dataCompare[i].WinnerPct >= .70){ return "green5"; }
      else if (dataCompare[i].WinnerPct >= .50){ return "green4"; }
      else if (dataCompare[i].WinnerPct >= .30){ return "green3"; }
      else if (dataCompare[i].WinnerPct > 0){ return "green2"; } 
     }
     if (dataCompare[i].Winner == "CLINTON") {
      if (dataCompare[i].WinnerPct >= .70){ return "blue5"; }
      else if (dataCompare[i].WinnerPct >= .50){ return "blue4"; }
      else if (dataCompare[i].WinnerPct >= .30){ return "blue3"; }
      else if (dataCompare[i].WinnerPct > 0){ return "blue2"; } 
     }
     if (dataCompare[i].Winner == "OBAMA") {
      if (dataCompare[i].WinnerPct >= .70){ return "green5"; }
      else if (dataCompare[i].WinnerPct >= .50){ return "green4"; }
      else if (dataCompare[i].WinnerPct >= .30){ return "green3"; }
      else if (dataCompare[i].WinnerPct > 0){ return "green2"; } 
     }
     if (dataCompare[i].Winner == "No results") { return "gray3"; }
    }
  }
}

  if (race == "house"){
    for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].district == d.properties.DISTRICT){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "r4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "r3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "r2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "r1"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "d4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "d3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "d2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "d1"; }
      }
    }
     
  }
}
  if (race == "senate"){
    for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].district == d.properties.DISTRICT){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "r4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "r3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "r2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "r1"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "d4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "d3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "d2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "d1"; }
      }
    }
     
  }
 }
}

function mapTips(d, subject, dataCompare){
  if (subject == "republicans" || subject == "democrats"){
      for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].DistrictNumber == d.properties.COUNTYNAME){
      return  "<strong>" + dataCompare[i].DistrictNumber + " County</strong><div class='" + mapColor(d, subject, dataCompare) + "'>" + d3.format("%")(dataCompare[i].WinnerPct) + " " + dataCompare[i].Winner  + " WIN</div>";
    }
    if (dataCompare[i].DistrictNumber == d.properties.DISTRICT){
      return  "<strong>District " + dataCompare[i].DistrictNumber + "</strong><div class='" + mapColor(d, subject, dataCompare) + "'>" + d3.format("%")(dataCompare[i].WinnerPct) + " " + dataCompare[i].Winner  + " WIN</div>";
    }
  }

  return  "<strong>" + d.properties.COUNTYNAME + "</strong>"; 
}
      
    if (subject == "house"){
    for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].district == d.properties.DISTRICT){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "<div><strong>District " + d.properties.DISTRICT + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r4'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 70) { return "<div><strong>District " + d.properties.DISTRICT + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r3'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 60) { return "<div><strong>District " + d.properties.DISTRICT + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r2'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 50) { return "<div><strong>District " + d.properties.DISTRICT + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r1'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "<div><strong>District " + d.properties.DISTRICT + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d4'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 70) { return "<div><strong>District " + d.properties.DISTRICT + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d3'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 60) { return "<div><strong>District " + d.properties.DISTRICT + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d2'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 50) { return "<div><strong>District " + d.properties.DISTRICT + "</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d1'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
      }
    }
     
  }
}
    if (subject == "president"){
    for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].district == Number(d.properties.COUNTYFIPS)){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "<div><strong>" + d.properties.COUNTYNAME + " County</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r4'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 70) { return "<div><strong>" + d.properties.COUNTYNAME + " County</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r3'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 60) { return "<div><strong>" + d.properties.COUNTYNAME + " County</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r2'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 48) { return "<div><strong>" + d.properties.COUNTYNAME + " County</strong></div><div>" + dataCompare[i].candidate + "</div><div class='r1'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "<div><strong>" + d.properties.COUNTYNAME + " County</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d4'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 70) { return "<div><strong>" + d.properties.COUNTYNAME + " County</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d3'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 60) { return "<div><strong>" + d.properties.COUNTYNAME + " County</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d2'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 48) { return "<div><strong>" + d.properties.COUNTYNAME + " County</strong></div><div>" + dataCompare[i].candidate + "</div><div class='d1'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
      }
    }
     
  }
}
  if (subject == "senate"){
    for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].district == d.properties.DISTRICT){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r4'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 70) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r3'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 60) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r2'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 50) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r1'>" +  Math.round(dataCompare[i].vote_pct)+ "% WIN</div>"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d4'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 70) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d3'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 60) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d2'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
        else if  (dataCompare[i].vote_pct > 50) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d1'>" +  Math.round(dataCompare[i].vote_pct) + "% WIN</div>"; }
      }
    }
     
  }
 }
}

function mapBuild(container, boxContainer, chartContainer, shape, race, geo, dataCompare, index) {

var width = $("#mapHouse").width(),
    height = 400,
    centered;

if (geo=="us") { var projection = d3.geo.albersUsa().scale(700).translate([330, 200]); }
else if (geo=="mn") { var projection = d3.geo.albersUsa().scale(5037).translate([50, 970]); }
else if (geo=="metro") { var projection = d3.geo.mercator().scale([16800]).center([-92.403259,44.988113]); }

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select(container + " svg")
    .attr("width", width)
    .attr("height", height);

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height);

var g = svg.append("g");

d3.json("shapefiles/" + shape, function(error, us) {

  g.append("g")
      .attr("class", "states")
    .selectAll("path")
      .data(us.features)
    .enter().append("path")
      .attr("d", path)
      .on("click", clicked)
      .attr("id", function(d) { var str = geo + "_" + d.properties.DISTRICT; return str.replace(new RegExp(" ", "g"),"-"); })
      .attr("precinctName", function(d){ return d.properties.DISTRICT })
      .attr("class", function(d){
         return mapColor(d, race, dataCompare);
        })
       .on("mousedown", function(d, i){   
        if (race == "house" || race == "senate") {
         $(".cfBox").show();
         $("#chatterBox").hide();
        mapStats(d,race,dataCompare);
        $('.districtName').html("<div class='" + mapColor(d, race, dataCompare) + "'>District " + d.properties.DISTRICT + "</div>");
       }
       })
      .style("stroke-width", "1px")
      .style("stroke", "#fff")
      .call(d3.helper.tooltip(function(d, i){
        return mapTips(d, race, dataCompare);
      }));

  g.append("path")
      //.datum(topojson.mesh(us, us.features, function(a, b) { return a !== b; }))
      .attr("id", "state-borders")
      .attr("d", path);

});

var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+ 
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("circle")
            .attr("d", path.projection(projection));
        g.selectAll("path")  
            .attr("d", path.projection(projection)); 

  });

$(".zoom").click(function() {
  clicked2();

  $(".cfBox").hide();
  $("#chatterBox").show();

  // mapReshade("#mapHouse", "mnleg.json", "house", "house", dataHouse);
  // mapReshade("#mapHouseMetro", "mnleg_metro.json", "house", "house", dataHouse);
  // mapReshade("#mapSenate", "mnsenate.json", "senate", "senate", dataSenate);
  // mapReshade("#mapSenateMetro", "mnsenate_metro.json", "senate", "senate", dataSenate);

  // $('#senate .districtName').html("<div class='d3'>Minnesota</div>");
  $('#house .districtName').html("<div class='r3'>Minnesota</div>");
  $('.campaignsRPM, .campaignsDFL, .stats').html("");

  $('.district, .districtS, .districtH, .statNum').removeClass("selected");

  $('.stats').html("<div class='miRow' class='statRow'><div class='cell'><div class='label'>Median Income</div><div class='incomeNum' data='mi'>58476</div></div></div><div class='raceRow' class='statRow'><div class='cell'><div class='label'>White Population</div><div class='statNum' data='whites'>.83</div></div><div class='cell'><div class='label'>Minority Population</div><div class='statNum' data='minorities'>.17</div></div></div><div class='schoolRow' class='statRow'><div class='cell'><div class='label'>High School</div><div class='statNum' data='highschool'>.35</div></div><div class='cell'><div class='label'>Some/Associates</div><div class='statNum' data='associates'>.33</div></div><div class='cell'><div class='label'>Bachelor's</div><div class='statNum' data='bachelors'>.22</div></div><div class='cell'><div class='label'>Graduate</div><div class='statNum' data='graduate'>.11</div></div></div><div class='incomeRow' class='statRow'><div class='cell'><div class='label'>< $40k</div><div class='statNum'>.20</div></div><div class='cell'><div class='label'>$40k-$75k</div><div class='statNum'>.20</div></div><div class='cell'><div class='label'>$75k-$100k</div><div class='statNum'>.20</div></div><div class='cell'><div class='label'>$100k+</div><div class='statNum'>.20</div></div></div><div class='maleRow' class='statRow'><div class='cell'><div class='label'>Men 18-34</div><div class='statNum' data='mYoung'>.12</div></div><div class='cell'><div class='label'>Males 35-49</div><div class='statNum' data='mMiddle'>.07</div></div><div class='cell'><div class='label'>Males 50-64</div><div class='statNum' data='mOld'>.10</div></div><div class='cell'><div class='label'>Males 65+</div><div class='statNum' data='mOldest'>.06</div></div></div><div class='femaleRow' class='statRow'><div class='cell'><div class='label'>Females 18-34</div><div class='statNum' data='fYoung'>.08</div></div><div class='cell'><div class='label'>Females 35-49</div><div class='statNum' data='fMiddle'>.10</div></div><div class='cell'><div class='label'>Females 50-64</div><div class='statNum' data='fOld'>.10</div></div><div class='cell'><div class='label'>Females 65+</div><div class='statNum' data='fOldest'>.07</div></div></div>");

$(".statNum, .incomeNum").click(function() {
  $(".statNum, .incomeNum").removeClass("selected");
  $(this).addClass("selected");
  mapReshade("#mapHouse", "mnleg.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapHouseMetro", "mnleg_metro.json", $(this).attr("data"), "house", dataHouse);
  // mapReshade("#mapSenate", "mnsenate.json", $(this).attr("data"), "senate", dataSenate);
  // mapReshade("#mapSenateMetro", "mnsenate_metro.json", $(this).attr("data"), "senate", dataSenate);
});

});

function clicked(d) {
  var x, y, k;

  // mapReshade("#mapHouse", "mnleg.json", "house", "house", dataHouse);
  // mapReshade("#mapHouseMetro", "mnleg_metro.json", "house", "house", dataHouse);
  // mapReshade("#mapSenate", "mnsenate.json", "senate", "senate", dataSenate);
  // mapReshade("#mapSenateMetro", "mnsenate_metro.json", "senate", "senate", dataSenate);

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 6;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 3;
    centered = null;
  }

  g.selectAll("path")
      .classed("faded", true)
      .classed("active", centered && function(d) { return d === centered; });

  // g.transition()
  //     .duration(750)
  //     .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
  //     .style("stroke-width", 1.5 / k + "px");
}

function clicked2(d) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 1;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("path")
      .classed("faded", false)
      .classed("active", centered && function(d) { return d === centered; });

  // g.transition()
  //     .duration(750)
  //     .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
  //     .style("stroke-width", 1.5 / k + "px");
}

d3.helper = {};

d3.helper.tooltip = function(accessor){
    return function(selection){
        var tooltipDiv;
        var bodyNode = d3.select('body').node();
        selection.on("mouseover", function(d, i){
            // Clean up lost tooltips
            d3.select('body').selectAll('div.tooltip').remove();
            // Append tooltip
            tooltipDiv = d3.select('body').append('div').attr('class', 'tooltip');
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px')
                .style('position', 'absolute') 
                .style('z-index', 1001);
            // Add text using the accessor function
            var tooltipText = accessor(d, i) || '';
            // Crop text arbitrarily
            //tooltipDiv.style('width', function(d, i){return (tooltipText.length > 80) ? '300px' : null;})
            //    .html(tooltipText);
        })
        .on('mousemove', function(d, i) {
            // Move tooltip
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px');
            var tooltipText = accessor(d, i) || '';
            tooltipDiv.html(tooltipText);
        })
        .on("mouseout", function(d, i){
            // Remove tooltip
            tooltipDiv.remove();
        });

    };
};

}

function mapReshade(container, shape, subject, race, dataCompare) {

  var ageData;
  var schoolData;
  var incomeData;

d3.json("shapefiles/" + shape, function(error, us) {

d3.selectAll(container + " svg g path")
      .data(us.features)
      .attr("class", function(d){
        if (subject == "senate" || subject == "house") { return mapColor(d, race, dataCompare); }
        else if (subject == "whites") {
          whites = d.properties.F_NH18_WHT; 
          if (whites >= .80) { return "gray5"; }
          else if (whites >= .60) { return "gray4"; }
          else if (whites >= .40) { return "gray3"; }
          else if (whites >= .20) { return "gray2"; }
          else if (whites > 0) { return "gray1"; }
        } 
        else if (subject == "minorities") { 
          minorities = Number(d.properties.F_NH18_DO2) + Number(d.properties.F_NH18_DO1) + Number(d.properties.F_NH18_DOJ) + Number(d.properties.F_H18_POP) + Number(d.properties.F_NH18_DO3) + Number(d.properties.F_NH18_DO4);
          if (minorities >= .25) { return "gray5"; }
          else if (minorities >= .20) { return "gray4"; } 
          else if (minorities >= .15) { return "gray3"; }
          else if (minorities >= .10) { return "gray2"; }
          else if (minorities > 0) { return "gray1"; }
        }
        else if (subject == "mYoung") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var maleYoung = ageData[i].male_18_to_34 / population;
          if (maleYoung > .10) { return "gray5"; }
          else if (maleYoung >= .09) { return "gray4"; } 
          else if (maleYoung >= .07) { return "gray3"; }
          else if (maleYoung >= .04) { return "gray2"; }
          else if (maleYoung > 0) { return "gray1"; }
           }
          }
         } 
        else if (subject == "mMiddle") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var maleMiddle = ageData[i].male_35_to_49 / population;
          if (maleMiddle > .10) { return "gray5"; }
          else if (maleMiddle >= .09) { return "gray4"; } 
          else if (maleMiddle >= .07) { return "gray3"; }
          else if (maleMiddle >= .04) { return "gray2"; }
          else if (maleMiddle > 0) { return "gray1"; }
           }
          }
         } 
        else if (subject == "mOld") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var maleOld = ageData[i].male_50_to_64 / population;
          if (maleOld > .10) { return "gray5"; }
          else if (maleOld >= .09) { return "gray4"; } 
          else if (maleOld >= .07) { return "gray3"; }
          else if (maleOld >= .04) { return "gray2"; }
          else if (maleOld > 0) { return "gray1"; }
           }
          }
         }
        else if (subject == "mOldest") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var maleOldest = ageData[i].male_65_over / population;
          if (maleOldest > .10) { return "gray5"; }
          else if (maleOldest >= .09) { return "gray4"; } 
          else if (maleOldest >= .07) { return "gray3"; }
          else if (maleOldest >= .04) { return "gray2"; }
          else if (maleOldest > 0) { return "gray1"; }
           }
          }
        }
        else if (subject == "fYoung") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) {  
          population = Number(d.properties.POPULATION);
          var femaleYoung = ageData[i].female_18_to_34 / population;
          if (femaleYoung > .10) { return "gray5"; }
          else if (femaleYoung >= .09) { return "gray4"; } 
          else if (femaleYoung >= .07) { return "gray3"; }
          else if (femaleYoung >= .04) { return "gray2"; }
          else if (femaleYoung > 0) { return "gray1"; }
           }
          }
         } 
        else if (subject == "fMiddle") {
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) {
          population = Number(d.properties.POPULATION);
          var femaleMiddle = ageData[i].female_35_to_49 / population;
          if (femaleMiddle > .10) { return "gray5"; }
          else if (femaleMiddle >= .09) { return "gray4"; } 
          else if (femaleMiddle >= .07) { return "gray3"; }
          else if (femaleMiddle >= .04) { return "gray2"; }
          else if (femaleMiddle > 0) { return "gray1"; }
           }
          }
        } 
        else if (subject == "fOld") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var femaleOld = ageData[i].female_50_to_64 / population;
          if (femaleOld > .10) { return "gray5"; }
          else if (femaleOld >= .09) { return "gray4"; } 
          else if (femaleOld >= .07) { return "gray3"; }
          else if (femaleOld >= .04) { return "gray2"; }
          else if (femaleOld > 0) { return "gray1"; }
           }
          }
        }
        else if (subject == "fOldest") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var femaleOldest = ageData[i].female_65_over / population;
          if (femaleOldest > .10) { return "gray5"; }
          else if (femaleOldest >= .09) { return "gray4"; } 
          else if (femaleOldest >= .07) { return "gray3"; }
          else if (femaleOldest >= .04) { return "gray2"; }
          else if (femaleOldest > 0) { return "gray1"; }
           }
          }
        }
        else if (subject == "highschool") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
            for (var j=0; j < dataEI.length; j++){
              if (dataEI[j].county == ageData[i].county){
                var highschool = dataEI[j].highschool_pct;
                if (highschool > .35) { return "gray5"; }
                else if (highschool >= .30) { return "gray4"; } 
                else if (highschool >= .20) { return "gray3"; }
                else if (highschool >= .10) { return "gray2"; }
                else if (highschool > 0) { return "gray1"; }
              }
            }
           }
          }
         }
        else if (subject == "associates") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
            for (var j=0; j < dataEI.length; j++){
              if (dataEI[j].county == ageData[i].county){
                var associates = dataEI[j].associates_pct;
                if (associates > .35) { return "gray5"; }
                else if (associates >= .30) { return "gray4"; } 
                else if (associates >= .20) { return "gray3"; }
                else if (associates >= .10) { return "gray2"; }
                else if (associates > 0) { return "gray1"; }
              }
            }
           }
          }
         }
        else if (subject == "bachelors") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
            for (var j=0; j < dataEI.length; j++){
              if (dataEI[j].county == ageData[i].county){
                var bachelors = dataEI[j].bachelors_pct;
                if (highschool > .35) { return "gray5"; }
                else if (bachelors >= .30) { return "gray4"; } 
                else if (bachelors >= .20) { return "gray3"; }
                else if (bachelors >= .10) { return "gray2"; }
                else if (bachelors > 0) { return "gray1"; }
              }
            }
           }
          }
         }
        else if (subject == "graduate") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
            for (var j=0; j < dataEI.length; j++){
              if (dataEI[j].county == ageData[i].county){
                var graduate = dataEI[j].grad_degree_pct;
                if (graduate > .35) { return "gray5"; }
                else if (graduate >= .30) { return "gray4"; } 
                else if (graduate >= .20) { return "gray3"; }
                else if (graduate >= .10) { return "gray2"; }
                else if (graduate > 0) { return "gray1"; }
              }
            }
           }
          }
         }
        else if (subject == "mi") { 
            for (var i=0; i < dataMI.length; i++){
          if (dataMI[i].district == d.properties.DISTRICT) { 
             var income = dataMI[i].median_income;
                if (income > 90000) { return "gray5"; }
                else if (income >= 75000) { return "gray4"; } 
                else if (income >= 50000) { return "gray3"; }
                else if (income >= 40000) { return "gray2"; }
                else if (income > 0) { return "gray1"; }
           }
          }
         }
        else if (subject == "hot") { 
    for (var i=0; i < dataCompare.length; i++){
      if (d.properties.DISTRICT == dataCompare[i].district){
    if (d.properties.DISTRICT == "02A" || d.properties.DISTRICT == "05B" || d.properties.DISTRICT == "11B" || d.properties.DISTRICT == "12A" || d.properties.DISTRICT == "14B" || d.properties.DISTRICT == "17A" || d.properties.DISTRICT == "17B" || d.properties.DISTRICT == "21A" || d.properties.DISTRICT == "24B" || d.properties.DISTRICT == "25B" || d.properties.DISTRICT == "42B" || d.properties.DISTRICT == "42B" || d.properties.DISTRICT == "48A" || d.properties.DISTRICT == "49A" || d.properties.DISTRICT == "50B" || d.properties.DISTRICT == "51B" || d.properties.DISTRICT == "52B" || d.properties.DISTRICT == "56B" || d.properties.DISTRICT == "57A" || d.properties.DISTRICT == "10A" || d.properties.DISTRICT == "10B" || d.properties.DISTRICT == "36B" || d.properties.DISTRICT == "37B" || d.properties.DISTRICT == "43A" || d.properties.DISTRICT == "49B" || d.properties.DISTRICT == "51B" || d.properties.DISTRICT == "54A"){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "r4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "r3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "r2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "r1"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "d4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "d3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "d2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "d1"; }
      }
    }
     
  }
}
 return "mid";
         }
        else if (subject == "open") { 
    for (var i=0; i < dataCompare.length; i++){
      if (d.properties.DISTRICT == dataCompare[i].district){
    if (d.properties.DISTRICT == "25B" || d.properties.DISTRICT == "42B" || d.properties.DISTRICT == "52B" || d.properties.DISTRICT == "54A"){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "r4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "r3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "r2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "r1"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "d4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "d3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "d2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "d1"; }
      }
    }
     
  }
}
 return "mid";
         }
        else if (subject == "rematch") { 
    for (var i=0; i < dataCompare.length; i++){
      if (d.properties.DISTRICT == dataCompare[i].district){
    if (d.properties.DISTRICT == "02A" || d.properties.DISTRICT == "10A" || d.properties.DISTRICT == "10B" || d.properties.DISTRICT == "11B" || d.properties.DISTRICT == "12A" || d.properties.DISTRICT == "14B" || d.properties.DISTRICT == "17A" || d.properties.DISTRICT == "17B" || d.properties.DISTRICT == "24B" || d.properties.DISTRICT == "56B" || d.properties.DISTRICT == "50B" || d.properties.DISTRICT == "27A"){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "r4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "r3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "r2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "r1"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "d4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "d3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "d2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "d1"; }
      }
    }
     
  }
}
 return "mid";
         }
        });

});

}

  mapBuild("#mapHouseMetro", "#houseInfo", "#chart", "mnleg_metro.json", "house", "metro", dataHouse, 0);
  mapBuild("#mapHouse", "#houseInfo", "#chart", "mnleg.json", "house", "mn", dataHouse, 0);

d3.json("https://script.googleusercontent.com/a/macros/umn.edu/echo?user_content_key=PahRwKXbBmdPBR_zskpQ0e9Rsz5FD91vt7y8Tb8rbel0EzQgiVXwBiZh10bJinkWJZEdRQNnBKfjl9zpxCCuaEgQKAZeXFxmOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMi80zadyHLKASbbMAF6orU02DLGwV8tFzI-mtKRf-8plGOUy-lJCxpF2DQLccfmsBGWAyiujVfWxmelbCou2EhfNg1xV69xW9102aPo2dzOHb2n-wR3_qIcJs9R6OT1ISRLcbuTVicb0_PJoWYImjrn_pcMfBDMCim364kuLr7FeBM6mFz96I24KQm0nAqW0CG_op5-kG2yA&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataLoadDS) {

  var dataDSum = dataLoadDS.d2016Summary;

  mapBuild("#mapCaucusD", "#houseInfo", "#chart", "dCaucus.json", "democrats", "mn", dataDSum, 0);
  mapBuild("#mapCaucusDMetro", "#houseInfo", "#chart", "dCaucus_metro.json", "democrats", "metro", dataDSum, 0);
  
});

d3.json("https://script.googleusercontent.com/a/macros/umn.edu/echo?user_content_key=Mpi75eTg4FkYGf1VUKNF1s7povTGmic551WM75h5GDJ1D2ps5ZL4XMqI4wmikhFeVwY4OUnI8yy90c1jb6tDpsQdoCCwEKXtOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMi80zadyHLKASbbMAF6orU02DLGwV8tFzI-mtKRf-8plGOUy-lJCxpF2DQLccfmsBGWAyiujVfWxmelbCou2EhfNg1xV69xW9102aPo2dzOHb2n-wR3_qIcJs9R6OT1ISRLcbuTVicb0_PJoWYImjrn_pcMfBDMCim364kuLr7FeBM6mFz96I202jFKE_sD0XG_op5-kG2yA&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataLoadRS) {

  var dataRSum = dataLoadRS.r2016Summary;

  mapBuild("#mapCaucusR", "#houseInfo", "#chart", "rCaucus.json", "republicans", "mn", dataRSum, 0);
  mapBuild("#mapCaucusRMetro", "#houseInfo", "#chart", "rCaucus_metro.json", "republicans", "metro", dataRSum, 0);

});

d3.json("https://script.googleusercontent.com/macros/echo?user_content_key=zs_efiWQpuDo1zzst_nCCrNMOkx-V5zomDQ0IvY-fjXeBdFzl1S5WktUHOIFhCL6latAUrW8KbJgBDbIFRSfuQQKflEwAXl5OJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMWojr9NvTBuBLhyHCd5hHaxCoMjMSmZWLp6XAShvjQj50JtCfh4yP7n1RnEoDeOH7XqmOXgX8RYIyMAhIAtjnF9UDzNXGLr6TBHEYYwTQVL-nJJo0cL1P4iOF-V7I6dwT5m24bheqF3AYZuLqWNb2ghgFwgr7wLN735iDyrfKhrrbnIo1ZVXhBA&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataPrez) {

  mapBuild("#mapCounties", "#houseInfo", "#chart", "counties.json", "president", "mn", dataPrez.mn2012, 0);
  mapBuild("#mapCountiesMetro", "#houseInfo", "#chart", "counties_metro.json", "president", "metro", dataPrez.mn2012, 0);

});

  // mapBuild("#mapSenateMetro", "#senateInfo", "#chart", "mnsenate_metro.json", "senate", "metro", dataSenate, 1);
  // mapBuild("#mapSenate", "#senateInfo", "#chart", "mnsenate.json", "senate", "mn", dataSenate, 1);

  tableBuild("#tableHouse","house",dataHouse,null,null,0);
  // tableBuild("#tableSenate","senate",dataSenate,null,null,1);

});
});
});
});
});
});
// });
// });
// });
</script>

</html>