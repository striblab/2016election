<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Minnesota's Political Divide</title>
  <meta name="description" content="Minnesota's Political Divide">
  <meta name="author" content="Frey Hargarten - StarTribune">

  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.css' rel='stylesheet' />
  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  <link href="../_common_resources/charts/c3-master/c3.css" rel="stylesheet" type="text/css">
  <link href="../_common_resources/charts/nvd3-master/build/nv.d3.css" rel="stylesheet" type="text/css">
  
  <style>
/*BASE*/
    body { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }
    #wrapper { width:920px; margin-right:auto; margin-left:auto; }
    .slide { margin-bottom:30px; }
    a { color:steelblue; }

/*MAPS*/
    #vMap { width:100%; height:300px; }
    .map-overlay-container { position: absolute; width:400px; top: 0; left: 0; padding: 10px; z-index: 1; }
    .map-overlay { font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif; background-color: #fff; border-radius: 3px; padding: 10px; box-shadow:0 1px 2px rgba(0,0,0,0.20); }
    .map-overlay h2, .map-overlay p { margin: 0 0 10px; }
    .mapboxgl-ctrl-attrib { display:none; }
    .text { fill:#ffffff !important;  }
    rect:hover, text:hover { background-color:#333 !important; cursor:pointer; opacity:.5; }
    #gopMaps { float:right; text-align:center; }
    #demMaps { float:left; text-align:center; }
    #demMaps path:hover, #gopMaps path:hover { cursor:default !important; }

/*CARTOGRAM*/
    .dem rect { fill:#3F88C5 !important; }
    .rep rect { fill:#D90429 !important; }
    .battleground rect { fill:#cccccc !important; }
    .cartoState:hover { opacity:0.5; }
    .cartoState rect { stroke-width:0.8px; stroke:#fff !important; }
    .cartoState rect:hover { opacity:1; cursor:default; }
    #cartogram { text-align:center; }
    #cartogram text { font-weight:900; pointer-events:none !important;}
    polygon { stroke:#000 !important; stroke-width:1px; }
    .stateLabel { display:inline-block; width:78%; text-align:left; background-color:transparent !important; }
    .votes { display:inline-block; width:20%; text-align:right; background-color:transparent !important; }
    .stateLabel { font-family:"Benton Sans",Helvetica,Arial,sans-serif !important; font-weight:400; }

/*BUTTONS*/
    .switch, .step{ padding:2px; display:inline-block; width:100%; background-color:#fff; font-weight:900; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border:1px solid black; margin:0 !important; margin:2px !important; }
    .switch:hover, .selected, .step:hover { background-color:#4C4C39 !important; color:#fff !important; cursor:pointer; margin:2px !important; }

/*CHATTER*/
    .chatterHead { font-weight:900; font-size:1.2em; text-align:left; }
    .chatter { width:90%; text-align:left; }

/*CHARTS*/
    .fadeline { opacity:0.5; }
    .powerline { stroke-dasharray:5,5; stroke:#333; }
/*    .c3-axis-y .domain { stroke:#fff !important; }
    .c3-axis-y .domain, .c3-axis-y .domain line { stroke:#fff !important; }*/
    .fChart { width:49%; display:inline-block; }
    #hChart { text-align:right; }
    .regionChart { width:48%; display:inline-block; }
    .rBar, .rLabel { display:inline-block; width:32%; }
    .bars { height:200px; }
    #chartH .c3-line { stroke-width:5px !important; opacity:0 !important; }
    #chartDivideR .c3-line, #chartDivideD .c3-line { stroke-width:5px !important; }
    #chartH .c3-area { opacity:0.8 !important; }
    .smallChartLabel { width:48%; display:inline-block; font-size:1em; font-weight:900; text-align:center; }
    #chartD .c3-circle { stroke-width:1px; stroke:#333 !important; }
    .adjacent { width:48%; display:inline-block; text-align:center; }
    #chartD path:hover, #voteMap path:hover { fill:#333 !important; }
    .tip { color:#fff; } 
    .slide { display:none; }

/*POWERBAR*/
    .powerBar { text-align:center; vertical-align:top; }
    .rows { width:47px;  display:inline-block; vertical-align:bottom; }
    .rowMid { width:85%; display:inline-block; }
    #dBar { width:37%; margin-bottom:21px; }
    #rBar { width:53%; margin-bottom:21px; }
    #dlBar { width:0; margin-bottom:21px; }
    #rlBar { width:0; margin-bottom:21px; }
    #dwBar { width:0; margin-bottom:21px; }
    #rwBar { width:0; margin-bottom:21px; }
    #tBar { width:0; margin-bottom:21px; }
    .bar { height:20px; width:100%; vertical-align:top; }
    .half { display:inline-block; height:20px;  }
    .bigNum { font-size:2.5em !important; }

/*LEGENDS*/
    .legends { width:390px; height:auto; text-align:center; margin-right:auto; margin-left:auto; vertical-align:top; }
    .legend label, .legend span { display: block; float: left; height: 15px; width: 50px; text-align: center; font-size: 12px;color: #808080; font-family:"Benton Sans",Helvetica,Arial,sans-serif !important; }
    #legends { display:block; height:auto; margin-right:auto; margin-left:auto; clear:both; }
    #legendMain { text-align:center; font-family:"Benton Sans",Helvetica,Arial,sans-serif; }
    #legendMain .legends { display:inline-block; width:30%; text-align:center; }

/*SWATCHES*/
    .republican { color:#8C1B17; fill:#8C1B17 !important; pointer-events: all; font-weight:bold; }
    .r1 { background-color:#C68985; fill:#C68985 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .r2 { background-color:#A5484D; fill:#A5484D !important; color:white !important; pointer-events: all; font-weight:bold; }
    .r3 { background-color:#A52129; fill:#A52129 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .r4 { background-color:#8C1B17; fill:#8C1B17 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .r0 { background-color:#8C1B17; fill:#8C1B17 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .mid { background-color:#ddd; fill:#ddd !important; color:black !important; pointer-events: all; font-weight:bold; }
    .democrat { color:#3F88C5; fill:#3F88C5 !important; pointer-events: all; font-weight:bold;  }
    .d1 { background-color:#ABCEE8; fill:#ABCEE8 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .d2 { background-color:#5ca5c3; fill:#5ca5c3 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .d3 { background-color:#4f97c4; fill:#4f97c4 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .d4 { background-color:#3f88c5; fill:#3f88c5 !important; color:white !important; pointer-events: all; font-weight:bold; }
    .d0 { background-color:#3F88C5; fill:#3F88C5 !important; color:white !important; pointer-events: all; font-weight:bold; }

    .grayblue1 { fill:#A4EBEB; background-color:#A4EBEB; color:#fff; font-weight:900; }
    .grayblue2 { fill:#6ED5D5; background-color:#6ED5D5; color:#fff; font-weight:900; }
    .grayblue3 { fill:#46BCBC; background-color:#46BCBC; color:#fff; font-weight:900; }
    .grayblue4 { fill:#28A3A3; background-color:#28A3A3; color:#fff; font-weight:900; }
    .grayblue5 { fill:#099393; background-color:#099393; color:#fff; font-weight:900; }  

    .demSwatch { background-color:#0D4773; fill:#0D4773 !important; pointer-events: all; font-weight:bold; }
    .gopSwatch { background-color:#9C0004; fill:#9C0004 !important; pointer-events: all; font-weight:bold; }  

    .president { height:640px; overflow-x:hidden; overflow-y:auto; }  

    #leftPane { float:left; width:50%; text-align:center; }
    #rightPane { float:right; width:48%; }   

    #tableR, #tableD, #rTables, div[data='gop'], .metro { display:none; }  

    .carson { fill:#D97171; background-color:#D97171; font-weight:900; color:#fff; }
    .kasich { fill:#DF95AF; background-color:#DF95AF; font-weight:900; color:#fff; }
    .gray3 { font-weight:900; color:#fff; }  

    .blue5 { fill:#325998; background-color:#325998; font-weight:900; color:#fff; }
    .blue4 { fill:#3F88C5; background-color:#3F88C5; font-weight:900; color:#fff; }
    .blue3 { fill:#83acc3; background-color:#83acc3; font-weight:900; color:#fff; }
    .blue2 { fill:#abd5d8; background-color:#abd5d8; font-weight:900; color:#fff; }  

    .green5 { fill:#604a8f; background-color:#604a8f; font-weight:900; color:#fff; }
    .green4 { fill:#8672a8; background-color:#8672a8; font-weight:900; color:#fff; }
    .green3 { fill:#ad9ac1; background-color:#ad9ac1; font-weight:900; color:#fff; }
    .green2 { fill:#d3c2da; background-color:#d3c2da; font-weight:900; color:#fff; }  

    .orange5  { fill:#c73d2b; background-color:#c73d2b; font-weight:900; color:#fff; }
    .orange4 { fill:#d76256; background-color:#d76256; font-weight:900; color:#fff; }
    .orange3 { fill:#8C1B17; background-color:#8C1B17; font-weight:900; color:#fff; }
    .orange2 { fill:#8C1B17; background-color:#8C1B17; font-weight:900; color:#fff; }  

    .purple5 { fill:#cc7133; background-color:#cc7133; font-weight:900; color:#fff; }
    .purple4 { fill:#d58e4e; background-color:#d58e4e; font-weight:900; color:#fff; }
    .purple3 { fill:#ddac6a; background-color:#ddac6a; font-weight:900; color:#fff; }
    .purple2 { fill:#e6c985; background-color:#e6c985; font-weight:900; color:#fff; }  

    .grayblue5 { fill:#9e5d52; background-color:#9e5d52; font-weight:900; color:#fff; }
    .grayblue4 { fill:#b57f73; background-color:#b57f73; font-weight:900; color:#fff; }
    .grayblue3 { fill:#cba093; background-color:#cba093; font-weight:900; color:#fff; }
    .grayblue2 { fill:#e2c2b4; background-color:#e2c2b4; font-weight:900; color:#fff; }

/*DROPDOWN*/
    .wrapper-demo { width:100%; }
    .wrapper-dropdown-1 { display:inline-block;font-family:"Benton Sans",Helvetica,Arial,sans-serif;z-index:900;background:#ddd;color:#333;cursor:pointer;font-weight:bold;outline:none;padding:8px;position:relative;width:200px;border:1px solid #aaa;box-shadow:0 2px 1px rgba(0, 0, 0, 0.10);font-size:14px; width:100%; }
    .wrapper-dropdown-1 .dropdown { font-weight:normal;left:0;list-style:none;opacity:0;pointer-events:none;position:absolute;right:0;top:100%;border:1px solid #aaa;background:#fff;box-shadow:0 4px 5px rgba(0, 0, 0, 0.15);margin-top:0px !important; }
    ul.dropdown.months { box-sizing:border-box;margin:0;moz-box-sizing:border-box;padding:0;webkit-box-sizing:border-box;margin-top:-1px;border-radius:0 0 4px 4px;background-clip:padding-box; }
    .wrapper-dropdown-1 .dropdown { font-weight:normal;left:0;list-style:none;opacity:0;pointer-events:none;position:absolute;right:0;top:100%;border:1px solid #aaa;background:#fff;box-shadow:0 4px 5px rgba(0, 0, 0, 0.15);margin-top:0px !important; }
    .wrapper-dropdown-1 .dropdown li:hover a { background:#EFEFEF; }
    header[role="banner"] { width:100%;height:40px;z-index:1000;background:#f0f0f0; }

/*BREAKPOINTS*/
    @media (max-width:920px) {
        .adjacent { width:100%; display:block; }
        #wrapper { width:100%; }
        .legends { width:100% !important; }
        #gopMaps { float:none; width:100%; }
        #demMaps { float:left; width:100%;  }
    }
  </style> 
</head>

<body>
  <div id="wrapper">

<div id="dataviz">

<div class="slide" id="divide">
<div class="chatterHead">Minnesota's growing political divide</div>
<div class="chatter">Over the last two decades, Minnesota's regional political divide has grown significantly, with the Twin Cities and other urban areas becoming more Democrat while the suburbs and outstate have turned more Republican.</div>
<div class="adjacent">
<div id="chartDivideD"></div>
<h4>Percentage of Democrat vote</h4>
</div>
<div class="adjacent">
<div id="chartDivideR"></div>
<h4>Percentage of Republican vote</h4>
</div>
</div>

<div class="slide" id="margins">
<div class="chatterHead">Narrowing the margins</div>
<div class="chatter">The margins by which Republicans and Democrats have won in their respective districts have increased as well, marking increased political polarization among the parties and voters. The chart below shows the percentage of precincts by presidential win margin, with 1 being a low margin and 4 being a high margin. High margin precincts were very few in the 1990's but increased over time.</div>
<div id="chartMargins"></div>
</div>

<div class="slide" id="voting">
<div class="chatterHead">The metro effect</div>
<div class="chatter">The Twin Cities and suburbs have higher voter turnout and typically account for a larger proportion of DFL votes in the state.</div>

<div class="adjacent">
<div class="smallChart" id="popChart"></div>
<div class="smallChartLabel">Population versus Votes</div>
</div>
<div class="adjacent">
<div class="smallChart" id="voterChart"></div>
<div class="smallChartLabel">Voter Turnout</div>
</div>
</div>

<div class="slide" id="age">
<div class="chatterHead">A regional age gap</div>
<div class="chatter">The Twin Cities has a far higher percentage of younger voters, who more often vote Democrat, than other regions of the state.</div>
<div id="chartAge"></div>
</div>

<!-- <div class="slide" id="polling">
<div class="chatterHead">Presidential polling in 2016</div>
<div class="chatter">The political divide is very stark in Star Tribune Minnesota Polls with the heaviest Trump support found in outstate and the suburbs while Clinton overwhelmingly leads in the Twin Cities.</div>
<div id="chartPolls"></div>
</div> -->

<div class="slide" id="whitedistress">
<div class="chatterHead">White distress in outstate</div>
<div class="chatter">Nationally, presidential candidate <span class="republican">Donald Trump (R)</span> is leading in few demographics, but a recent Gallup survey of more than 87,000 respondents revealed the typical Trump voter to be white, male, older, less education and living in areas with high premature death rates, which when indexed together paints a picture of white distress primarily found more commonly in outstate counties compared to the metro.</div>

<div class="adjacent">
<div id="chartD"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
<h4>White Distress Index</h4>
<div id="quantize">
<span class='legend' id="aidQ">
  <nav class='legend clearfix'>
    <span style='background:#fff;'>Less</span>
    <span style='background:#cccccc;'></span>
    <span style='background:#969696'></span>
    <span style='background:#525252'></span>
    <span style='background:#fff;'>More</span>
</span>
</div>
</div>
<div class="adjacent">
<div id="voteMap"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
<h4>2012 Presidential Results</h4>
<div id="quantize">
<span class='legend' id="aidQ">
  <nav class='legend clearfix'>
    <span style='background:#fff;'>DEM</span>
    <span style='background:#3F88C5'></span>
    <span style='background:#8C1B17'></span>
    <span style='background:#fff;'>GOP</span>
</span>
</div>
</div>
</div>

<div class="slide" id="finance">
<div class="chatterHead">Money talks</div>
<div class="chatter">Donald Trump and other Republican presidential campaigns have received a far higher percentage of their  donations from outstate and suburban sources in 2016 than Democrats who draw primarily from the Twin Cities.</div>
<div id="chartFinance"></div>
</div>

</div>

  </div>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="../_common_resources/charts/c3-master/c3.min.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.21.0/mapbox-gl.js'></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script src="../_common_resources/charts/nvd3-master/build/nv.d3.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/utils.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/tooltip.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/models/legend.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/models/axis.js"></script>
<script src="../_common_resources/charts/nvd3-master/test/stream_layers.js"></script>
<script>

$(".step").click(function() {
$(".step").removeClass("selected");
$(this).addClass("selected");
});

$.urlParam = function(name){
  var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
  if (results != null) { return results[1] || 0; }
  else { return null; }
}

var selected = $.urlParam('chart');

if (selected != null){
$(".slide").hide();
$("#" + selected).show();
} else { $(".slide").show(); }

//WHITE DISTRESS
  d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=1dmWuUyYnLo9599ikNdLY5ZfbPkFk8pmSPUWhlpgAfUU&sheet=white_distress", function(error, dataLoadD) {

var dataD = dataLoadD.white_distress;

// function spillChartD(container, data){
// var axis = [];
// var counties = [];

// axis[0] = 'White Distress Index';
// counties[0] = 'County';

// for (var i=0; i < dataD.length; i++){
//     axis[i+1] = dataD[i].index;
//     counties[i+1] = dataD[i].county;
// }

// var  padding = {
//         top: 20,
//         right: 60,
//         bottom: 20,
//         left: 130,
//     };

// var chart = c3.generate({
//       bindto: container,
//       padding: padding,
//     data: {
//         columns: [
//             axis 
//         ],
//         type: 'bar',
//         colors:  { 
//           'White Distress Index': function(d) { 

//             console.log(d.value);

//             var party = "";

//            for (var k=0; k < dataD.length; k++){
//                 if (dataD[k].index == d.value){
//                   party = dataD[k].win2012;
//                   break;
//                 }
//               }

//               if (party == "DEM") { return "#3F88C5"; }
//               else if (party == "GOP") { return "#8C1B17"; }
//           }
//         },
//          },        
//     legend: {
//         show: false
//     },
//     axis: {
//         rotated: true,
//       y: {
//             min: 0,
//             // label: 'White Distress Index',
//             padding: {bottom: 0},
//             tick: {
//              count: 4,
//              // values: [0,250000,500000,8800000],
//              format: d3.format(',.0f')
//             }
//         },
//         x: {
//             type: 'category',
//             categories: ["Clearwater", "Marshall", "Wadena", "Cass", "Itasca", "Kittson", "Beltrami", "Mille Lacs", "Carlton", "Pine", "Renville", "Norman", "Aitkin", "Grant", "Hubbard", "Polk", "Roseau", "Redwood", "McLeod", "Cottonwood", "Becker", "Koochiching", "Chippewa", "Winona", "Todd", "Rock", "Pipestone", "Jackson", "Douglas", "Crow Wing", "Isanti", "Clay", "Wilkin", "Kandiyohi", "Scott", "Benton", "Faribault", "Goodhue", "Meeker", "Kanabec", "Brown", "Lake", "Freeborn", "Otter Tail", "Watonwan", "Chisago", "Ramsey", "Mahnomen", "Pennington", "Morrison", "Mower", "Wright", "Sibley", "St. Louis", "Fillmore", "Murray", "Anoka", "Lac qui Parle", "Nobles", "Blue Earth", "Hennepin", "Steele", "Lyon", "Yellow Medicine", "Stearns", "Dodge", "Houston", "Sherburne", "Pope", "Waseca", "Stevens", "Martin", "Olmsted", "Wabasha", "Dakota", "Rice", "Washington", "Le Sueur", "Nicollet", "Carver", "Big Stone", "Traverse", "Swift", "Red Lake", "Lincoln", "Lake of the Woods", "Cook"],
//             // label: "White Distress Index",
//             tick: {
//                 // count: 4,
//                 multiline: false,
//                 // format: d3.format(',.0f')
//             }
//           }
//         }
// });
// }

// spillChartD("#chartD", dataD);

function dMap(){
var width = 350,
    height = 350,
    centered;

var projection = d3.geo.albersUsa()
    .scale(5037)
    .translate([50, 970]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#chartD svg")
    .attr("width", width)
    .attr("height", height);

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height);

var g = svg.append("g");

var q1 = "#cccccc";
var q3 = "#969696";
var q5 = "#525252";

d3.json("shapefiles/counties.json", function(error, us) {

  g.append("g")
      .attr("id", "states")
    .selectAll("path")
      .data(us.features)
    .enter().append("path")
      .attr("d", path)
      // .on("click", clicked)
      .style("fill", function(d){
         for (var i = 0; i < 87; i++){
            if (d.properties.COUNTYNAME == dataD[i].county) { 
              if (dataD[i].index >= 400) { return q5; }
              else if (dataD[i].index >= 200) { return q3; }
              else if (dataD[i].index >= 0) { return q1; }
            }
          }
        })
      .style("stroke-width", "1.5px")
      .style("stroke", "#fff")
      .call(d3.helper.tooltip(function(d, i){

         for (var i = 0; i < 87; i++){
            if (d.properties.COUNTYNAME == dataD[i].county) { 
              if (dataD[i].index >= 400) { return d.properties.COUNTYNAME + "<div class='tip' style='background-color:" + q5 + ";'>" + d3.format(".0f")(dataD[i].index) + " white distress index</div>"; }
              else if (dataD[i].index >= 200) { return d.properties.COUNTYNAME + "<div class='tip' style='background-color:" + q3 + ";'>" + d3.format(".0f")(dataD[i].index) + " white distress index</div>"; }
              else if (dataD[i].index >= 0) { return d.properties.COUNTYNAME + "<div class='tip' style='background-color:" + q1 + ";'>" + d3.format(".0f")(dataD[i].index) + " white distress index</div>"; }
              else { return none; }
            }
          }
        }));


  g.append("path")
      //.datum(topojson.mesh(us, us.features, function(a, b) { return a !== b; }))
      .attr("id", "state-borders")
      .attr("d", path);
});

var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+ 
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("circle")
            .attr("d", path.projection(projection));
        g.selectAll("path")  
            .attr("d", path.projection(projection)); 

  });


function clicked(d) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 4;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("path")
      .classed("faded", true)
      .classed("active", centered && function(d) { return d === centered; });

  // g.transition()
  //     .duration(750)
  //     .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
  //     .style("stroke-width", 1.5 / k + "px");
}

function clicked2(d) {
  var x, y, k;



  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 1;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("path")
      .classed("faded", false)
      .classed("active", centered && function(d) { return d === centered; });

//   g.transition()
//       .duration(750)
// .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
//       .style("stroke-width", 1.5 / k + "px");
}

// });

d3.helper = {};

d3.helper.tooltip = function(accessor){
    return function(selection){
        var tooltipDiv;
        var bodyNode = d3.select('body').node();
        selection.on("mouseover", function(d, i){
            // Clean up lost tooltips
            d3.select('body').selectAll('div.tooltip').remove();
            // Append tooltip
            tooltipDiv = d3.select('body').append('div').attr('class', 'tooltip');
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px')
                .style('position', 'absolute') 
                .style('z-index', 1001);
            // Add text using the accessor function
            var tooltipText = accessor(d, i) || '';
            // Crop text arbitrarily
            //tooltipDiv.style('width', function(d, i){return (tooltipText.length > 80) ? '300px' : null;})
            //    .html(tooltipText);
        })
        .on('mousemove', function(d, i) {
            // Move tooltip
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px');
            var tooltipText = accessor(d, i) || '';
            tooltipDiv.html(tooltipText);
        })
        .on("mouseout", function(d, i){
            // Remove tooltip
            tooltipDiv.remove();
        });

    };
};
}

dMap();

function vMap(){
var width = 350,
    height = 350,
    centered;

var projection = d3.geo.albersUsa()
    .scale(5037)
    .translate([50, 970]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#voteMap svg")
    .attr("width", width)
    .attr("height", height);

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height);

var g = svg.append("g");

var none = "#ddd";
var q1 = "#8C1B17";
var q5 = "#3F88C5";

d3.json("shapefiles/counties.json", function(error, us) {

  g.append("g")
      .attr("id", "states")
    .selectAll("path")
      .data(us.features)
    .enter().append("path")
      .attr("d", path)
      // .on("click", clicked)
      .style("fill", function(d){
         for (var i = 0; i < 87; i++){
            if (d.properties.COUNTYNAME == dataD[i].county) { 
              if (dataD[i].win2012 == "DEM") { return q5; }
              else { return q1; }
            }
          }
        })
      .style("stroke-width", "1.5px")
      .style("stroke", "#fff")
      .call(d3.helper.tooltip(function(d, i){

         for (var i = 0; i < 87; i++){
            if (d.properties.COUNTYNAME == dataD[i].county) { 
              if (dataD[i].win2012 == "DEM") { return d.properties.COUNTYNAME + "<div class='tip' style='background-color:" + q5 + ";'>DEM WIN</div>"; }
              else { return d.properties.COUNTYNAME + "<div class='tip' style='background-color:" + q1 + ";'>GOP WIN</div>"; }
            }
          }
        }));


  g.append("path")
      //.datum(topojson.mesh(us, us.features, function(a, b) { return a !== b; }))
      .attr("id", "state-borders")
      .attr("d", path);
});

var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+ 
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("circle")
            .attr("d", path.projection(projection));
        g.selectAll("path")  
            .attr("d", path.projection(projection)); 

  });


function clicked(d) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 4;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("path")
      .classed("faded", true)
      .classed("active", centered && function(d) { return d === centered; });

  // g.transition()
  //     .duration(750)
  //     .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
  //     .style("stroke-width", 1.5 / k + "px");
}

function clicked2(d) {
  var x, y, k;



  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 1;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("path")
      .classed("faded", false)
      .classed("active", centered && function(d) { return d === centered; });

//   g.transition()
//       .duration(750)
// .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
//       .style("stroke-width", 1.5 / k + "px");
}

// });

d3.helper = {};

d3.helper.tooltip = function(accessor){
    return function(selection){
        var tooltipDiv;
        var bodyNode = d3.select('body').node();
        selection.on("mouseover", function(d, i){
            // Clean up lost tooltips
            d3.select('body').selectAll('div.tooltip').remove();
            // Append tooltip
            tooltipDiv = d3.select('body').append('div').attr('class', 'tooltip');
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px')
                .style('position', 'absolute') 
                .style('z-index', 1001);
            // Add text using the accessor function
            var tooltipText = accessor(d, i) || '';
            // Crop text arbitrarily
            //tooltipDiv.style('width', function(d, i){return (tooltipText.length > 80) ? '300px' : null;})
            //    .html(tooltipText);
        })
        .on('mousemove', function(d, i) {
            // Move tooltip
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px');
            var tooltipText = accessor(d, i) || '';
            tooltipDiv.html(tooltipText);
        })
        .on("mouseout", function(d, i){
            // Remove tooltip
            tooltipDiv.remove();
        });

    };
};
}

vMap();

  });

//VOTER TURNOUT CHARTS
function littleCharts(){
var  padding = {
        top: 20,
        right: 60,
        bottom: 20,
        left: 60,
    };

var chartPop = c3.generate({
      bindto: "#popChart",
      padding: padding,
      data: {
            columns: [
                ['Population', 1148742, 803556, 1646939],
                ['Voted DEM', 608920, 369195, 568052],
                ['Voted GOP', 326873, 342369, 650983]
            ],
        type: 'bar'
        },
        // legend: {
        //     show: false
        // },
            color: {
              pattern: ['#333','#3F88C5','#8C1B17']
            },
        axis: {
              y: {
                    min: 0,
                    padding: {bottom: 0},
                    tick: {
                     count: 4,
                     format: d3.format(',.0f')
                    }
                },
            x: {
                type: 'category',
                categories: ['Twin Cities','Suburbs','Outstate']
            }
        }
});

var chartTurnout = c3.generate({
      bindto: "#voterChart",
      padding: padding,
      data: {
            columns: [
                ['Voter Turnout', .30, .200, .100]
            ],
        type: 'bar'
        },
        legend: {
            show: false
        },
            color: {
              pattern: ['#333']
            },
        axis: {
              y: {
                    min: 0,
                    padding: {bottom: 0},
                    tick: {
                     count: 4,
                     format: d3.format('%')
                    }
                },
            x: {
                type: 'category',
                categories: ['Twin Cities','Suburbs','Outstate']
            }
        }
});

}

littleCharts();


function chartRPM(){

var  padding = {
        top: 20,
        right: 60,
        bottom: 20,
        left: 60,
    };

var chartRPM = c3.generate({
      bindto: "#chartDivideR",
      padding: padding,
        data: {
                x: 'x',
                columns: [
                    ['x',1992,1996,2000,2004,2008,2012],
                    ["Hennepin/Ramsey",0.348847173,0.391449299,0.409924249,0.385467656,0.347091676,0.337206866],
                    ["Outer suburbs",0.387444761,0.487993343,0.537880907,0.562809202,0.536414897,0.554835239],
                    ["Outstate",0.383204748,0.43012808,0.498355991,0.506918041,0.471463295,0.485655347],
                    ["Rest of 7-county",0.397632255,0.465010031,0.532615475,0.539662903,0.502553756,0.508841797],
                    ["Rochester-St. Cloud-Duluth",0.352011301,0.427104108,0.443193932,0.433338504,0.401272757,0.4376986]
                ],
            type: 'line'
            // groups: [
            //     ['Independent', 'Campaign','PAC','SuperPac']
            // ]
            },
            color: {
              pattern: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#969696', '#f0027f', '#bf5b17']
            },
            axis: {
              y: {
                    max: 1,
                    min: 0,
                    padding: {bottom: 0, top: 0},
                    tick: {
                     count: 4,
                     format: d3.format('%')
                    }
                },
                x: {
                    // type: 'category',
                    // categories: ['Trump','Clinton']
                }
            }
});
}

chartRPM();

function chartDFL(){

var  padding = {
        top: 20,
        right: 60,
        bottom: 20,
        left: 60,
    };

var chartDFL = c3.generate({
      bindto: "#chartDivideD",
      padding: padding,
        data: {
                x: 'x',
                columns: [
                    ['x',1992,1996,2000,2004,2008,2012],
                    ["Hennepin/Ramsey",0.497916492,0.536813109,0.551769266,0.594895138,0.638274257,0.648528805],
                    ["Outer suburbs",0.427991636,0.475826796,0.410544062,0.427786271,0.448790488,0.433907672],
                    ["Outstate",0.458055184,0.519749847,0.461932713,0.477853931,0.512640926,0.501670849],
                    ["Rest of 7-county",0.436415571,0.485232577,0.438084197,0.453691604,0.484688756,0.480518433],
                    ["Rochester-St. Cloud-Duluth",0.478545021,0.503638599,0.51982141,0.558140069,0.583888976,0.547758136]
                ],
            type: 'line'
            // groups: [
            //     ['Independent', 'Campaign','PAC','SuperPac']
            // ]
            },
            color: {
              pattern: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#969696', '#f0027f', '#bf5b17']
            },
            axis: {
              y: {
                    max: 1,
                    min: 0,
                    padding: {bottom: 0, top: 0},
                    tick: {
                     count: 4,
                     format: d3.format('%')
                    }
                },
                x: {
                    // type: 'category',
                    // categories: ['Trump','Clinton']
                }
            }
});
}

chartDFL();

function chartMargins(){

var  padding = {
        top: 20,
        right: 60,
        bottom: 20,
        left: 60,
    };

var chartMargins = c3.generate({
      bindto: "#chartMargins",
      padding: padding,
        data: {
                x: 'x',
                columns: [
                    ['x',1992,1996,2000,2004,2008,2012],
                    ["R4",0.00124471,0.006446814,0.029288703,0.026354319,0.009468318,0.020889653],
                    ["R3",0.007717202,0.037193156,0.116908688,0.092972182,0.055838796,0.089211108],
                    ["R2",0.067214339,0.155715348,0.21535811,0.276964373,0.22092741,0.251904645],
                    ["R1",0.223798855,0.153483759,0.160472557,0.15397755,0.158533625,0.152863111],
                    ["Tie",0.00373413,0.001735681,0.002461236,0.002440215,0.003398883,0.002949128],
                    ["D1",0.391336819,0.201834862,0.157272951,0.122254758,0.149065307,0.130007373],
                    ["D2",0.211102813,0.262087776,0.181885306,0.178379697,0.217285749,0.180142541],
                    ["D3",0.074682599,0.136374907,0.094019198,0.093460224,0.116290362,0.095109363],
                    ["D4",0.016430172,0.044631788,0.042333251,0.053196681,0.069191551,0.076923077]
                ],
            type: 'bar',
            groups: [
                ['R4','R3','R2','R1','Tie','D1','D2','D3','D4']
            ],
            order: null
            },
            color: {
              pattern: ['#8C1B17', '#A52129', '#A5484D', '#C68985', '#ddd', '#ABCEE8', '#5ca5c3', '#4f97c4', '#3f88c5']
            },
            axis: {
              y: {
                    max: 1,
                    min: 0,
                    padding: {bottom: 0, top: 0},
                    tick: {
                     count: 4,
                     format: d3.format('%')
                    }
                },
                x: {
                    // type: 'category',
                    // categories: ['Trump','Clinton']
                }
            }
});
}

chartMargins();

function chartAge(){

var  padding = {
        top: 20,
        right: 60,
        bottom: 20,
        left: 160,
    };

var chartAge = c3.generate({
      bindto: "#chartAge",
      padding: padding,
        data: {
                columns: [
                    ['Millenials', .32, .28, .27, .28, .34],
                    ['GenX', .32, .41, .32, .38, .34],
                    ['Boomers', .22, .21, .24, .21, .21],
                    ['70+', .13, .09, .16, .12, .11]
                ],
            type: 'bar',
            groups: [
                ['Millenials','GenX','Boomers','70+']
            ],
            order: null
            },
            color: {
              pattern: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#969696', '#f0027f', '#bf5b17']
            },
            axis: {
              rotated: true,
              y: {
                    max: 1,
                    min: 0,
                    padding: {bottom: 0, top: 0},
                    tick: {
                     count: 4,
                     format: d3.format('%')
                    }
                },
                x: {
                    type: 'category',
                    categories: ['Rochester/St. Cloud/Duluth','Rest of Metro','Outstate','Outer Suburbs','Hennepin/Ramsey']
                }
            }
});
}

chartAge();

function chartFinance(){

    d3.csv("./data/prez.csv", function(d) {
  return {
    candidate: d.candidate,
    total: +d.total,
    where: d.where,
    region: d.region
  };
}, function(error, rows) {

var dataT = rows;



var  padding = {
        top: 20,
        right: 60,
        bottom: 20,
        left: 60,
    };

var chartFinance = c3.generate({
      bindto: "#chartFinance",
      padding: padding,
        data: {
                x: 'x',
                columns: [
                    ['x','Trump','Republicans','Clinton','Democrats'],
                    ['Twin Cities', 0.310237969, 0.390900795, 0.652418371, 0.688673443],
                    ['Suburbs', 0.388853904, 0.367444789, 0.218434123, 0.210629544],
                    ['Central', 0.0983003, 0.056356574, 0.011287093, 0.019936908],
                    ['Duluth', 0.017010805, 0.017709514, 0.010658221, 0.018581191],
                    ['Iron Range', 0.025545207, 0.014547343, 0.009546639, 0.017199184],
                    ['Northern', 0.036501834, 0.037904558, 0.016424131, 0.021269888],
                    ['Southern', 0.12354998, 0.115136427, 0.04497635, 0.059964913]
                ],
            type: 'bar',
            // groups: [
            //     ['Twin Cities','Suburbs','Central','Duluth','Iron Range','Northern','Southern']
            // ],
            order: null
            },
            color: {
              pattern: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#969696', '#f0027f', '#bf5b17']
            },
            axis: {
              y: {
                    max: 1,
                    min: 0,
                    padding: {bottom: 0, top: 0},
                    tick: {
                     count: 4,
                     format: d3.format('%.0f')
                    }
                },
                x: {
                    type: 'category'
                    // categories: ['Trump','Clinton']
                }
            }
});
});
}

chartFinance();

</script>
</html>