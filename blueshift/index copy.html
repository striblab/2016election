<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <title>Can Trump Win the Iron Range?</title>
    <meta name="description" content="Can Trump Win the Iron Range?">
    <meta name="author" content="Frey Hargarten - StarTribune">

    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.19.1/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" /> 
    <link href="../_common_resources/charts/c3-master/c3.css" rel="stylesheet" type="text/css">
    <style>
        body { margin:0; padding:0; }
        #map { height:400px; width:100%; }
        #wrapper { width:920px; margin-left:auto; margin-right:auto; }
        .bottom { position:absolute; bottom:0; width:100%; clear:both; }
        .map-overlay-container { width:400px; }
        .map-overlay { font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif; background-color: #fff; border-radius: 3px; padding: 10px; box-shadow:0 1px 2px rgba(0,0,0,0.20); }
        .map-overlay h2, .map-overlay p { margin: 0 0 10px; }
        .mapboxgl-ctrl-attrib { display:none; }
        .play { background-color:#fff !important; color:#000; }
        .pause { background-color:#333 !important; color:#fff; }
        #diverse { color:#299129; }
     
        #toggle { margin:0; padding:0; width:80px; height:23px; font-size:2em; -moz-border-radius:0; -webkit-border-radius:0; border-radius:0; border:0; font-weight:900; margin-left:auto; margin-right:auto; display:block; }
        #toggle:hover { background-color:#333 !important; color:#fff; cursor:pointer; }
        .navButtons { display:block; text-align:center; background-color:#fff !important; width:40px; font-size:2em; -moz-border-radius:0; -webkit-border-radius:0; border-radius:0; border:0; font-weight:900; }
        .navButtons:hover { background-color:#333 !important; color:#fff; cursor:pointer; }
        .previous { float:left; }
        .next { float:right; }

        #info { height:200px; }

        #tracker { padding-top:10px; text-align:center; }
        .trackDot { border-radius:50%; width:10px; height:10px; display:inline-block; margin:6px; background-color:#ddd; }
        .trackDot:hover, .current { background-color:#333; cursor:pointer; }
        .dot { border-radius:50%; width:15px; height:15px; text-align:center; margin-right:auto; margin-left:auto; }

          #geocoder-container { width:100%; margin-top:10px; }
           #geocoder-container > div { min-width:100%; margin-left:0; }
          .chatter span { padding:5px; }

          small { font-family:"Benton Sans",Helvetica,Arial,sans-serif; color:#808080; clear:both; display:block; }

          .chatter { padding:20px; }

          p { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }

          #info { display:none; }

          #leftSide { float:left; }
          #chart { float:right; height:300px; width:48%; }

          .zoom { text-align:center; float:none !important; }
          
          .bigNum { display:inline-block; width:32%;  }

        .mapboxgl-popup { max-width:400px; font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif; }
        .marker-title { font-weight: 700; }

        #legends { width:212px; height:auto; text-align:center; margin-right:auto; margin-left:auto; }
        .topLegend { display:none; }
        .legendContainer { text-align:center; width:374px; }
        .legend label, .legend span { display:block; float:left; height:15px; width:30px; text-align:center; font-size:12px; color:#808080; font-family:"Benton Sans",Helvetica,Arial,sans-serif; }
        .legends { width:570px; height:auto; text-align:center; margin-right:auto; margin-left:auto; }
        .republican { color:#F2614C; fill:#F2614C !important; pointer-events: all; font-weight:bold; }
        .r1 { background-color:#FF8572; fill:#FF8572 !important; color:white !important; pointer-events: all; font-weight:bold; }
        .r2 { background-color:#F2634C; fill:#F2634C !important; color:white !important; pointer-events: all; font-weight:bold; }
        .r3 { background-color:#9C0004; fill:#9C0004 !important; color:white !important; pointer-events: all; font-weight:bold; }
        .r4 { background-color:#4E0002; fill:#4E0002 !important; color:white !important; pointer-events: all; font-weight:bold; }
        .r0 { background-color:#F2614C; fill:#F2614C !important; color:white !important; pointer-events: all; font-weight:bold; }
        .mid { background-color:#ddd; fill:#ddd !important; color:black !important; pointer-events: all; font-weight:bold; }
        .democrat { color:#67B4C2; fill:#67B4C2 !important; pointer-events: all; font-weight:bold; }
        .d1 { background-color:#67B4C2; fill:#67B4C2 !important; color:white !important; pointer-events: all; font-weight:bold; }
        .d2 { background-color:#4192A1; fill:#4192A1 !important; color:white !important; pointer-events: all; font-weight:bold; }
        .d3 { background-color:#0D4773; fill:#0D4773 !important; color:white !important; pointer-events: all; font-weight:bold; }
        .d4 { background-color:#022642; fill:#022642 !important; color:white !important; pointer-events: all; font-weight:bold; }
        .d0 { background-color:#67B4C2; fill:#67B4C2 !important; color:white !important; pointer-events: all; font-weight:bold; }
        .independent { fill:#E07242; background-color:#E07242; color:#333 !important; }
        small { font-family:"Benton Sans",Helvetica,Arial,sans-serif; color:#808080; clear:both; display:block; }

        .orange5  { fill:#c73d2b; background-color:#c73d2b; font-weight:900; }
        .orange4 { fill:#d76256; background-color:#d76256; font-weight:900; }
        .orange3 { fill:#e78682; background-color:#e78682; font-weight:900; }
        .orange2 { fill:#f7abad; background-color:#f7abad; font-weight:900; }

        .purple5 { fill:#cc7133; background-color:#cc7133; font-weight:900; }
        .purple4 { fill:#d58e4e; background-color:#d58e4e; font-weight:900; }
        .purple3 { fill:#ddac6a; background-color:#ddac6a; font-weight:900; }
        .purple2 { fill:#e6c985; background-color:#e6c985; font-weight:900; }

        .grayblue5 { fill:#9e5d52; background-color:#9e5d52; font-weight:900; }
        .grayblue4 { fill:#b57f73; background-color:#b57f73; font-weight:900; }
        .grayblue3 { fill:#cba093; background-color:#cba093; font-weight:900; }
        .grayblue2 { fill:#e2c2b4; background-color:#e2c2b4; font-weight:900; }


        @media (max-width:500px) {
          #wrapper { width:100%; }
          #map { position:static; height:400px; }
          .map-overlay-container { width:100%; position:static; }
          .bottom { position:static; width:100%; clear:both; }
          #leftSide { float:none; width:100%; }
          #chart { float:none; height:300px; width:100%; }
        }
    </style>
</head>
<body>

<div id="wrapper">

 <div id="map"></div>

<div class="breaker"></div>

<div id="leftSide">
<div class='map-overlay-container'>
  <div class='map-overlay'>
<div id='geocoder-container'></div>
<div class="breaker"></div>
    <div>
<div id="info">
    <h2 id='location-title'></h2>
    <p id='location-description'></p>
</div>

<button class="previous navButtons"><<</button><button class="next navButtons">>></button><button class="play myButton2" id="toggle">&#9658;</button>

<div id="tracker">
<div class="trackDot current" id="d0" index="0"></div>
<div class="trackDot" id="d1" index="1"></div>
<div class="trackDot" id="d2" index="2"></div>
<div class="trackDot" id="d3" index="3"></div>
<div class="trackDot" id="d4" index="4"></div>
<div class="trackDot" id="d5" index="5"></div>
<div class="trackDot" id="d6" index="6"></div>
<div class="trackDot" id="d7" index="7"></div>
<div class="trackDot" id="d8" index="8"></div>
<div class="trackDot" id="d9" index="9"></div>
</div>

<div id="legends0" class="topLegend">
<!-- <div class="legends" id="mnlegend">
    <div class="legendContainer">
      <div id='legendLabel'>Prevalence</div>
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>Less</span>
          <span class='gray1'></span>
          <span class='gray2'></span>
          <span class='gray3'></span>
          <span class='gray4'></span>
          <span class='gray5'></span>
          <span style='background:#fff;'>More</span>
        </nav>
      </span>
    </div>
  </div> -->
</div>

<div id="legendsC" class="topLegend">
<div class="legends" id="mnlegend">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>Less</span>
          <span class='purple2'></span>
          <span class='purple3'></span>
          <span class='purple4'></span>
          <span class='purple5'></span>
          <span style='background:#fff;'>More</span>
        </nav>
      </span>
    </div>
    <small>Rubio Lead</small>
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>Less</span>
          <span class='grayblue2'></span>
          <span class='grayblue3'></span>
          <span class='grayblue4'></span>
          <span class='grayblue5'></span>
          <span style='background:#fff;'>More</span>
        </nav>
      </span>
    </div>
    <small>Cruz Lead</small>
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>Less</span>
          <span class='orange2'></span>
          <span class='orange3'></span>
          <span class='orange4'></span>
          <span class='orange5'></span>
          <span style='background:#fff;'>More</span>
        </nav>
      </span>
    </div>
    <small>Trump Lead</small>
  </div>
</div>


<div id="legends1" class="topLegend">
<div class="legends" id="mnlegend">
    <div class="legendContainer">
      <div id='legendLabel'>Victory Percentage</div>
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>RPM</span>
          <span class='r2'></span>
          <span class='r3'></span>
          <span class='r4'></span>
<!--           <span style='background:#fff;'>DFL</span>
          <span class='d2'></span>
          <span class='d3'></span>
          <span class='d4'></span> -->
        </nav>
      </span>
    </div>
  </div>
</div>

<div id="legends2" class="topLegend">
<div class="legends" id="mnlegend">
    <div class="legendContainer">
      <div id='legendLabel'>Prevalence3</div>
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>Less</span>
          <span class='gray1'></span>
          <span class='gray2'></span>
          <span class='gray3'></span>
          <span class='gray4'></span>
          <span class='gray5'></span>
          <span style='background:#fff;'>More</span>
        </nav>
      </span>
    </div>
  </div>
</div>

<div class="breaker"></div>

<div class="zoom">Reset View</div>

</div>

</div>
</div>
</div>

<div id="chart">
  <div id="chartTitle" class="chartTitle">Chart title</div>
  <div id="chartShow"></div>
</div>

</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.19.1/mapbox-gl.js'></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="../_common_resources/charts/c3-master/c3.min.js"></script>
<script>

d3.json("http://googlescript.startribune.com/?macro=AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu&id=1dmWuUyYnLo9599ikNdLY5ZfbPkFk8pmSPUWhlpgAfUU&sheet=iron_range", function(error, dataLoad) {
d3.json('./shapefiles/mntracts.json', function(error, blocks) {
d3.json('./shapefiles/counties.json', function(error, counties) {
d3.json('./shapefiles/mnleg.json', function(error, mnleg) {
d3.json('./shapefiles/mnsenate.json', function(error, mnsenate) {
d3.json('./shapefiles/mndemotracts.json', function(error, demo) {
d3.json('./shapefiles/mnshape.json', function(error, state) {
d3.json('./shapefiles/rCaucus.json', function(error, rCaucus) {

var data = dataLoad.iron_range;

// var sw = new mapboxgl.LngLat(-93.716125, 44.643254);
// var ne = new mapboxgl.LngLat(-92.763062, 45.350215);
// var llb = new mapboxgl.LngLatBounds(sw, ne);

mapboxgl.accessToken = 'pk.eyJ1Ijoic2hhZG93ZmxhcmUiLCJhIjoiS3pwY1JTMCJ9.pTSXx_LFgR3XBpCNNxWPKA';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/shadowflare/cilea5110001ra8ktm7409xze',
    center: [-94.6859, 46.729553],
    zoom: 5,
    minZoom: 1
    // maxBounds: llb
});

var title = document.getElementById('location-title');
var description = document.getElementById('location-description');

map.scrollZoom.disable();
map.addControl(new mapboxgl.Navigation());


var timer = [];

function playback(index,stream) {
    title.textContent = data[index].title;
    // description.textContent = data[index].description;

    $("#location-description").html(data[index].description);
    $(".stat").html(data[index].stat);
    $("#chartTitle").html(data[index].chart);
    $(".topLegend").hide();
    $("#legends" + data[index].legend).show();

    // highlightBorough(data[index].id ? data[index].id : '');

    $(".trackDot").removeClass("current");
    $("#d" + index).addClass("current");

    if (index == 0){
    map.setLayoutProperty('state-layer', 'visibility', 'visible');
    map.setLayoutProperty('blocks-layer-voting', 'visibility', 'none');
    map.setLayoutProperty('county-layer-0', 'visibility', 'none');
    map.setLayoutProperty('county-layer-1', 'visibility', 'none');
    map.setLayoutProperty('county-layer-2', 'visibility', 'none');
    map.setLayoutProperty('county-layer-3', 'visibility', 'none');
    map.setLayoutProperty('county-layer-4', 'visibility', 'none');
    chart.unload();
    switchChart("state","bar");
    }
    if (index == 1){
    // map.setLayoutProperty('blocks-layer-voting', 'visibility', 'visible');
    // map.setLayoutProperty('blocks-layer-race', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-income', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-leg', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-caucus', 'visibility', 'none');
    chart.unload();
    switchChart("caucus","bar");
    }
    if (index == 2){
    // map.setLayoutProperty('blocks-layer-voting', 'visibility', 'visible');
    // map.setLayoutProperty('blocks-layer-race', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-income', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-leg', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-caucus', 'visibility', 'none');
    }
    else if (index == 3){
    // map.setLayoutProperty('blocks-layer-voting', 'visibility', 'visible');
    // map.setLayoutProperty('blocks-layer-race', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-income', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-leg', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-caucus', 'visibility', 'none');
    }
    else if (index == 4){
    // map.setLayoutProperty('blocks-layer-voting', 'visibility', 'visible');
    // map.setLayoutProperty('blocks-layer-race', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-income', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-leg', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-caucus', 'visibility', 'none');
    }
    else if (index == 5){
    // map.setLayoutProperty('blocks-layer-voting', 'visibility', 'visible');
    // map.setLayoutProperty('blocks-layer-race', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-income', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-leg', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-caucus', 'visibility', 'none');
    }
    else if (index == 6){
    // map.setLayoutProperty('blocks-layer-voting', 'visibility', 'visible');
    // map.setLayoutProperty('blocks-layer-race', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-income', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-leg', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-caucus', 'visibility', 'none');
    }
    else if (index == 7){
    // map.setLayoutProperty('blocks-layer-voting', 'visibility', 'visible');
    // map.setLayoutProperty('blocks-layer-race', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-income', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-leg', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-caucus', 'visibility', 'none');
    }
    else if (index == 8){
    // map.setLayoutProperty('blocks-layer-voting', 'visibility', 'visible');
    // map.setLayoutProperty('blocks-layer-race', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-income', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-leg', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-caucus', 'visibility', 'none');
    }
    else if (index == 9){
    // map.setLayoutProperty('blocks-layer-voting', 'visibility', 'visible');
    // map.setLayoutProperty('blocks-layer-race', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-income', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-leg', 'visibility', 'none');
    // map.setLayoutProperty('blocks-layer-caucus', 'visibility', 'none');
    }

    map.flyTo({center:[data[index].longitude,data[index].latitude],zoom:data[index].zoom});

    // Animate the map position based on camera properties
   if ($(window).width() > 500) { map.flyTo({center:[data[index].longitude,data[index].latitude],zoom:data[index].zoom,bearing:data[index].bearing,pitch:data[index].pitch}); }

    // map.once('moveend', function() {

    // });
}

function play(j,timeout){
 timer[j] = window.setTimeout(function() { playback(j); }, timeout); 
}

function stop(){
  for (var i=0; i<data.length; i++){
     clearTimeout(timer[i]);
  }
}

// Display the last title/description first
title.textContent = data[data.length - 1].title;
description.textContent = data[data.length - 1].description;


map.on('load', function() {
//CENSUS TRACTS
  var shapeObj2 = new mapboxgl.GeoJSONSource({
   data: blocks
});

  map.addSource('mnblocks', shapeObj2);

  var layers = [
['#0D4673', 0],
['#67B4C2', .20],
['#D1E6E1', .40],
['#F7F7F7', .50],
['#F2AC93', .60],
['#F2614C', .70],
['#9C0004', .90]
];

function votingCrunch(){
  var layerFull = [];

  for (var i=0; i < blocks.features.length; i++){
    var id = blocks.features[i].properties.VTD;
    
    var gop08 = blocks.features[i].properties.USPRESR08 / (blocks.features[i].properties.USPRESDFL1 + blocks.features[i].properties.USPRESR08);
    // var whites = blocks.features[i].properties.NH18_WHT / blocks.features[i].properties.POPULATION;
    layerFull[i] = [id, gop08];
  }


  return layerFull;
}

//http://www2.census.gov/geo/docs/maps-data/data/tiger/prejoined/ACSMetadata2011.txt
//POPULATION: B02001e1
//WHITE ALONE: B02001e2
//POVERTY STATUS: B17017e1
//MEDIAN INCOME: B19013e1
//Associates Male: B15002e14
//Bachelor's Male: B15002e15
//Master's Male: B15002e16
//Professional Male: B15002e17
//Doctorate Male: B15002e18
//Associate's Female: B15002e31
//Bachelor's Female: B15002e32
//Master's Female: B15002e33
//Professional Female: B15002e34
//Doctorate's Female: B15002e35
//MEDIAN GROSS RENT: B25064e1

function demoCrunch(){
  var layerFull = [];

  for (var i=0; i < demo.features.length; i++){
    var id = demo.features[i].properties.GEOID;
    console.log(id);

    var gop08 = blocks.features[i].properties.USPRESR08 / (blocks.features[i].properties.USPRESDFL1 + blocks.features[i].properties.USPRESR08);
    var whites = blocks.features[i].properties.NH18_WHT / blocks.features[i].properties.POPULATION;
    layerFull[i] = [id, gop08, whites];
  }


  return layerFull;
}

console.log(demo);

// votingCrunch();
// demoCrunch();

// layers.forEach(function(layer, i) {
   map.addLayer({
        'id': 'blocks-layer-voting',
        'interactive': true,
        'source': 'mnblocks',
        'type': 'fill',
        // "filter": [
        // ">=",
        // "USPRESR08",
        // layer[1]
        // ],
        'paint': {
            'fill-antialias' : true,
            'fill-opacity': 0.5,
            'fill-color': {
              property: 'USPRESR08',
              stops: [
                  [0,'#0D4673'],
                  [20,'#67B4C2'],
                  [40,'#D1E6E1'],
                  [50, '#F7F7F7'],
                  [60, '#F2AC93'],
                  [70, '#F2614C'],
                  [80, '#9C0004']
              ]
              },
            'fill-outline-color': 'rgba(51, 51, 51, 1)'
        }
    });
   // });

   // map.addLayer({
   //      'id': 'blocks-layer-race',
   //      'interactive': true,
   //      'source': 'mnblocks',
   //      'type': 'fill',
   //      // "filter": [
   //      // ">=",
   //      // "NH_WHT",
   //      // layer[1]
   //      // ],
   //      'paint': {
   //          'fill-antialias' : true,
   //          'fill-opacity': 0.5,
   //          'fill-color': {
   //            property: 'NH_WHT',
   //            stops: [
   //                [0,'#F7F7F7'],
   //                [20,'#CCC'],
   //                [40,'#969696'],
   //                [50, '#636363'],
   //                [60, '#252525']
   //            ]
   //            },
   //          'fill-outline-color': 'rgba(51, 51, 51, 1)'
   //      }
   //  });

   // map.addLayer({
   //      'id': 'blocks-layer-income',
   //      'interactive': true,
   //      'source': 'mnblocks',
   //      'type': 'fill',
   //      // "filter": [
   //      // ">=",
   //      // "USPRESR08",
   //      // layer[1]
   //      // ],
   //      'paint': {
   //          'fill-antialias' : true,
   //          'fill-opacity': 0.5,
   //          'fill-color': {
   //            property: 'USPRESR08',
   //            stops: [
   //                [0,'#F7F7F7'],
   //                [20,'#CCC'],
   //                [40,'#969696'],
   //                [50, '#636363'],
   //                [60, '#252525']
   //            ]
   //            },
   //          'fill-outline-color': 'rgba(51, 51, 51, 1)'
   //      }
   //  });

   // map.addLayer({
   //      'id': 'blocks-layer-leg',
   //      'interactive': true,
   //      'source': 'mnblocks',
   //      'type': 'fill',
   //      // "filter": [
   //      // ">=",
   //      // "MNLEGR10",
   //      // layer[1]
   //      // ],
   //      'paint': {
   //          'fill-antialias' : true,
   //          'fill-opacity': 0.5,
   //          'fill-color': {
   //            property: 'USPRESR08',
   //            stops: [
   //                [0,'#F7F7F7'],
   //                [20,'#CCC'],
   //                [40,'#969696'],
   //                [50, '#636363'],
   //                [60, '#252525']
   //            ]
   //            },
   //          'fill-outline-color': 'rgba(51, 51, 51, 1)'
   //      }
   //  });

   // map.addLayer({
   //      'id': 'blocks-layer-caucus',
   //      'interactive': true,
   //      'source': 'mnblocks',
   //      'type': 'fill',
   //      // "filter": [
   //      // ">=",
   //      // "MNLEGR10",
   //      // layer[1]
   //      // ],
   //      'paint': {
   //          'fill-antialias' : true,
   //          'fill-opacity': 0.5,
   //          'fill-color': {
   //            property: 'USPRESR08',
   //            stops: [
   //                [0,'#F7F7F7'],
   //                [20,'#CCC'],
   //                [40,'#969696'],
   //                [50, '#636363'],
   //                [60, '#252525']
   //            ]
   //            },
   //          'fill-outline-color': 'rgba(51, 51, 51, 1)'
   //      }
   //  });

//COUNTIES
  var shapeObj2 = new mapboxgl.GeoJSONSource({
   data: counties
});

  map.addSource('counties', shapeObj2);

  var layers = [
['Koochiching', 0],
['Itasca', 10],
['St. Louis', 30],
['Lake', 50],
['Cook', 70]
];

layers.forEach(function(layer, i) {
   map.addLayer({
        'id': 'county-layer-' + i,
        'interactive': true,
        'source': 'counties',
        'type': 'fill',
        "filter": [
        "==",
        "COUNTYNAME",
        layer[0]
        ],
        'paint': {
            'fill-antialias' : true,
            'fill-opacity': .1,
            'fill-color': '#ddd',
            'fill-outline-color': 'rgba(51, 51, 51, 1)'
        }
    });
   });

//STATE
  var shapeObj3 = new mapboxgl.GeoJSONSource({
   data: state
});

  map.addSource('state', shapeObj3);

   map.addLayer({
        'id': 'state-layer',
        'interactive': true,
        'source': 'state',
        'type': 'fill',
        // "filter": [
        // "==",
        // "COUNTYNAME",
        // layer[0]
        // ],
        'paint': {
            'fill-antialias' : true,
            'fill-opacity': 0.7,
            'fill-color': '#333',
            'fill-outline-color': 'rgba(51, 51, 51, 0.7)'
        }
    });

var popup = new mapboxgl.Popup({
    closeButton: false,
    closeOnClick: false
});

map.on('mousemove', function(e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['county-layer-0','county-layer-1','county-layer-2','county-layer-3','county-layer-4'] });
    // Change the cursor style as a UI indicator.
    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
        popup.remove();
        return;
    }

    var feature = features[0];

    // Populate the popup and set its coordinates
    // based on the feature found.
    popup.setLngLat(e.lngLat)
        .setHTML(feature.properties.COUNTYNAME + " County")
        .addTo(map);
});

playback(0);

  $("#info").show();

var index = 0;
$(document).ready(function() {
        $('#toggle').bind("click", function() {
          if ($(this).attr("class") == "play myButton2") {
             $(this).attr("class", "pause myButton2");
             $(this).html("&#9724;");
             for (var j=0; j<data.length; j++){ play(j,j*5000); if (index < data.length) { index++; } }
         }
          else {
             $(this).attr("class", "play myButton2");
             $(this).html("&#9658;");
             stop();
           }
        });
      });

$(".previous").click(function() {
  if (index > 0) {
  index--;
  stop();
  playback(index);
}
  });

$(".next").click(function() {
  if (index < data.length-1) {
  stop();
  index++;
  playback(index);
}
  });

$(".trackDot").click(function() {
  $("#toggle").attr("class", "play myButton2");
  $("#toggle").html("&#9658;");
  $(".trackDot").removeClass("current");
  $(this).addClass("current");
  stop();
  index = Number($(this).attr("index"));
  playback(Number($(this).attr("index")));
});

    if ($(window).width() <= 500) { map.flyTo({ center: [-94.6859, 46.729553], zoom: 5 }); }
    else { map.flyTo({ center: [-94.6859, 46.729553], zoom: 5 }); }
    $(window).resize(function() {
    if ($(window).width() <= 500) { map.flyTo({ center: [-94.6859, 46.729553], zoom: 5 }); }
    else { map.flyTo({ center: [-94.6859, 46.729553], zoom: 5 }); }
    });

$(".zoom").click(function() {
map.flyTo({ center: [-94.6859, 46.729553], zoom: 5 });
});

});

//MINNESOTA RESULTS: http://www.270towin.com/historical-presidential-elections/
var chart;

function switchChart(name,type){

var axis = [];
var dataStream = [];
axis[0] = 'x';
var indexYear = 1;

axis[0] = "x";
dataStream[0] = name;

for (var j=1930; j<2016; j++){
  axis[indexYear] = j;
  dataStream[indexYear] = 0;
  indexYear++;
}

// $("#chartTitle").html(name);

// console.log(dataStream);

if (name="state"){

var  padding = {
        top: 20,
        right: 60,
        bottom: 20,
        left: 50,
    };

var share = "#B0BEC5";

// console.log(axis);

chart = c3.generate({
        bindto: '#chartShow',
        padding: padding,
    data: {
        // x: 'x',
        columns: [
            // axis,
            ['AL',9.00],
            ['AK',3.00],
            ['AZ',11.0],
            ['AR',6.00],
            ['CA',55.0],
            ['CO',9.00],
            ['CT',7.00],
            ['DC',3.00],
            ['DE',3.00],
            ['FL',29.0],
            ['GA',16.0],
            ['HI',4.00],
            ['ID',4.00],
            ['IL',20.0],
            ['IN',11.0],
            ['IA',6.00],
            ['KS',6.00],
            ['KY',8.00],
            ['LA',8.00],
            ['ME',4.00],
            ['MD',10.0],
            ['MA',11.0],
            ['MI',16.0],
            ['MN',10.0],
            ['MS',6.00],
            ['MO',10.0],
            ['MT',3.00],
            ['NE',5.00],
            ['NV',6.00],
            ['NH',4.00],
            ['NJ',14.0],
            ['NM',5.00],
            ['NY',29.0],
            ['NC',15.0],
            ['ND',3.00],
            ['OH',18.0],
            ['OK',7.00],
            ['OR',7.00],
            ['PA',20.0],
            ['RI',4.00],
            ['SC',9.00],
            ['SD',3.00],
            ['TN',11.0],
            ['TX',38.0],
            ['UT',6.00],
            ['VT',3.00],
            ['VA',13.0],
            ['WA',12.0],
            ['WV',5.00],
            ['WI',10.0],
            ['WY',3.0]
        ],
        type: 'bar',
        colors: { 'MN':'#f00' },
        groups: [
            ['AL','AK','AZ','AR','CA','CO','CT','DC','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY']
        ]
    },
    color:  { pattern: ["#000"] },
    tooltip: {
        show: false
    },
    axis: {
      y: {
            min: 0,
            padding: {bottom: 0},
            tick: {
             count: 4,
             format: d3.format(',.0f')
            }
        },
        x: {
            tick: {
                // values: ['1930', '1950', '1990', '2015'],
                count: 0,
                multiline: false
            }
          }
        }
    //   tooltip: {
    //   contents: function (d, defaultTitleFormat, defaultValueFormat, color) {
    //       var $$ = this, config = $$.config,
    //           titleFormat = config.tooltip_format_title || defaultTitleFormat,
    //           nameFormat = config.tooltip_format_name || function (name) { return name; },
    //           valueFormat = config.tooltip_format_value || defaultValueFormat,
    //           text, i, title, value, name, bgcolor;
    //       for (i = 0; i < d.length; i++) {
    //           if (! (d[i] && (d[i].value || d[i].value === 0))) { continue; }

    //           if (! text) {
    //               title = titleFormat ? titleFormat(d[i].x) : d[i].x;
    //               text = "<table class='" + $$.CLASS.tooltip + "'>" + (title || title === 0 ? "<tr><th colspan='2'>" + title + "</th></tr>" : "");
    //           }

    //           var birthNum = 0;



    //           name = nameFormat(d[i].name);
    //           value = valueFormat(d[i].value, d[i].ratio, d[i].id, d[i].index);
    //           bgcolor = $$.levelColor ? $$.levelColor(d[i].value) : color(d[i].id);

    //           console.log(title);

    //           for (var k=0; k < rows.length; k++){
    //             if (rows[k].name == name && rows[k].year == Number(title)){
    //               birthNum = rows[k].births;
    //               break;
    //             }
    //           }

    //           text += "<tr class='" + $$.CLASS.tooltipName + "-" + d[i].id + "'>";
    //           text += "<td class='name'><span style='background-color:" + bgcolor + "'></span>Rate</td>";
    //           text += "<td class='value'>" + value + "</td>";
    //           text += "</tr><tr>";
    //           text += "<td class='name'><span style='background-color:" + bgcolor + "'></span>Total Births</td>";
    //           text += "<td class='value'>" + birthNum + "</td>";
    //           text += "</tr>";
              
    //       }
    //       return text + "</table>";
    //   }
    // }

  });

} else if (name == "caucus"){

var  padding = {
        top: 20,
        right: 60,
        bottom: 20,
        left: 50,
    };

var share = "#B0BEC5";

// console.log(axis);

chart = c3.generate({
        bindto: '#chartShow',
        padding: padding,
    data: {
        // x: 'x',
        columns: [
            ['Rubio','Cruz','Trump','Kasich','Carson'],
            [.36,.29,.21,.06,.07]
        ],
        type: 'bar'
    },
    color:  { pattern: ["#E07242","#b57f73","#9C0004","#DF95AF","#D97171"] },
    tooltip: {
        show: false
    },
    axis: {
      y: {
            min: 0,
            padding: {bottom: 0},
            tick: {
             count: 4,
             format: d3.format('%')
            }
        },
        x: {
            tick: {
                // values: ['1930', '1950', '1990', '2015'],
                count: 5,
                multiline: false
            }
          }
        }
    //   tooltip: {
    //   contents: function (d, defaultTitleFormat, defaultValueFormat, color) {
    //       var $$ = this, config = $$.config,
    //           titleFormat = config.tooltip_format_title || defaultTitleFormat,
    //           nameFormat = config.tooltip_format_name || function (name) { return name; },
    //           valueFormat = config.tooltip_format_value || defaultValueFormat,
    //           text, i, title, value, name, bgcolor;
    //       for (i = 0; i < d.length; i++) {
    //           if (! (d[i] && (d[i].value || d[i].value === 0))) { continue; }

    //           if (! text) {
    //               title = titleFormat ? titleFormat(d[i].x) : d[i].x;
    //               text = "<table class='" + $$.CLASS.tooltip + "'>" + (title || title === 0 ? "<tr><th colspan='2'>" + title + "</th></tr>" : "");
    //           }

    //           var birthNum = 0;



    //           name = nameFormat(d[i].name);
    //           value = valueFormat(d[i].value, d[i].ratio, d[i].id, d[i].index);
    //           bgcolor = $$.levelColor ? $$.levelColor(d[i].value) : color(d[i].id);

    //           console.log(title);

    //           for (var k=0; k < rows.length; k++){
    //             if (rows[k].name == name && rows[k].year == Number(title)){
    //               birthNum = rows[k].births;
    //               break;
    //             }
    //           }

    //           text += "<tr class='" + $$.CLASS.tooltipName + "-" + d[i].id + "'>";
    //           text += "<td class='name'><span style='background-color:" + bgcolor + "'></span>Rate</td>";
    //           text += "<td class='value'>" + value + "</td>";
    //           text += "</tr><tr>";
    //           text += "<td class='name'><span style='background-color:" + bgcolor + "'></span>Total Births</td>";
    //           text += "<td class='value'>" + birthNum + "</td>";
    //           text += "</tr>";
              
    //       }
    //       return text + "</table>";
    //   }
    // }

  });

}

}

switchChart("state","bar");

});
});
});
});
});
});
});
});
</script>

</body>
</html>