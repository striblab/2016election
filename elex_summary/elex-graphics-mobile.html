<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Star Tribune election results</title>
  <meta name="generator" content="BBEdit 10.5" />
  
  
<style type="text/css">

body {font-family:sans-serif;}  
  


#demBarPres {width:45.5%;}
#repBarPres {width:35.2%;}
#presReport {}  
  
#dem-US-house {width:22%;}
#rep-US-house {width:42%;}
#US-house-report {}  
  
#dem-US-senate {width:42%;}
#rep-US-senate {width:32%;}
#US-senate-report {}  
  
#dem-MN-senate {width:22%;}
#rep-MN-senate {width:42%;}
#MN-senate-report {} 
  
#dem-MN-house {width:42%;}
#rep-MN-house {width:32%;}
#MN-house-report {} 
    
#local-race {}  
#local-race-dem {}
#local-race-rep {}
  
#local-prop {}  
#local-race-pro {}
#local-race-con {}

  
  .resultsBar {width:320px; background-color:white;} 

  #snapshot { height:480px; }
  
  .resultsLogo {
    float:left;
    display:block;
    width:100%;
    height:45px;
/*    font-family:'Benton Sans',Helvetica,Arial,sans-serif,san-serif !important;*/
    letter-spacing:.25px;
    font-size:12px;
    margin-bottom:8px;
  }
  .logoLeft {float:left;margin:18px 5px 0 0;font-weight:bold;}
  .logoRight {float:right;margin-top:18px;}
  
  .resultsLogoSVG {float:left;width:45px;height:45px;}

  .resultsPres {float:left;width:100%;margin-bottom:24px;background-color:#fff;}
  
  .resultsCong {float:left;width:100%;min-height:60px;padding:0 0px;background-color:white;}
  .resultsCongBreaks {float:left;width:46%;height:auto;margin:0 0 24px 0;padding-right:8%;background-color:white;}
  .resultsCongRight {padding-right:0;}
  
  .resultsLocal {float:left;width:46%;padding:0;margin-top:5px;}
  .localLeft {padding-right:8%;}
  
  
  .balanceBar {position:relative;display:block;float:left;width:100%;height:10px;background-color:#ccc;margin-bottom:5px;}
  .demBar {float:left;height:10px;background-color:#21409A;z-index:8;}
  .repBar {float:right;height:10px;background-color:#DA2128;z-index:8;}
  
  
  .numBig {
    font-weight:bold;
    font-size:28px;
    margin-bottom:0em;
  }
  
  .numMed {
    font-weight:bold;
    font-size:18px;
    margin-bottom:2px;
  }
  
  .numLeft {float:left;}
  .numRight {float:right;text-align:right;}
  
  .demBlue {color:#21409A;}
  .repRed {color:#DA2128;}

  .hashMark {width:1px;height:13px;background:#000;position:absolute;top:-3px;left:50%;}
  
  .label {
    font-weight:bold;
    font-size:10px;
    line-height:10px;
    height:12px;
    margin-bottom:6px;
  }
  
  .labelPres {text-align:center;margin-bottom:0;}
  
  .labelSm {
    font-weight:bold;
    font-size:9px;
    line-height:9px;
    height:12px;
  }

  .labelClinton {float:left;width:31%;}
  .labelTrump {float:right;width:25%;text-align:right;}
  .labelD {float:left;width:15%;}
  .labelR {float:right;text-align:right;width:15%;}
  
  .reporting {
    display:block;
    font-size:9px;
    line-height:9px;
    height:12px; 
    color:#757575;
    text-align:center;
  }

  .presReport {float:right;min-width:44%;}
  .congReport {float:right;min-width:70%;}
  .localReport {float:left;text-align:left;width:100%;}

  
  .toWin {
    position:absolute;
    display:block;
    font-size:9px;
    line-height:9px;
    height:12px; 
    color:#000;
    text-align:center;
  }

  .toWinPres {width:auto;left:150px;top:-24px;;}
  .toWinUSsen {width:auto;left:57px;top:-24px;}
  .toWinUShouse {width:auto;left:66px;top:-15px;}
  .toWinMNsen {width:auto;left:68px;top:-15px;}
  .toWinMNhouse {width:auto;left:68px;top:-15px;}

  .localItemOne {
    font-weight:bold;
    font-size:10px;
    line-height:11px;
    float:left;
    width:100%;
    padding-bottom:4px;
    border-bottom: 1px solid #ccc;
  }
  .localItemTwo {
    font-weight:bold;
    font-size:10px;
    line-height:11px;
    float:left;
    width:100%;
    padding:4px 0 8px 0;}
  
   .localCheck {float:left;width:12%;}
   .localName {float:left;width:70%;font-weight:normal;}
   .localResult {float:left;width:18%;text-align:right;}

   #done { display:none; }


@media only screen and (min-device-width: 320px) and (max-device-width: 640px) {

body {
  font-size: 100%;
    }
    
}

</style>  
</head>
<body>
  
            
<!--MAIN CONTAINER--> 
<div id="snapshot">
<div class="resultsBar" id="snapme">
  <div id="done">NOT</div> 
  
<!--PRESIDENT-->
<div class="resultsPres">   
<div class="label labelPres">President</div>

    <div class="numBig demBlue numLeft"><span id="demPres">0</span></div>
    <div class="numBig repRed numRight"><span id="repPres">0</span></div> 

    <div class="balanceBar">
        <div class="hashMark"></div>
        <div class="demBar" id="demBarPres"></div>   
        <div class="repBar" id="repBarPres"></div>
        <div class="toWin toWinPres">270<br />to win</div>
    </div>

    <div class="labelSm labelClinton">CLINTON</div>
    <div class="labelSm labelTrump">TRUMP</div>  
    <div class="reporting presReport"><!-- <span id="presReport">0% reporting</span> --></div>
</div> 
  
<!--US SENATE-->
<div class="resultsCongBreaks">
    <div class="label">U.S. Senate</div>

    <div class="numMed demBlue numLeft"><span id="dem-US-senate">0</span></div>
    <div class="numMed repRed numRight"><span id="rep-US-senate">0</span></div>  

    <div class="balanceBar">
        <div class="hashMark"></div>
        <div class="demBar" id="dem-US-senateBar"></div>   
        <div class="repBar" id="rep-US-senateBar"></div>
        <div class="toWin toWinUSsen">51<br />majority</div>
    </div>    

    <div class="labelSm labelD">D</div>
    <div class="labelSm labelR">R</div> 
    <div class="reporting congReport"><!-- <span id="US-senate-report">0% reporting</span> --></div>
</div>

<!--US HOUSE  -->
<div class="resultsCongBreaks resultsCongRight">
    <div class="label">U.S. House</div>

    <div class="numMed demBlue numLeft"><span id="dem-US-house">0</span></div>
    <div class="numMed repRed numRight"><span id="rep-US-house">0</span></div>  

    <div class="balanceBar">
        <div class="hashMark"></div>
        <div class="demBar" id="dem-US-houseBar"></div>   
        <div class="repBar" id="rep-US-houseBar"></div>
        <div class="toWin toWinUShouse">218</div>
    </div>    

    <div class="labelSm labelD">D</div>
    <div class="labelSm labelR">R</div>
    <div class="reporting congReport"><!-- <span id="US-house-report">0% reporting</span> --></div>
</div>
  
<!--MN SENATE-->
<div class="resultsCongBreaks">
    <div class="label">MN Senate</div>
  
    <div class="numMed demBlue numLeft"><span id="dem-MN-senate">0</span></div>
    <div class="numMed repRed numRight"><span id="rep-MN-senate">0</span></div>  

    <div class="balanceBar">
        <div class="hashMark"></div>
        <div class="demBar" id="dem-MN-senateBar"></div>   
        <div class="repBar" id="rep-MN-senateBar"></div>
        <div class="toWin toWinMNsen">34</div>
    </div>    

    <div class="labelSm labelD">D</div>
    <div class="labelSm labelR">R</div>
    <div class="reporting congReport"><!-- <span id="MN-senate-report">0% reporting</span> --></div>
</div>
  
 
<!--MN HOUSE-->
<div class="resultsCongBreaks resultsCongRight">
    <div class="label">MN House</div>

    <div class="numMed demBlue numLeft"><span id="dem-MN-house">0</span></div>
    <div class="numMed repRed numRight"><span id="rep-MN-house">0</span></div>  

    <div class="balanceBar">
        <div class="hashMark"></div>
        <div class="demBar" id="dem-MN-houseBar"></div>   
        <div class="repBar" id="rep-MN-houseBar"></div>
        <div class="toWin toWinMNhouse">68</div>
    </div>    

    <div class="labelSm labelD">D</div>
    <div class="labelSm labelR">R</div> 
    <div class="reporting congReport"><!-- <span id="MN-house-report">0% reporting</span> --></div>
</div>

         
<!--LOCAL HIGHLIGHT-->
<div class="resultsLocal localLeft">
    <div class="label"><span id="local-race">U.S. House, MN2</span></div>

    <div class="localItemOne">
      <div class="localCheck"><span id="local-race-demWin">&nbsp;</span></div>
      <div class="localName"><span id="local-race-demName">Craig (D)</span></div>
      <div class="localResult"><span id="local-race-dem">0%</span></div>
    </div>

    <div class="localItemTwo">
      <div class="localCheck"><span id="local-race-repWin">&nbsp;</span></div>
      <div class="localName"><span id="local-race-repName">Lewis (R)</span></div>
      <div class="localResult"><span id="local-race-rep">0%</span></div>
    </div>
  
    <div class="reporting localReport" id="racePct">0% reporting</div>
</div>
  
<div class="resultsLocal">
    <div class="label"><span id="local-race-prop">U.S. House, MN3</span></div>

    <div class="localItemOne">
      <div class="localCheck"><span id="local-race-proWin">&nbsp;</span></div>
      <div class="localName"><span id="local-race-proDemName">Bonoff (D)</span></div>
      <div class="localResult"><span id="local-race-pro">0%</span></div>
    </div>

    <div class="localItemTwo">
      <div class="localCheck"><span id="local-race-conWin">&nbsp;</span></div>
      <div class="localName"><span id="local-race-conRepName">Paulsen* (R)</span></div>
      <div class="localResult"><span id="local-race-con">0%</span></div>
    </div>
  
<div class="reporting localReport" id="votePct">0% reporting</div>
</div>

<!-- close results bar main container-->
</div> 
</div>

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>
// var apiStringUS = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=P&raceTypeID=G";
// var apiStringCounty = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=P&raceTypeID=G&level=RU";

// var apiStringSenate = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=S&raceTypeID=G&level=RU";
// var apiStringGov = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=G&raceTypeID=G&level=RU";

// var apiStringHouse = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&officeID=H&raceTypeID=G&level=RU";
// var apiStringMNH = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&statePostal=MN&officeID=Y&raceTypeID=G";
// var apiStringMNS = "https://api.ap.org/v2/elections/2012-11-06?apiKey=7Uj4Dz9P8Na2GGpsOztXI57PRpx9h400&format=json&statePostal=MN&officeID=Z&raceTypeID=G";

// var apiStringCounty = "data/prezCounty.json";

// var apiStringSenate = "data/senate.json";
// var apiStringGov = "data/gov.json";

// var apiStringHouse = "data/house.json";
// var apiStringMNH = "data/mnhouse.json";
// var apiStringMNS = "data/mnsenate.json";

var apiStringCounty = "https://s3-us-west-2.amazonaws.com/strib-elections-ap-api/us-uspresident-by-county/full.json";
var apiStringSenate = "https://s3-us-west-2.amazonaws.com/strib-elections-ap-api/us-ussenate-by-state/full.json";
var apiStringHouse = "https://s3-us-west-2.amazonaws.com/strib-elections-ap-api/us-ushouse-by-state/full.json";
var apiStringMNH = "https://s3-us-west-2.amazonaws.com/strib-elections-ap-api/mn-mnhouse-by-district/full.json";
var apiStringMNS = "https://s3-us-west-2.amazonaws.com/strib-elections-ap-api/mn-mnsenate-by-district/full.json";
var apiStringEVCD = "https://s3-us-west-2.amazonaws.com/strib-elections-ap-api/us-uspresident-nebraska-maine/full.json";

// var apiString = "./data/" + year + "_" + race + "_" + district + "_" + geo +".json"

// d3.json(apiStringUS, function(error, jsonUS) {
d3.json(apiStringCounty + '?' + (Math.floor(Math.random() * 1000)), function(error, jsonCounty) {
d3.json(apiStringSenate + '?' + (Math.floor(Math.random() * 1000)), function(error, jsonSenate) {
d3.json(apiStringHouse + '?' + (Math.floor(Math.random() * 1000)), function(error, jsonHouse) {
d3.json(apiStringMNH + '?' + (Math.floor(Math.random() * 1000)), function(error, jsonMNH) {
d3.json(apiStringMNS + '?' + (Math.floor(Math.random() * 1000)), function(error, jsonMNS) {
d3.json(apiStringEVCD + '?' + (Math.floor(Math.random() * 1000)), function(error7, jsonSpillEVCD) {

// var dataUS = jsonUS;
var dataCounty = jsonCounty;
var dataSenate = jsonSenate;
var dataHouse = jsonHouse;
var dataMNH = jsonMNH;
var dataMNS = jsonMNS;
var dataEVCD = jsonSpillEVCD;

//data fetching function
function fetchData(district,state,type,dataCompare,race,ev,label,evcd){

//initialize top level variables 
var stateName = '';
var statePostal = '';
var precinctsReporting = 0;
var precinctsTotal = 0;
var precinctsReportingPct = 0;
var lastUpdated = 0;

var fipsCode = '';
var seatName = '';
var seatNum = '';

var voteCountT = 0;

//initialize candidate arrays
var first = [];
var last = [];
var party = [];
var incumbent = [];
var voteCount = [];
var winner = [];

//initialize sorting array
var sortAll = [];

//run through data and assign variables to candidate arrays
  for (var i=0; i < dataCompare.races.length; i++) {
   if (race == "ushouse" || race == "mnhouse" || race == "mnsenate"){
    if (district == "District 0"){
      if (dataCompare.races[i].seatName == "District 1") {
     for (var j=0; j < dataCompare.races[i].reportingUnits.length; j++) {
         if (dataCompare.races[i].reportingUnits[j].stateName == state){
              stateName = dataCompare.races[i].reportingUnits[j].stateName;
              statePostal = dataCompare.races[i].reportingUnits[j].statePostal;
              precinctsReporting = dataCompare.races[i].reportingUnits[j].precinctsReporting;
              precinctsTotal = dataCompare.races[i].reportingUnits[j].precinctsTotal;
              precinctsReportingPct = dataCompare.races[i].reportingUnits[j].precinctsReportingPct;
              lastUpdated = dataCompare.races[i].reportingUnits[j].lastUpdated;

           for (var k=0; k < dataCompare.races[i].reportingUnits[j].candidates.length; k++) {
              first[k] = dataCompare.races[i].reportingUnits[j].candidates[k].first;
              last[k] = dataCompare.races[i].reportingUnits[j].candidates[k].last;
              party[k] = dataCompare.races[i].reportingUnits[j].candidates[k].party;
              incumbent[k] = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
              voteCount[k] = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
              winner[k] = dataCompare.races[i].reportingUnits[j].candidates[k].winner; 
           } //end k loop
         } //end if
     } //end j loop
    } //end if
}
     else {
        if (dataCompare.races[i].seatName == district) {
     for (var j=0; j < dataCompare.races[i].reportingUnits.length; j++) {
         if (dataCompare.races[i].reportingUnits[j].stateName == state){
              stateName = dataCompare.races[i].reportingUnits[j].stateName;
              statePostal = dataCompare.races[i].reportingUnits[j].statePostal;
              precinctsReporting = dataCompare.races[i].reportingUnits[j].precinctsReporting;
              precinctsTotal = dataCompare.races[i].reportingUnits[j].precinctsTotal;
              precinctsReportingPct = dataCompare.races[i].reportingUnits[j].precinctsReportingPct;
              lastUpdated = dataCompare.races[i].reportingUnits[j].lastUpdated;

           for (var k=0; k < dataCompare.races[i].reportingUnits[j].candidates.length; k++) {
              first[k] = dataCompare.races[i].reportingUnits[j].candidates[k].first;
              last[k] = dataCompare.races[i].reportingUnits[j].candidates[k].last;
              party[k] = dataCompare.races[i].reportingUnits[j].candidates[k].party;
              incumbent[k] = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
              voteCount[k] = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
              winner[k] = dataCompare.races[i].reportingUnits[j].candidates[k].winner;
           } //end k loop
         } //end if
     } //end j loop
    } //end if
     }
   } else {
     for (var j=0; j < dataCompare.races[i].reportingUnits.length; j++) {
       if (state != null && evcd != null) {
         if (dataCompare.races[i].reportingUnits[j].statePostal == state && dataCompare.races[i].reportingUnits[j].reportingunitName == evcd){
              stateName = dataCompare.races[i].reportingUnits[j].stateName;
              statePostal = dataCompare.races[i].reportingUnits[j].statePostal;
              precinctsReporting = dataCompare.races[i].reportingUnits[j].precinctsReporting;
              precinctsTotal = dataCompare.races[i].reportingUnits[j].precinctsTotal;
              precinctsReportingPct = dataCompare.races[i].reportingUnits[j].precinctsReportingPct;
              lastUpdated = dataCompare.races[i].reportingUnits[j].lastUpdated;

           for (var k=0; k < dataCompare.races[i].reportingUnits[j].candidates.length; k++) { 
              first[k] = dataCompare.races[i].reportingUnits[j].candidates[k].first;
              last[k] = dataCompare.races[i].reportingUnits[j].candidates[k].last;
              party[k] = dataCompare.races[i].reportingUnits[j].candidates[k].party;
              incumbent[k] = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
              voteCount[k] = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
              winner[k] = dataCompare.races[i].reportingUnits[j].candidates[k].winner;
           } //end k loop
         }
      } else if (state != null){
         if (dataCompare.races[i].reportingUnits[j].stateName == state){
              stateName = dataCompare.races[i].reportingUnits[j].stateName;
              statePostal = dataCompare.races[i].reportingUnits[j].statePostal;
              precinctsReporting = dataCompare.races[i].reportingUnits[j].precinctsReporting;
              precinctsTotal = dataCompare.races[i].reportingUnits[j].precinctsTotal;
              precinctsReportingPct = dataCompare.races[i].reportingUnits[j].precinctsReportingPct;
              lastUpdated = dataCompare.races[i].reportingUnits[j].lastUpdated;

           for (var k=0; k < dataCompare.races[i].reportingUnits[j].candidates.length; k++) { 
              first[k] = dataCompare.races[i].reportingUnits[j].candidates[k].first;
              last[k] = dataCompare.races[i].reportingUnits[j].candidates[k].last;
              party[k] = dataCompare.races[i].reportingUnits[j].candidates[k].party;
              incumbent[k] = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
              voteCount[k] = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
              winner[k] = dataCompare.races[i].reportingUnits[j].candidates[k].winner;
           } //end k loop
         }
      } else if (district != null) {
         if (dataCompare.races[i].reportingUnits[j].fipsCode == district){
              stateName = dataCompare.races[i].reportingUnits[j].stateName;
              statePostal = dataCompare.races[i].reportingUnits[j].statePostal;
              precinctsReporting = dataCompare.races[i].reportingUnits[j].precinctsReporting;
              precinctsTotal = dataCompare.races[i].reportingUnits[j].precinctsTotal;
              precinctsReportingPct = dataCompare.races[i].reportingUnits[j].precinctsReportingPct;
              lastUpdated = dataCompare.races[i].reportingUnits[j].lastUpdated;

           for (var k=0; k < dataCompare.races[i].reportingUnits[j].candidates.length; k++) { 
              first[k] = dataCompare.races[i].reportingUnits[j].candidates[k].first;
              last[k] = dataCompare.races[i].reportingUnits[j].candidates[k].last;
              party[k] = dataCompare.races[i].reportingUnits[j].candidates[k].party;
              incumbent[k] = dataCompare.races[i].reportingUnits[j].candidates[k].incumbent;
              voteCount[k] = dataCompare.races[i].reportingUnits[j].candidates[k].voteCount;
              winner[k] = dataCompare.races[i].reportingUnits[j].candidates[k].winner;
           } //end k loop
         }
      } 
     } //end j loop
   }
} //end i loop

//sort arrays by vountCount
for (var i = 0; i < voteCount.length; i++) {
    sortAll.push({ 'first': first[i], 'last': last[i], 'party': party[i], 'incumbent': incumbent[i], 'voteCount': voteCount[i], 'winner': winner[i] });
}

sortAll.sort(function(a, b) {
  return b.voteCount - a.voteCount;
});

first = [];
last = [];
party = [];
incumbent = [];
voteCount = [];
winner = [];

for (var i = 0; i < sortAll.length; i++) {
   first.push(sortAll[i].first);
   last.push(sortAll[i].last);
   party.push(sortAll[i].party);
   incumbent.push(sortAll[i].incumbent);
   voteCount.push(sortAll[i].voteCount);
   winner.push(sortAll[i].winner);
} 


//initialize and calculate some miscellaneous variables for printing results
for (var i=0; i < voteCount.length; i++){
  voteCountT += voteCount[i];
}

var topPCT = voteCount[0] / voteCountT;

var evString = "";
if (ev != null) { evString = "<span class='ev'> - " + ev + " electoral votes</span>"; }

var stateString = state;
if (label != null) { stateString = label + ", " + statePostal; } else { stateString = state; }

var iMark = [];
for (var i = 0; i < incumbent.length; i++) {
if (incumbent[i] == true) { iMark[i] = "*"; }
else { iMark[i] = ""; }
}

var wMark = [];
for (var i = 0; i < last.length; i++) {
if (winner[i] == "X") { wMark[i] = "&#x2714;"; }
else { wMark[i] = ""; }
}

var colors = [];
for (var i=0; i < last.length; i++){
  var thisPCT = voteCount[i] / voteCountT;
    if (party[i] == "GOP"){
      if (thisPCT >= .80) { colors[i] = "#d84c27"; } 
      else if (thisPCT >= .70) { colors[i] = "#df6a4c"; } 
      else if (thisPCT >= .60) { colors[i] = "#e58970"; } 
      else if (thisPCT >= 0) { colors[i] = "#eca795"; } 
    }
    else if (party[i] == "Dem") { 
      if (thisPCT >= .80) { colors[i] = "#2b7ab5"; } 
      else if (thisPCT >= .70) { colors[i] = "#4f90c1"; } 
      else if (thisPCT >= .60) { colors[i] = "#73a7ce"; } 
      else if (thisPCT >= 0) { colors[i] = "#97bedb"; } 
    }
    else if (thisPCT > 0) { colors[i] = "#299E3D"; }
    else { colors[i] = "#bbbbbb"; }
}


//return precincts
if (type == "pct"){ return precinctsReportingPct; }

//return timestamp
if (type == "timestamp"){ return lastUpdated; }

//return all votes
if (type == "votesT"){ return voteCountT; }

//return dem votes
if (type == "votesD"){
    for (var i = 0; i < last.length; i++) {
    if (party[i] == "Dem") { return voteCount[i]; }
    }
}

//return gop votes
if (type == "votesR"){
    for (var i = 0; i < last.length; i++) {
    if (party[i] == "GOP") { return voteCount[i]; }
    }
}

//return winner
if (type == "winner"){
  for (var i = 0; i < last.length; i++) {
    if (winner[i] == "X"){
      if (party[i] == "GOP"){ return "GOP Win"; }
      else if (party[i] == "Dem"){ return "DEM Win"; }
      else { return "IND Win"; }
    }
  }
}

//return lean
if (type == "lean"){
    if (winner[0] == "X" && party[0] == "GOP"){ return "#d34A44"; }
    else if (winner[0] == "X" && party[0] == "Dem"){ return "#3585BC"; }
    else if (winner[0] == "X") { return "#299E3D"; }
    else if (party[0] == "GOP") { return "#f7816E"; }
    else if (party[0] == "Dem") { return "#72A9D6"; }
    else if (voteCount[0] == 0) { return "#bbbbbb"; } 
    else { return "#bbbbbb"; } 
}

//return color
if (type == "colors"){ return colors[0]; }

//return tooltips
if (type == "tooltip"){
  var tooltipString = "<div class='districtName'>" + stateString + "</div>";
  if (last.length < 2) { var howMany = last.length; }
  else { var howMany = 2; }

  for (var i = 0; i < howMany; i++) {
    var thisPCT = "0%";
    if (voteCountT > 0) { thisPCT = d3.format("%")(voteCount[i] / voteCountT); }
    tooltipString += "<div class='candidate'>" + iMark[i] + last[i] + " " + wMark[i] + "</div><div class='pct' style='background-color:" + colors[i] + "'>" + thisPCT + "</div><div class='smallbreak'>"
  }

  return tooltipString;
}

//return tables
if (type == "table"){
  var stateColor = "";
  if (last.length < 3) { var howMany = last.length; }
  else { var howMany = 3; }

  var tableString = "<div class='districtName'>" + stateString + " " + evString + "</div><div class='resultsRow'><div class='resultsHead'>Candidate</div><div class='counts resultsHead'>#</div><div class='pct resultsHead'>%</div></div>";

  for (var i = 0; i < howMany; i++) {
    var thisPCT = "0%";
    if (voteCountT > 0) { thisPCT = d3.format("%")(voteCount[i] / voteCountT); }

    stateColor = ""

    if (winner[i] == "X" && party[i] == "GOP") { stateColor = "republican"; }
    else if (winner[i] == "X" && party[i] == "Dem") { stateColor = "democrat"; }
    else if (winner[i] == "X") { stateColor = "green4"; }

    tableString += "<div class='resultsRow'><div class='candidate'>" + iMark[i] + first[i] + " " + last[i] + " (" + party[i] + ")" + " " + wMark[i] + "</div><div class='counts'>" + d3.format(",")(voteCount[i]) + "</div><div class='pct " + stateColor + "' style='border:2px solid " + colors[i] + ";'>" + thisPCT + "</div></div>"
  }

  return tableString + "<div class='reportingRow'><span class='pctReported'>" + precinctsReporting + "</span> / <span class='pctAll'>" + precinctsTotal + "</span> (" + precinctsReportingPct + "%) precincts reporting</div>";
}

//return boards
if (type == "board"){
var pct1 = "0%";
var pct2 = "0%";
var color1 = "";
var color2 = "";
var candidate1 = first[0] + " " + last[0];
var candidate2 = first[1] + " " + last[1];
var stateColor1 = "";
var stateColor2 = "";
var dTest = false;

  for (var i = 0; i < 2; i++) {
    if (party[i] == "Dem" && pct1 == "0%"){
        pct1 = d3.format("%")(voteCount[i] / voteCountT); 
        color1 = colors[i];
        if (winner[i] == "X") { stateColor1 = "democrat"; }
    }
    else if (party[i] == "Dem" && pct1 != "0%"){
        pct2 = d3.format("%")(voteCount[i] / voteCountT); 
        color2 = colors[i];
        if (winner[i] == "X") { stateColor2 = "democrat"; }
    }
    else if (party[i] == "GOP" && pct2 == "0%"){
        pct2 = d3.format("%")(voteCount[i] / voteCountT); 
        color2 = colors[i];
        if (winner[i] == "X") { stateColor2 = "republican"; }
    }
    else if (party[i] == "GOP" && pct2 != "0%"){
        pct1 = d3.format("%")(voteCount[i] / voteCountT); 
        color1 = colors[i];
        if (winner[i] == "X") { stateColor1 = "republican"; }
    }
  }

    if (voteCountT == 0) { pct1 = "0%"; pct2 = "0%"; }

    if (race == "president" && evcd != null){
    return "<div id='evcd" + label + "' class='tableRow evcd' name='" + label + "'><div class='stateBlockR'>" + label + "</div><div class='pctBox'>" + ev + "</div><div class='pctBox " + stateColor1 + "' style='border:2px solid " + color1 + ";'>" + pct1 + "</div><div class='pctBox " + stateColor2 + "' style='border:2px solid " + color2 + ";'>" + pct2 + "</div><div class='pctBox reporting'>" + precinctsReportingPct + "%</div><div class='searchTerms'>" + stateName + " " + candidate1 + " " + candidate2 +  "</div></div>";
    }

    if (race == "president"){
    return "<div class='tableRow' name='" + statePostal + "'><div class='stateBlockR'>" + statePostal + "</div><div class='pctBox'>" + ev + "</div><div class='pctBox " + stateColor1 + "' style='border:2px solid " + color1 + ";'>" + pct1 + "</div><div class='pctBox " + stateColor2 + "' style='border:2px solid " + color2 + ";'>" + pct2 + "</div><div class='pctBox reporting'>" + precinctsReportingPct + "%</div><div class='searchTerms'>" + stateName + " " + candidate1 + " " + candidate2 +  "</div></div>";
    }

    if (race == "senate" || race == "governors"){
    return "<div class='tableRow' name='" + statePostal + "'><div class='stateBlockR'>" + statePostal + "</div><div class='pctBox " + stateColor1 + "' style='border:2px solid " + color1 + ";'>" + pct1 + "</div><div class='pctBox " + stateColor2 + "' style='border:2px solid " + color2 + ";'>" + pct2 + "</div><div class='pctBox reporting'>" + precinctsReportingPct + "%</div><div class='searchTerms'>" + stateName + " " + candidate1 + " " + candidate2 +  "</div></div>";
    }

    if (race == "mnhouse" || race == "mnsenate"){
    return "<div class='tableRow' name='" + label + "'><div class='stateBlockR'>" + label + "</div><div class='pctBox " + stateColor1 + "' style='border:2px solid " + color1 + ";'>" + pct1 + "</div><div class='pctBox " + stateColor2 + "' style='border:2px solid " + color2 + ";'>" + pct2 + "</div><div class='pctBox reporting'>" + precinctsReportingPct + "%</div><div class='searchTerms'>" + stateName + " " + candidate1 + " " + candidate2 +  "</div></div>";
    }

    if (race == "ushouse"){
    return "<div class='tableRow' name='Minnesota" + label + "'><div class='stateBlockR'>MN" + label + "</div><div class='pctBox " + stateColor1 + "' style='border:2px solid " + color1 + ";'>" + pct1 + "</div><div class='pctBox " + stateColor2 + "' style='border:2px solid " + color2 + ";'>" + pct2 + "</div><div class='pctBox reporting'>" + precinctsReportingPct + "%</div><div class='searchTerms'>" + stateName + " " + candidate1 + " " + candidate2 +  "</div></div>";
    }
  }

} //end fetchData

//CRUNCH KEY RESULTS
function prezCrunch(){

  var stateList = ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","District of Columbia","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];

  var evList = [9,3,11,6,55,9,7,3,3,29,16,4,4,20,11,6,6,8,8,2,10,11,16,10,6,10,3,2,6,4,14,5,29,15,3,18,7,7,20,4,9,3,11,38,6,3,13,12,5,10,3];

  var dTally = 0;
  var rTally = 0;

  for (var i=0; i < stateList.length; i++){
    var updated = fetchData(null,stateList[i],"winner",dataCounty,"president",null,null);

    if (updated == "GOP Win") { rTally += evList[i]; }
    else if (updated == "DEM Win") { dTally += evList[i]; }

  }

  var me1R = fetchData("District 1","ME","votesR",dataEVCD,"president",1,"ME01","District 1");
  var me1D = fetchData("District 1","ME","votesD",dataEVCD,"president",1,"ME01","District 1");
  var me2R = fetchData("District 2","ME","votesR",dataEVCD,"president",1,"ME02","District 2");
  var me2D = fetchData("District 2","ME","votesD",dataEVCD,"president",1,"ME02","District 2");
  var ne1R = fetchData("District 1","NE","votesR",dataEVCD,"president",1,"NE01","District 1");
  var ne1D = fetchData("District 1","NE","votesD",dataEVCD,"president",1,"NE01","District 1");
  var ne2R = fetchData("District 2","NE","votesR",dataEVCD,"president",1,"NE02","District 2");
  var ne2D = fetchData("District 2","NE","votesD",dataEVCD,"president",1,"NE02","District 2");
  var ne3R = fetchData("District 3","NE","votesR",dataEVCD,"president",1,"NE03","District 3");
  var ne3D = fetchData("District 3","NE","votesD",dataEVCD,"president",1,"NE03","District 3");

  var meW = fetchData(null,"Maine","winner",dataCounty,"president",2,null,null);
  var neW = fetchData(null,"Nebraska","winner",dataCounty,"president",2,null,null);

  if (meW == "GOP Win" || meW == "Dem Win") { 
    if (me1R > me1D) { rTally++; }
    else { dTally++; }

    if (me2R > me2D) { rTally++; }
    else { dTally++; }
  }

  if (neW == "GOP Win" || neW == "Dem Win") { 
    if (ne1R > ne1D) { rTally++; }
    else { dTally++; }

    if (ne2R > ne2D) { rTally++; }
    else { dTally++; }

    if (ne3R > ne3D) { rTally++; }
    else { dTally++; }
  }
  
  $("#demPres").html(dTally);
  $("#repPres").html(rTally);
  $("#demBarPres").css("width", d3.format("%")(dTally/538));
  $("#repBarPres").css("width", d3.format("%")(rTally/538));

}

function senCrunch(){
  
  var stateList = ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maryland","Missouri","Nevada","New Hampshire","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","South Carolina","South Dakota","Utah","Vermont","Washington","Wisconsin"];

  var dTally = 36;
  var rTally = 30;

  for (var i=0; i < stateList.length; i++){
    var updated = fetchData(null,stateList[i],"winner",dataSenate,"senate",null,null);

    if (updated == "GOP Win") { rTally++; }
    else if (updated == "DEM Win") { dTally++; }

  }

  $("#dem-US-senate").html(dTally);
  $("#rep-US-senate").html(rTally);
  $("#dem-US-senateBar").css("width", d3.format("%")(dTally/100));
  $("#rep-US-senateBar").css("width", d3.format("%")(rTally/100));

}

function houseCrunch(){

  var stateList = ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];
  var districtList = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53];

  var dTally = 0;
  var rTally = 0;

  for (var i=0; i < districtList.length; i++){
    for (var k=0; k < stateList.length; k++){
    var updated = fetchData("District " + districtList[i],stateList[k],"winner",dataHouse,"ushouse",null,"District " + districtList[i]);
    if (updated == "GOP Win") { rTally++; }
    else if (updated == "DEM Win") { dTally++; }
    }

  }

  $("#dem-US-house").html(dTally);
  $("#rep-US-house").html(rTally);
  $("#dem-US-houseBar").css("width", d3.format("%")(dTally/435));
  $("#rep-US-houseBar").css("width", d3.format("%")(rTally/435));

}

function mnhouseCrunch(){

  var districtList = ["1A","1B","2A","2B","3A","3B","4A","4B","5A","5B","6A","6B","7A","7B","8A","8B","9A","9B","10A","10B","11A","11B","12A","12B","13A","13B","14A","14B","15A","15B","16A","16B","17A","17B","18A","18B","19A","19B","20A","20B","21A","21B","22A","22B","23A","23B","24A","24B","25A","25B","26A","26B","27A","27B","28A","28B","29A","29B","30A","30B","31A","31B","32A","32B","33A","33B","34A","34B","35A","35B","36A","36B","37A","37B","38A","38B","39A","39B","40A","40B","41A","41B","42A","42B","43A","43B","44A","44B","45A","45B","46A","46B","47A","47B","48A","48B","49A","49B","50A","50B","51A","51B","52A","52B","53A","53B","54A","54B","55A","55B","56A","56B","57A","57B","58A","58B","59A","59B","60A","60B","61A","61B","62A","62B","63A","63B","64A","64B","65A","65B","66A","66B","67A","67B"];

  var dTally =0 ;
  var rTally = 0;

  for (var i=0; i < districtList.length; i++){

    var updated = fetchData("District " + districtList[i],"Minnesota","winner",dataMNH,"mnhouse",null,"District " + districtList[i]);

    if (updated == "GOP Win") { rTally++; }
    else if (updated == "DEM Win") { dTally++; }

  }

  $("#dem-MN-house").html(dTally);
  $("#rep-MN-house").html(rTally);
  $("#dem-MN-houseBar").css("width", d3.format("%")(dTally/134));
  $("#rep-MN-houseBar").css("width", d3.format("%")(rTally/134));

}

function mnsenCrunch(){

  var districtList = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67];

  var dTally = 0;
  var rTally = 0;

  for (var i=0; i < districtList.length; i++){

    var updated = fetchData("District " + districtList[i],"Minnesota","winner",dataMNS,"mnsenate",null,"District " + districtList[i]);

    if (updated == "GOP Win") { rTally++; }
    else if (updated == "DEM Win") { dTally++; }

  }

  $("#dem-MN-senate").html(dTally);
  $("#rep-MN-senate").html(rTally);
  $("#dem-MN-senateBar").css("width", d3.format("%")(dTally/67));
  $("#rep-MN-senateBar").css("width", d3.format("%")(rTally/67));

}

function raceCrunch(){

  var dPct = fetchData("District 2","Minnesota","votesD",dataHouse,"ushouse",null,"District 2");
  var rPct = fetchData("District 2","Minnesota","votesR",dataHouse,"ushouse",null,"District 2");
  var total = fetchData("District 2","Minnesota","votesT",dataHouse,"ushouse",null,"District 2");
  var pct = fetchData("District 2","Minnesota","pct",dataHouse,"ushouse",null,"District 2");
  var winner = fetchData("District 2","Minnesota","winner",dataHouse,"ushouse",null,"District 2");

  if (winner == "DEM Win") { $("#local-race-demWin").html("&#10004;"); }
  else if (winner == "GOP Win") { $("#local-race-repWin").html("&#10004;"); }

  $("#local-race-dem").html(d3.format("%")(dPct/total));
  $("#local-race-rep").html(d3.format("%")(rPct/total));
  $("#racePct").html(pct + "% reporting");

  var dPct2 = fetchData("District 3","Minnesota","votesD",dataHouse,"ushouse",null,"District 3");
  var rPct2 = fetchData("District 3","Minnesota","votesR",dataHouse,"ushouse",null,"District 3");
  var total2 = fetchData("District 3","Minnesota","votesT",dataHouse,"ushouse",null,"District 3");
  var pct2 =  fetchData("District 3","Minnesota","pct",dataHouse,"ushouse",null,"District 3");
  var winner2 = fetchData("District 3","Minnesota","winner",dataHouse,"ushouse",null,"District 3");

  if (winner2 == "DEM Win") { $("#local-race-proWin").html("&#10004;"); }
  else if (winner2 == "GOP Win") { $("#local-race-conWin").html("&#10004;"); }

  if (total1 != 0 && total2 != 0) { $("#local-race-pro").html(d3.format("%")(dPct2/total2));
  $("#local-race-con").html(d3.format("%")(rPct2/total2)); } else { $("#local-race-pro").html("0%");
  $("#local-race-con").html("0%");

  }
  $("#votePct").html(pct2 + "% reporting");

   $("#done").html("DONE");

}

prezCrunch();
senCrunch();
houseCrunch();
mnhouseCrunch();
mnsenCrunch();
raceCrunch();

$(document).ready(function() {
 $.ajaxSetup({ cache: false });
});

});
});
});
});
});
});
</script>
</html>