<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>2016 Minnesota Legislature</title>
  <meta name="description" content="Title Here">
  <meta name="author" content="Frey Hargarten - StarTribune">

  <link href="../_common_resources/charts/nvd3-master/build/nv.d3.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../_common_resources/styles/startribune_dataviz_styles.css" />
  
  <style>
  #wrapper { width:100%; margin-right:auto; margin-left:auto; }
  #viewSelect { text-align:center; }
  .switch { padding:10px; display:inline-block; text-align:center; width:49.5%; background-color:#fff; font-weight:900; font-family:"Benton Sans",Helvetica,Arial,sans-serif; border:1px solid black; }
  .switch:hover, .selected, .hSort:hover, .sSort:hover { background-color:#4C4C39; color:#fff !important; cursor:pointer; }

  .metro, .mn { width:45%; display:inline-block; }
  .infobox { width:100%; height:190px; font-family:"Benton Sans",Helvetica,Arial,sans-serif; }

  .tableHead { display:inline-block; padding:10px; border-bottom:1px solid #ddd; width:24%; font-weight:900; font-family:"Poynter Serif RE"; }
  .tableCell { display:inline-block; padding:10px; border-bottom:1px solid #ddd; width:24%; font-family:"Benton Sans"; }
  .tableBreak { clear:both; display:block; }
  .table { text-align:center; width:100%; overflow-x:hidden; overflow-y:auto; height:670px; }
  .campaigns { text-align:center; }
  .campaignsRPM, .campaignsDFL { display:inline-block; vertical-align:top; padding:7px; text-align:left; width:49%; }
  .campaignsRPM { border-left:2px solid #9C0004; }
  .campaignsDFL { border-left:2px solid #0D4773; }
  .votes, .dollars { font-family:"Popular"; font-weight:900; font-size:1.2em; }

  .map { width:100%; }

  .toggleTables { text-align:center; font-family:"Benton Sans",Helvetica,Arial,sans-serif; font-weight:900; padding:15px; }
  .toggleTables:hover { cursor:pointer; }

  h2 { text-align:center; font-family:"Poynter Serif RE"; font-weight:900; }
  .districtSelect { width:100%; text-align:center; font-family:"Benton Sans",Helvetica,Arial,sans-serif; display:none; }
  .column { display:inline-block; width:48%; vertical-align:top; text-align:center; }
  .title { font-family:"Poynter Serif RE"; font-size:1.7em; text-align:center; font-weight:bold; }
  .district:hover, .districtH:hover, .districtS:hover { background-color:#4C4C39 !important; cursor:pointer; color:#fff; }

  #senate { display:none; }

  #senateToggle { display:none; }

  .zoom { text-align:center; float:none !important; padding:15px; }
  .legends { width:390px; height:auto; text-align:center; margin-right:auto; margin-left:auto; }

  .republican { color:#9C0004; fill:#9C0004 !important; pointer-events: all; font-weight:bold; }
  .r1 { background-color:#FF8572; fill:#FF8572 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .r2 { background-color:#F2634C; fill:#F2634C !important; color:white !important; pointer-events: all; font-weight:bold; }
  .r3 { background-color:#9C0004; fill:#9C0004 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .r4 { background-color:#4E0002; fill:#4E0002 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .mid { background-color:#ddd; fill:#ddd !important; color:white !important; pointer-events: all; font-weight:bold; }
  .democrat { color:#0D4773; fill:#0D4773 !important; pointer-events: all; font-weight:bold; }
  .d1 { background-color:#67B4C2; fill:#67B4C2 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .d2 { background-color:#4192A1; fill:#4192A1 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .d3 { background-color:#0D4773; fill:#0D4773 !important; color:white !important; pointer-events: all; font-weight:bold; }
  .d4 { background-color:#022642; fill:#022642 !important; color:white !important; pointer-events: all; font-weight:bold; }

  .demSwatch { background-color:#0D4773; fill:#0D4773 !important; pointer-events: all; font-weight:bold; }
  .gopSwatch { background-color:#9C0004; fill:#9C0004 !important; pointer-events: all; font-weight:bold; }

  small { font-family:"Benton Sans",Helvetica,Arial,sans-serif; color:#808080; clear:both; display:block; }

  .mapBox { float:left; width:48%; }
  .demoBox { float:right; width:48%; }
  .chatterBox { height:160px; }
  .step { width:19.5%; display:inline-block; border:1px solid #ddd; height:120px; vertical-align:middle; font-family:"Benton Sans",Helvetica,Arial,sans-serif; }
  .step:hover, .stepSelect { border:1px solid #4C4C39; cursor:pointer; }
  #houseStepper, #senateStepper { text-align:center; }

  .statRow { width:100%; }
  .cell { display:inline-block; text-align:center; }
  .statNum { padding:7px; font-size:1.2em; font-weight:400; }
  .statNum:hover { cursor:pointer; background-color:#333; color:#fff; }
  .raceRow .cell { width:50%; }
  .femaleRow .cell, .maleRow .cell, .schoolRow .cell, .incomeRow .cell { width:25%; }
  .label { font-size:.8em; font-family:"Benton Sans",Helvetica,Arial,sans-serif; text-align:center; }

  .districtName { text-align:center; }

  .powerBar { text-align:center; vertical-align:top; }
  .rows { width:30%; display:inline-block; vertical-align:top; }
  .campaigns { font-family:"Benton Sans",Helvetica,Arial,sans-serif; }

  .metro { display:none; }

  #viewSelect { display:none; }

  @media (max-width:820px) {
  .mapBox { width:100%; float:none; text-align:center; }
  .metro { display:none; }
  .infobox { height:auto; }
  .demoBox { width:100%; float:none; text-align:center; }
  .tableHead, .tableCell { font-size:.75em; }
  .step { width:19%; }
  .card { vertical-align:top; }
  }
  </style> 
</head>

<body>
  <div id="wrapper">

<div id="viewSelect">
<div class="switch selected" data="house" year="2014">House</div>
<div class="switch" data="senate" year="2012">Senate</div>
</div>

<div id="houseToggle" class="toggleTables">DISTRICT SELECT</div>
<div id="senateToggle" class="toggleTables">DISTRICT SELECT</div>

<div id="house" class="section">  
    
<div id="analysisHouse">

<div id="houseStepper">
<div class="step stepSelect">
  MNLEG: The House
</div>
<div class="step">
  Hot House races
</div>
<div class="step">
  Big Primaries
</div>
<div class="step">
  The DFL's Chances
</div>
<div class="step">
  Probable Outcomes
</div>
</div>

<div class="breaker"></div>

<div class="districtSelect">
<div id="gopColumn" class="column">
<div class="district republican selectedYear" region="mn">02A</div>
<div class="district republican" region="mn">10A</div>
<div class="district republican" region="mn">10B</div>
<div class="district republican" region="mn">11B</div>
<div class="district republican" region="mn">12A</div>
<div class="district republican" region="mn">14B</div>
<div class="district republican" region="mn">17A</div>
<div class="district republican" region="mn">17B</div>
<div class="district republican" region="mn">21A</div>
<div class="district republican" region="mn">24A</div>
</div>
<div id="dflColumn" class="column">
<div class="district republican" region="mn">24B</div>
<div class="district republican" region="metro">56B</div>
<div class="district republican" region="metro">57B</div>
<div class="district democrat" region="metro">36B</div>
<div class="district democrat" region="metro">42A</div>
<div class="district democrat" region="metro">42B</div>
<div class="district democrat" region="metro">43A</div>
<div class="district democrat" region="metro">48A</div>
<div class="district democrat" region="metro">49A</div>
<div class="district democrat" region="metro">50B</div>
</div>
</div>

<div class="mapBox">
<div class="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>DFL</span>
          <span class='d4'></span>
          <span class='d3'></span>
          <span class='d2'></span>
          <span class='d1'></span>
          <span class='mid'></span>
          <span class='r1'></span>
          <span class='r2'></span>
          <span class='r3'></span>
          <span class='r4'></span>
          <span style='background:#fff;'>RPM</span>
        </nav>
      </span>
    </div>
    <small><span id="year">2014</span> Win Percentage</small>
  </div>

<div id="mapHouse" class="map mn" data="finance"><svg width="100%" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>

<div id="mapHouseMetro" class="map metro" data="finance"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>
  <div class="powerBar">
<div class="rows"><div class="dflCount column bigNum democrat">61</div></div>
<div class="rows"><h2>Minnesota House</h2></div>
<div class="rows"><div class="gopCount column bigNum republican">73</div></div>
  </div>
</div>

<div class="demoBox">
<div class="chatterBox">
<div class="label">Campaign Finance</div>
  <div class="campaigns">
    <div class="campaignsRPM"></div>
    <div class="campaignsDFL"></div>
  </div>
</div>

<div id="houseInfo" class="infobox">
<div id="houseExplain" class="explain">
  <div class="districtName"><div class="r3">Minnesota</div></div>
  <div class="stats">
<div class='raceRow' class='statRow'>
  <div class='cell'>
    <div class='label'>White Population</div>
    <div class='statNum' data='whites'>.83</div>
  </div><div class='cell'>
    <div class='label'>Minority Population</div>
    <div class='statNum' data='minorities'>.17</div>
  </div>
</div>
  <div class='schoolRow' class='statRow'>
    <div class='cell'>
      <div class='label'>High School</div>
      <div class='statNum' data='highschool'>.35</div>
    </div><div class='cell'>
      <div class='label'>Some/Associates</div>
      <div class='statNum' data='associates'>.33</div>
    </div><div class='cell'>
      <div class='label'>Bachelor's</div>
      <div class='statNum' data='bachelors'>.22</div>
    </div><div class='cell'>
      <div class='label'>Graduate</div>
      <div class='statNum' data='graduate'>.11</div>
    </div>
  </div>
    <div class='incomeRow' class='statRow'>
      <div class='cell'>
        <div class='label'>< $40k</div>
        <div class='statNum' data='low'>.20</div>
      </div><div class='cell'>
        <div class='label'>$40k-$75k</div>
        <div class='statNum' data='mid' data='graduate'>.20</div>
      </div><div class='cell'>
        <div class='label'>$75k-$100k</div>
        <div class='statNum' data='high'>.20</div>
      </div><div class='cell'>
        <div class='label'>$100k+</div>
        <div class='statNum' data='highest'>.20</div>
      </div>
    </div>
    <div class='maleRow' class='statRow'>
      <div class='cell'>
        <div class='label'>Men 18-34</div>
        <div class='statNum' data='mYoung'>.12</div>
      </div><div class='cell'>
        <div class='label'>Males 35-49</div>
        <div class='statNum' data='mMiddle'>.07</div>
      </div><div class='cell'>
        <div class='label'>Males 50-64</div>
        <div class='statNum' data='mOld'>.10</div>
      </div><div class='cell'>
        <div class='label'>Males 65+</div>
        <div class='statNum' data='mOldest'>.06</div>
      </div>
    </div>
    <div class='femaleRow' class='statRow'>
      <div class='cell'>
        <div class='label'>Females 18-34</div>
        <div class='statNum' data='fYoung'>.08</div>
      </div><div class='cell'>
        <div class='label'>Females 35-49</div>
        <div class='statNum' data='fMiddle'>.10</div>
      </div><div class='cell'>
        <div class='label'>Females 50-64</div>
        <div class='statNum' data='fOld'>.10</div>
      </div><div class='cell'>
        <div class='label'>Females 65+</div>
        <div class='statNum' data='fOldest'>.07</div>
      </div>
    </div>
  </div>

  <div class="breaker"></div>

  <div id="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>Less</span>
          <span class='gray1'></span>
          <span class='gray2'></span>
          <span class='gray3'></span>
          <span class='gray4'></span>
          <span class='gray5'></span>
          <span style='background:#fff;'>More</span>
        </nav>
      </span>
    </div>
  </div>
</div>
</div>
</div>

</div>

  <div class="breaker"></div>

<div class="zoom">Reset View</div>

<div id="filterHouse" class="filter"><input type="search" class="filter_box" placeholder="Search by keyword"></input></div>

<div id="tableHouse" class="table" data="finance">
<div class='tableHead partyBar hSort' data="candidate">Incumbant</div><div class='tableHead hSort selected' data="district">District</div><div class='tableHead hSort' data="party">Party</div><div class='tableHead hSort' data="vote">2014 Vote</div>
</div>

</div>

<div id="senate" class="section">
<div id="analysisSenate" data="senate">

<div id="senateStepper">
<div class="step">
  step
</div>
<div class="step">
  step
</div>
<div class="step">
  step
</div>
<div class="step">
  step
</div>
<div class="step">
  step
</div>
</div>

<div class="breaker"></div>


<div class="districtSelect">
<div id="gopColumn" class="column">
<div class="district republican selected" region="mn">21</div>
<div class="district republican" region="mn">35</div>
<div class="district republican" region="mn">56</div>
<div class="district republican" region="mn">58</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="distric" region="mn">-</div>
<div class="district" region="mn">-</div>
</div>
<div id="dflColumn" class="column">
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
<div class="district" region="mn">-</div>
</div>
</div>

<div class="mapBox" data="senate">
<div class="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>DFL</span>
          <span class='d4'></span>
          <span class='d3'></span>
          <span class='d2'></span>
          <span class='d1'></span>
          <span class='mid'></span>
          <span class='r1'></span>
          <span class='r2'></span>
          <span class='r3'></span>
          <span class='r4'></span>
          <span style='background:#fff;'>RPM</span>
        </nav>
      </span>
    </div>
    <small><span id="year">2012</span> Win Percentage</small>
  </div>

<div id="mapSenate" class="map mn" data="finance"><svg width="100%" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>

<div id="mapSenateMetro" class="map metro" data="finance"><svg width="320" height="350" viewBox="0 0 500 550" preserveAspectRatio="xMidYMid"></svg></div>

  <div class="powerBar">
<div class="rows"><div class="dflCount democrat bigNum column">39</div></div>
<div class="rows"><h2>Minnesota Senate</h2></div>
<div class="rows"><div class="gopCount republican bigNum column">28</div></div>
  </div>
</div>

<div class="demoBox">
<div class="chatterBox">
<div class="label">Campaign Finance</div>
  <div class="campaigns">
    <div class="campaignsRPM"></div>
    <div class="campaignsDFL"></div>
  </div>
</div>

<div id="senateInfo" class="infobox">
<div id="senateExplain" class="explain">
  <div class="districtName"><div class="d3">Minnesota</div></div>
    <div class="stats">
<div class='raceRow' class='statRow'>
  <div class='cell'>
    <div class='label'>White Population</div>
    <div class='statNum' data='whites'>.83</div>
  </div><div class='cell'>
    <div class='label'>Minority Population</div>
    <div class='statNum' data='minorities'>.17</div>
  </div>
</div>
  <div class='schoolRow' class='statRow'>
    <div class='cell'>
      <div class='label'>High School</div>
      <div class='statNum' data='highschool'>.35</div>
    </div><div class='cell'>
      <div class='label'>Some/Associates</div>
      <div class='statNum' data='associates'>.33</div>
    </div><div class='cell'>
      <div class='label'>Bachelor's</div>
      <div class='statNum' data='bachelors'>.22</div>
    </div><div class='cell'>
      <div class='label'>Graduate</div>
      <div class='statNum' data='graduate'>.11</div>
    </div>
  </div>
    <div class='incomeRow' class='statRow'>
      <div class='cell'>
        <div class='label'>< $40k</div>
        <div class='statNum' data='low'>.20</div>
      </div><div class='cell'>
        <div class='label'>$40k-$75k</div>
        <div class='statNum' data='mid' data='graduate'>.20</div>
      </div><div class='cell'>
        <div class='label'>$75k-$100k</div>
        <div class='statNum' data='high'>.20</div>
      </div><div class='cell'>
        <div class='label'>$100k+</div>
        <div class='statNum' data='highest'>.20</div>
      </div>
    </div>
    <div class='maleRow' class='statRow'>
      <div class='cell'>
        <div class='label'>Men 18-34</div>
        <div class='statNum' data='mYoung'>.12</div>
      </div><div class='cell'>
        <div class='label'>Males 35-49</div>
        <div class='statNum' data='mMiddle'>.07</div>
      </div><div class='cell'>
        <div class='label'>Males 50-64</div>
        <div class='statNum' data='mOld'>.10</div>
      </div><div class='cell'>
        <div class='label'>Males 65+</div>
        <div class='statNum' data='mOldest'>.06</div>
      </div>
    </div>
    <div class='femaleRow' class='statRow'>
      <div class='cell'>
        <div class='label'>Females 18-34</div>
        <div class='statNum' data='fYoung'>.08</div>
      </div><div class='cell'>
        <div class='label'>Females 35-49</div>
        <div class='statNum' data='fMiddle'>.10</div>
      </div><div class='cell'>
        <div class='label'>Females 50-64</div>
        <div class='statNum' data='fOld'>.10</div>
      </div><div class='cell'>
        <div class='label'>Females 65+</div>
        <div class='statNum' data='fOldest'>.07</div>
      </div>
    </div>
  </div>

<div class="breaker"></div>

<div id="legends">
    <div class="legendContainer">
      <span class='legend'>
        <nav class='legend clearfix'>
          <span style='background:#fff;'>Less</span>
          <span class='gray1'></span>
          <span class='gray2'></span>
          <span class='gray3'></span>
          <span class='gray4'></span>
          <span class='gray5'></span>
          <span style='background:#fff;'>More</span>
        </nav>
      </span>
    </div>
</div>

</div>
</div>
</div>

</div>

  <div class="breaker"></div>

<div class="zoom">Reset View</div>

<div id="filterSenate" class="filter"><input type="search" class="filter_box" placeholder="Search by keyword"></input></div>

<div id="tableSenate" class="table" data="finance">
<div class='tableHead partyBar sSort' data="candidate">Incumbant</div><div class='tableHead sSort selected' data="district">District</div><div class='tableHead sSort' data="party">Party</div><div class='tableHead sSort' data="vote">2012 Vote</div>
</div>
  </div>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="../_common_resources/charts/nvd3-master/build/nv.d3.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/utils.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/tooltip.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/models/legend.js"></script>
<script src="../_common_resources/charts/nvd3-master/src/models/axis.js"></script>
<script src="../_common_resources/charts/nvd3-master/test/stream_layers.js"></script>

<script>
$(".table, .filter").hide();

//LIVE JSON MAGIC

//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=house_age_sex
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=senate_age_sex
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnsenate_2012_results
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnhouse_2014_results
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=mnleg_chatter
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=cand_disc_filings
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=candidates_2016
//https://script.google.com/macros/s/AKfycbwG7mX6qPZaIhkwY2AJ2lU7kNarbm6OWIkWVfnmYZGYruIl40cu/exec?id=17N3mrwSRe6BJScRby9auxtQ8o7UwhfXv2IuTxbmlakY&sheet=education_income

d3.json("https://script.googleusercontent.com/a/macros/umn.edu/echo?user_content_key=aFQ0WVryWcaaJM8xndKox_EVEncrHrk-RQymEVTcrfi63hZUanxmzcfZjR6Ah6ZLP5ls7OYBnxGLEKuqniZ9MLzIXQC6sO1XOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMi80zadyHLKASbbMAF6orU02DLGwV8tFzI-mtKRf-8plGOUy-lJCxpF2DQLccfmsBGWAyiujVfWxmelbCou2EhfNg1xV69xW9102aPo2dzOHxBaN3yEEewWa1A_hJpqb1jQYpGu_2nX6qHrnB7pMdYAlRuRXeX8EjVN5v0WhfWFhxLJ5M5GSsYWPXmVKuUy2vqhYU84uxc2Y&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataLoadAHouse) {
d3.json("https://script.googleusercontent.com/a/macros/umn.edu/echo?user_content_key=PiBasnmyzlMGLjd3ITS1d5uGYYC1pwYw4sB2nvezbGu3ZpngOCMVS3mWQxq-7x-gWn9Nzf0qCkk6OmSo8jYzhuHzsc0n-iwAOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMi80zadyHLKASbbMAF6orU02DLGwV8tFzI-mtKRf-8plGOUy-lJCxpF2DQLccfmsBGWAyiujVfWxmelbCou2EhfNg1xV69xW9102aPo2dzOHxBaN3yEEewWa1A_hJpqb1jQYpGu_2nX6qHrnB7pMdYAlRuRXeX8EjVN5v0WhfWFhxLJ5M5GSsYdgt8xcuDiz9o7r141pKk0I&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataLoadASenate) {
d3.json("https://script.googleusercontent.com/a/macros/umn.edu/echo?user_content_key=_V2kkcF07aAvnyaxapqGlKMbuyeuzGr1YJ6SZdNcOBh4v-s7gh-58ZQ1yuOJKCftNOzbCSyb8J06OmSo8jYzhlvpC7esuh3kOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMi80zadyHLKASbbMAF6orU02DLGwV8tFzI-mtKRf-8plGOUy-lJCxpF2DQLccfmsBGWAyiujVfWxmelbCou2EhfNg1xV69xW9102aPo2dzOHxBaN3yEEewWa1A_hJpqb1jQYpGu_2nX6qHrnB7pMdYAlRuRXeX8EjVN5v0WhfWFhxLJ5M5GSsYVQ8ZsXDfcGKeKnKPZA0kxu6R_V0hXCiaw&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataLoadSenate) {
d3.json("https://script.googleusercontent.com/a/macros/umn.edu/echo?user_content_key=rvDM5WHQnpECvq2-c3rEMYbNX8e-SKUDTitB5WIx5PadlZSPWvDDlAGLjztdU6BKQRz9cxLTFdk6OmSo8jYzhi9alPij4T1zOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMi80zadyHLKASbbMAF6orU02DLGwV8tFzI-mtKRf-8plGOUy-lJCxpF2DQLccfmsBGWAyiujVfWxmelbCou2EhfNg1xV69xW9102aPo2dzOHxBaN3yEEewWa1A_hJpqb1jQYpGu_2nX6qHrnB7pMdYAlRuRXeX8EjVN5v0WhfWFhxLJ5M5GSsYd1z3eb_tzq_6AgkQ2yLQAmPkX_w7sgVLw&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataLoadHouse) {
d3.json("https://script.googleusercontent.com/a/macros/umn.edu/echo?user_content_key=ze7-RyuKpiFcZlArKqGmFBC-eXBO2VLtUaSVz0lC0NlLcwz4J8PTL-mN3ymtl8fEL0v560DNSDH9OKlhgkfwePRd4heayXgMOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMi80zadyHLKASbbMAF6orU02DLGwV8tFzI-mtKRf-8plGOUy-lJCxpF2DQLccfmsBGWAyiujVfWxmelbCou2EhfNg1xV69xW9102aPo2dzOHxBaN3yEEewWa1A_hJpqb1jQYpGu_2nX6qHrnB7pMdYAlRuRXeX8EjVN5v0WhfWFhxLJ5M5GSsYWfraMZZq27VJ7ytWHyrXgE&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataLoadChatter) {
d3.json("https://script.googleusercontent.com/a/macros/umn.edu/echo?user_content_key=skJtZu_q6mj0TWkDRs9o8URbONuId2Ezd6S3xMbFBiXcPKxYkPLNDm3FG6xDXwEl3NzwvegREHowaJfgAtOFqOV91mNtDS_sOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMi80zadyHLKASbbMAF6orU02DLGwV8tFzI-mtKRf-8plGOUy-lJCxpF2DQLccfmsBGWAyiujVfWxmelbCou2EhfNg1xV69xW9102aPo2dzOHxBaN3yEEewWa1A_hJpqb1jQYpGu_2nX6qHrnB7pMdYAlRuRXeX8EjVN5v0WhfWFhxLJ5M5GSsYV2s7ifHr-KPPMK_kOxKafuu_3JopoAYBg&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataLoadCF) {
d3.json("https://script.googleusercontent.com/a/macros/umn.edu/echo?user_content_key=7XLzBY8eqYRmaEbfBIdm4zSUPFpVpwq_wZXhNGjbiyNuH6Za-CuxPRp6KCzOOwDPD3k-j0zWRwu-YSklCzNFqIPXE5IjUuiSOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMi80zadyHLKASbbMAF6orU02DLGwV8tFzI-mtKRf-8plGOUy-lJCxpF2DQLccfmsBGWAyiujVfWxmelbCou2EhfNg1xV69xW9102aPo2dzOHxBaN3yEEewWa1A_hJpqb1jQYpGu_2nX6qHrnB7pMdYAlRuRXeX8EjVN5v0WhfWFhxLJ5M5GSsYZ703RuLRyJJ7bRN4YxLeE4&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataLoadCandidates) {
d3.json("https://script.googleusercontent.com/macros/echo?user_content_key=7TOdC1DrVykfRNWCrQvsIzVcOuW0v2eKKG0sbTbv_O5iwhqUdpy3fXFLvx4wg80lV62L3Y0xbVge6yfCTAw34MDnGXw2_gy9OJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMWojr9NvTBuBLhyHCd5hHaxCoMjMSmZWLp6XAShvjQj50JtCfh4yP7n1RnEoDeOH7XqmOXgX8RYIyMAhIAtjnF9UDzNXGLr6TKipxUt_yr8YCBQUq6llrsIctjHQA_wQbvnqcIoaee9CY9hv9svyaHPh_NjVhE52nGFMHuQvceYxOf80yLrpamKRSw32PrD_m&lib=MVcLnEUipyThKZcpmQKyqT_CoSfd4egCX", function(error, dataLoadEI) {

// dataCF - BeginCash, TotReceipts, TotalExpend, District, CandRegNumb
// dataCandidates - CandRegistrationNumber, CandFirstName, CandLastName, OfficeSought, Party
// dataChatter - district, chatter
// mnsenate_2012_results - candidate, party_id, vote_pct
// mnhouse_2014_results - candidate, party_id, vote_pct
// senate_age_sex - district, population, male_18_to_34, male_35_to_49, male_50_to_64, male_65_over, female_18_to_34, female_35_to_49, female_50_to_64, female_65_over
// house_age_sex - district, population, male_18_to_34, male_35_to_49, male_50_to_64, male_65_over, female_18_to_34, female_35_to_49, female_50_to_64, female_65_over

var dataHouseAge = dataLoadAHouse.house_age_sex;
var dataSenateAge = dataLoadASenate.senate_age_sex;
var dataHouse = dataLoadHouse.mnhouse_2014_results;
var dataSenate = dataLoadSenate.mnsenate_2012_results;
var dataChatter = dataLoadChatter.mnleg_chatter;
var dataCandidates = dataLoadCandidates.candidates_2016;
var dataCF = dataLoadCF.cand_disc_filings;
var dataEI = dataLoadEI.education_income;

//TOGGLES
$(".switch").click(function() {
  $(".switch").removeClass("selected");
  $(this).addClass("selected");
  $(".section, .toggleTables").hide();
  $("#" + $(this).attr("data") + "Toggle").show();
  $("#" + $(this).attr("data")).show();
  $("#year").text($(this).attr("year"));
});

$(".step").click(function() {
  $(".step").removeClass("stepSelect");
  $(this).addClass("stepSelect");
});


$(".hSort").click(function() {
  $(".hSort").removeClass("selected");
  $(this).addClass("selected");
  if ($(this).hasClass("toggled")) { $(this).removeClass("toggled"); var sorted = "ascend"; }
  else if ($(this).hasClass("selected")) { $(this).addClass("toggled"); var sorted ="descend"; } 
  tableSort("#tableHouse","republican",dataHouse,$(this).attr("data"),sorted);
});

$(".sSort").click(function() {
  $(".sSort").removeClass("selected");
  $(this).addClass("selected");
  if ($(this).hasClass("toggled")) { $(this).removeClass("toggled"); var sorted = "ascend"; }
  else if ($(this).hasClass("selected")) { $(this).addClass("toggled"); var sorted ="descend"; } 
  tableSort("#tableSenate","democrat",dataSenate,$(this).attr("data"),sorted);
});


$(".statNum").click(function() {
  $(".statNum").removeClass("selected");
  $(this).addClass("selected");
  mapReshade("#mapHouse", "mnleg.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapHouseMetro", "mnleg_metro.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapSenate", "mnsenate.json", $(this).attr("data"), "senate", dataSenate);
  mapReshade("#mapSenateMetro", "mnsenate_metro.json", $(this).attr("data"), "senate", dataSenate);
});

$("#houseToggle").click(function() {
  $("#tableHouse, #filterHouse").slideToggle( "slow", function() {});
  $("#analysisHouse").slideToggle( "slow", function() {});
});

$("#senateToggle").click(function() {
  $("#tableSenate").slideToggle( "slow", function() {});
  $("#analysisSenate, #filterSenate").slideToggle( "slow", function() {});
});

$(".district").click(function() {
  $(".district").removeClass("selected");
  $(this).addClass("selected");

      $(".districtName").html("District " + $(this).text());

  for (var i=0; i < dataChatter.length; i++){
      if ($(this).text() == dataChatter[i].district) {  
        $("#candidateGOP").html(dataChatter[i].candidateGOP); 
        $("#candidateDFL").html(dataChatter[i].candidateDFL);
      }
  }

  jQuery.fn.d3Click = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Down = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mousedown", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Up = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mouseup", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

    // clicked2();
    var findDistrict = $(this).text() + "_" + $(this).attr("region");
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Click();
});


//TABLES
function tableSort(container,party,data,candidate,sorted){
   
  d3.select(container).selectAll(".card").sort(function(a, b) {
          if (candidate == "candidate") { 
        if (sorted == "descend") { return d3.descending(a.candidate, b.candidate); }
        if (sorted == "ascend") { return d3.ascending(a.candidate, b.candidate); }
     }
          if (candidate == "district") { 
        if (sorted == "descend") { return d3.descending(a.district, b.district); }
        if (sorted == "ascend") { return d3.ascending(a.district, b.district); }
     }
           if (candidate == "party") { 
        if (sorted == "descend") { return d3.descending(a.party_id, b.party_id); }
        if (sorted == "ascend") { return d3.ascending(a.party_id, b.party_id); }
     }
           if (candidate == "vote") { 
        if (sorted == "descend") { return d3.descending(a.vote_pct, b.vote_pct); }
        if (sorted == "ascend") { return d3.ascending(a.vote_pct, b.vote_pct); }
     }
    })
    .transition().duration(500);
}

function tableBuild(container,race,data,state,county,index){

if (race == "senate") { var select = "districtS"; }
if (race == "house") { var select = "districtH"; }

d3.select(container).selectAll(".card")
.data(data.filter(function(d){ return d.vote_pct > 50; })).enter().append("div")
.attr("class","card")
.html(function (d){ 
    if (d.party_id == "R") { 
      var shade = "republican"; var party = "RPM";
        if  (d.vote_pct > 80) { var swatch = "r4"; }
        else if  (d.vote_pct > 70) { var swatch = "r3"; }
        else if  (d.vote_pct > 60) { var swatch = "r2"; }
        else if  (d.vote_pct > 50) { var swatch = "r1"; }
    }
    else if (d.party_id == "DFL") { 
      var party = "DFL"; var shade="democrat";
        if  (d.vote_pct > 80) { var swatch = "d4"; }
        else if  (d.vote_pct > 70) { var swatch = "d3"; }
        else if  (d.vote_pct > 60) { var swatch = "d2"; }
        else if  (d.vote_pct > 50) { var swatch = "d1"; }
     }
    return "<div class='tableCell candidate'>" + d.candidate + "</div><div class='tableCell " + select + "' region='mn'>" + d.district + "</div><div class='tableCell party " + shade + "'>" + party + "</div><div class='tableCell votes "  + swatch +  "'>" + Math.round(d.vote_pct) + "%</div>";
});

$("." + select).click(function() {
 $("." + select).removeClass("selected");
 $(".district").removeClass("selected");
 $(this).addClass("selected");

  $(".districtName").html("District " + $(this).text());

  jQuery.fn.d3Click = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Down = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mousedown", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

jQuery.fn.d3Up = function () {
  this.each(function (i, e) {
    var evt = document.createEvent("MouseEvents");
    evt.initMouseEvent("mouseup", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);

    e.dispatchEvent(evt);
  });
};

  $("#tableHouse, #filterHouse").slideToggle( "slow", function() {});
  $("#tableSenate").slideToggle( "slow", function() {});
  $("#analysisHouse").slideToggle( "slow", function() {});
  $("#analysisSenate, #filterSenate").slideToggle( "slow", function() {});

    // clicked2();
    var findDistrict = $(this).text() + "_" + $(this).attr("region");
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Down();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Up();
    $("[id='" + findDistrict.replace(new RegExp(" ", "g"),"-") + "']").d3Click();
});

}

//SEARCH
$( document ).ready(function() {
     $('#filterSenate input').keyup(function(i){
        $('.card').hide();
        var txt = $('#filterSenate input').val();
        $('.card').each(function(){
           if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
               $(this).show();
           }
        });
    });
     $('#filterHouse input').keyup(function(i){
        $('.card').hide();
        var txt = $('#filterHouse input').val();
        $('.card').each(function(){
           if($(this).text().toUpperCase().indexOf(txt.toUpperCase()) != -1){
               $(this).show();
           }
        });
    });
  });

//MAPS
function mapStats(d, race, dataCompare){
 $('.campaignsRPM, .campaignsDFL, .stats').html("");

  population = Number(d.properties.POPULATION);
  whites = d.properties.F_NH18_WHT;
  minorities = Number(d.properties.F_NH18_DO2) + Number(d.properties.F_NH18_DO1) + Number(d.properties.F_NH18_DOJ) + Number(d.properties.F_H18_POP) + Number(d.properties.F_NH18_DO3) + Number(d.properties.F_NH18_DO4);

  var ageData ;
  if (race == "house") { ageData = dataHouseAge; }
  else if (race == "senate") { ageData = dataSenateAge; }

    for (var i=0; i < ageData.length; i++){
  if (ageData[i].district == d.properties.DISTRICT) {  
   var maleYoung = ageData[i].male_18_to_34 / population;
   var maleMiddle = ageData[i].male_35_to_49 / population;
   var maleOld = ageData[i].male_50_to_64 / population;
   var maleOldest = ageData[i].male_65_over / population;
   var femaleYoung = ageData[i].female_18_to_34 / population;
   var femaleMiddle = ageData[i].female_35_to_49 / population;
   var femaleOld = ageData[i].female_50_to_64 / population;
   var femaleOldest = ageData[i].female_65_over / population;
     for (var j=0; j < dataEI.length; j++){
      if (dataEI[j].county == ageData[i].county){
        var highschool = dataEI[j].highschool_pct;
        var associates = dataEI[j].associates_pct;
        var bachelors = dataEI[j].bachelors_pct;
        var graduate = dataEI[j].grad_degree_pct;
      }
       
     }
   }
  }

  for (var i=0; i < dataCF.length; i++){
    if (dataCF[i].District == d.properties.DISTRICT) { 
      for (var j=0; j < dataCandidates.length; j++){ 
       if (dataCandidates[j].CandRegistrationNumber == dataCF[i].CandRegNumb){
        if (dataCandidates[j].Party == "RPM") {
        $('.campaignsRPM').append("<div class='candidates'>" + dataCandidates[j].CandFirstName + " " + dataCandidates[j].CandLastName + "</div><div class='dollars'>" + d3.format("$,")(Math.round(dataCF[i].TotReceipts)) + "</div>");
        }
        if (dataCandidates[j].Party == "DFL") {
        $('.campaignsDFL').append("<div class='candidates'>" + dataCandidates[j].CandFirstName + " " + dataCandidates[j].CandLastName + "</div><div class='dollars'>" + d3.format("$,")(Math.round(dataCF[i].TotReceipts)) + "</div>");
        }
       }
      }
       

    }
  }

  // $('.campaignsRPM').append("<div class='candidates'>" + dataCandidates[j].CandFirstName + " " + dataCandidates[j].CandLastName + " (<span class='republican'>" + dataCandidates[j].Party + "</span>)</div><div class='dollars'>" + d3.format("$,")(dataCF[i].TotReceipts) + "</div>");

  $('.stats').append("<div class='raceRow' class='statRow'><div class='cell'><div class='label'>White Population</div><div class='statNum' data='whites'>" + whites + "</div></div><div class='cell'><div class='label'>Minority Population</div><div class='statNum' data='minorities'>" + minorities + "</div></div></div><div class='schoolRow' class='statRow'><div class='cell'><div class='label'>High School</div><div class='statNum' data='highschool'>" + highschool + "</div></div><div class='cell'><div class='label'>Some/Associates</div><div class='statNum' data='associates'>" + associates + "</div></div><div class='cell'><div class='label'>Bachelor's</div><div class='statNum' data='bachelors'>" + bachelors + "</div></div><div class='cell'><div class='label'>Graduate</div><div class='statNum' data='graduate'>" + graduate + "</div></div></div><div class='incomeRow' class='statRow'><div class='cell'><div class='label'>< $40k</div><div class='statNum' data='low'>0</div></div><div class='cell'><div class='label'>$40k-$75k</div><div class='statNum' data='mid' data='graduate'>0</div></div><div class='cell'><div class='label'>$75k-$100k</div><div class='statNum' data='high'>0</div></div><div class='cell'><div class='label'>$100k+</div><div class='statNum' data='highest'>0</div></div></div><div class='maleRow' class='statRow'><div class='cell'><div class='label'>Men 18-34</div><div class='statNum' data='mYoung'>" + maleYoung + "</div></div><div class='cell'><div class='label'>Males 35-49</div><div class='statNum' data='mMiddle'>" + maleMiddle + "</div></div><div class='cell'><div class='label'>Males 50-64</div><div class='statNum' data='mOld'>" + maleOld + "</div></div><div class='cell'><div class='label'>Males 65+</div><div class='statNum' data='mOldest'>" + maleOldest + "</div></div></div><div class='femaleRow' class='statRow'><div class='cell'><div class='label'>Females 18-34</div><div class='statNum' data='fYoung'>" + femaleYoung + "</div></div><div class='cell'><div class='label'>Females 35-49</div><div class='statNum' data='fMiddle'>" + femaleMiddle + "</div></div><div class='cell'><div class='label'>Females 50-64</div><div class='statNum' data='fOld'>" + femaleOld + "</div></div><div class='cell'><div class='label'>Females 65+</div><div class='statNum' data='fOldest'>" + femaleOldest + "</div></div></div>");

$(".statNum").click(function() {
  $(".statNum").removeClass("selected");
  $(this).addClass("selected");
  mapReshade("#mapHouse", "mnleg.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapHouseMetro", "mnleg_metro.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapSenate", "mnsenate.json", $(this).attr("data"), "senate", dataSenate);
  mapReshade("#mapSenateMetro", "mnsenate_metro.json", $(this).attr("data"), "senate", dataSenate);
});

}

$(document).bind('DOMNodeInserted', function(event) {

   $('.raceRow .cell .statNum').each(function() {
    var num = $(this).text();
      if (num >= .80) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .60) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .40) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .20) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
   $('.schoolRow .cell .statNum').each(function() {
    var num = $(this).text();
      if (num >= .35) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .30) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .20) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .10) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
   $('.incomeRow .cell .statNum').each(function() {
    var num = $(this).text();
      if (num >= .35) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .30) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .20) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .10) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
   $('.maleRow .cell  .statNum').each(function() {
    var num = $(this).text();
      if (num > .10) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .09) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .07) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .04) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
   $('.femaleRow .cell .statNum').each(function() {
    var num = $(this).text();
      if (num > .10) { $(this).addClass("gray5"); $(this).html(d3.format("%")(num)); }
      else if (num >= .09) { $(this).addClass("gray4"); $(this).html(d3.format("%")(num)); } 
      else if (num >= .07) { $(this).addClass("gray3"); $(this).html(d3.format("%")(num)); }
      else if (num >= .04) { $(this).addClass("gray2"); $(this).html(d3.format("%")(num)); }
      else if (num > 0) { $(this).addClass("gray1"); $(this).html(d3.format("%")(num)); }
    });
});


function mapColor(d, race, dataCompare){
  if (race == "house"){
    for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].district == d){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "r4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "r3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "r2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "r1"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "d4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "d3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "d2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "d1"; }
      }
    }
     
  }
}
  if (race == "senate"){
    for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].district == d){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "r4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "r3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "r2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "r1"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "d4"; }
        else if  (dataCompare[i].vote_pct > 70) { return "d3"; }
        else if  (dataCompare[i].vote_pct > 60) { return "d2"; }
        else if  (dataCompare[i].vote_pct > 50) { return "d1"; }
      }
    }
     
  }
 }
}

function mapTips(d, subject, dataCompare){
    if (subject == "house"){
    for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].district == d.properties.DISTRICT){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r4'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 70) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r3'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 60) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r2'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 50) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r1'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d4'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 70) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d3'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 60) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d2'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 50) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d1'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
      }
    }
     
  }
}
  if (subject == "senate"){
    for (var i=0; i < dataCompare.length; i++){
    if (dataCompare[i].district == d.properties.DISTRICT){
      if (dataCompare[i].party_id == "R") { 
        if  (dataCompare[i].vote_pct > 80) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r4'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 70) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r3'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 60) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r2'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 50) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='r1'>" +  Math.round(dataCompare[i].vote_pct)+ "% win</div>"; }
      }
      else if (dataCompare[i].party_id == "DFL") { 
        if  (dataCompare[i].vote_pct > 80) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d4'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 70) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d3'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 60) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d2'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
        else if  (dataCompare[i].vote_pct > 50) { return "<div>District " + d.properties.DISTRICT + "</div><div>" + dataCompare[i].candidate + "</div><div class='d1'>" +  Math.round(dataCompare[i].vote_pct) + "% win</div>"; }
      }
    }
     
  }
 }
}

function mapBuild(container, boxContainer, chartContainer, shape, race, geo, dataCompare, index) {

var width = $("#mapHouse").width(),
    height = 400,
    centered;

if (geo=="us") { var projection = d3.geo.albersUsa().scale(700).translate([330, 200]); }
else if (geo=="mn") { var projection = d3.geo.albersUsa().scale(5037).translate([50, 970]); }
else if (geo=="metro") { var projection = d3.geo.mercator().scale([16800]).center([-92.263184,44.863656]); }

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select(container + " svg")
    .attr("width", width)
    .attr("height", height);

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height);

var g = svg.append("g");

d3.json("shapefiles/" + shape, function(error, us) {

  g.append("g")
      .attr("class", "states")
    .selectAll("path")
      .data(us.features)
    .enter().append("path")
      .attr("d", path)
      .on("click", clicked)
      .attr("id", function(d) { var str = d.properties.DISTRICT + "_" + geo; return str.replace(new RegExp(" ", "g"),"-"); })
      .attr("precinctName", function(d){ return d.properties.DISTRICT })
      .attr("class", function(d){
         return mapColor(d.properties.DISTRICT, race, dataCompare);
        })
       .on("mousedown", function(d, i){   
        mapStats(d,race,dataCompare);
        $('.districtName').html("<div class='" + mapColor(d.properties.DISTRICT, race, dataCompare) + "'>District " + d.properties.DISTRICT + "</div>");
       })
      .style("stroke-width", "0")
      // .style("stroke", "#fff")
      .call(d3.helper.tooltip(function(d, i){
        return mapTips(d, race, dataCompare);
      }));

  g.append("path")
      //.datum(topojson.mesh(us, us.features, function(a, b) { return a !== b; }))
      .attr("id", "state-borders")
      .attr("d", path);

});

var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+ 
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("circle")
            .attr("d", path.projection(projection));
        g.selectAll("path")  
            .attr("d", path.projection(projection)); 

  });

$(".zoom").click(function() {
  clicked2();

  mapReshade("#mapHouse", "mnleg.json", "house", "house", dataHouse);
  mapReshade("#mapHouseMetro", "mnleg_metro.json", "house", "house", dataHouse);
  mapReshade("#mapSenate", "mnsenate.json", "senate", "senate", dataSenate);
  mapReshade("#mapSenateMetro", "mnsenate_metro.json", "senate", "senate", dataSenate);

  $('#senate .districtName').html("<div class='d3'>Minnesota</div>");
  $('#house .districtName').html("<div class='r3'>Minnesota</div>");
  $('.campaignsRPM, .campaignsDFL, .stats').html("");

  $('.district, .districtS, .districtH, .statNum').removeClass("selected");

  $('.stats').html("<div class='raceRow' class='statRow'><div class='cell'><div class='label'>White Population</div><div class='statNum' data='whites'>.83</div></div><div class='cell'><div class='label'>Minority Population</div><div class='statNum' data='minorities'>.17</div></div></div><div class='schoolRow' class='statRow'><div class='cell'><div class='label'>High School</div><div class='statNum' data='highschool'>.35</div></div><div class='cell'><div class='label'>Some/Associates</div><div class='statNum' data='associates'>.33</div></div><div class='cell'><div class='label'>Bachelor's</div><div class='statNum' data='bachelors'>.22</div></div><div class='cell'><div class='label'>Graduate</div><div class='statNum' data='graduate'>.11</div></div></div><div class='incomeRow' class='statRow'><div class='cell'><div class='label'>< $40k</div><div class='statNum'>.20</div></div><div class='cell'><div class='label'>$40k-$75k</div><div class='statNum'>.20</div></div><div class='cell'><div class='label'>$75k-$100k</div><div class='statNum'>.20</div></div><div class='cell'><div class='label'>$100k+</div><div class='statNum'>.20</div></div></div><div class='maleRow' class='statRow'><div class='cell'><div class='label'>Men 18-34</div><div class='statNum' data='mYoung'>.12</div></div><div class='cell'><div class='label'>Males 35-49</div><div class='statNum' data='mMiddle'>.07</div></div><div class='cell'><div class='label'>Males 50-64</div><div class='statNum' data='mOld'>.10</div></div><div class='cell'><div class='label'>Males 65+</div><div class='statNum' data='mOldest'>.06</div></div></div><div class='femaleRow' class='statRow'><div class='cell'><div class='label'>Females 18-34</div><div class='statNum' data='fYoung'>.08</div></div><div class='cell'><div class='label'>Females 35-49</div><div class='statNum' data='fMiddle'>.10</div></div><div class='cell'><div class='label'>Females 50-64</div><div class='statNum' data='fOld'>.10</div></div><div class='cell'><div class='label'>Females 65+</div><div class='statNum' data='fOldest'>.07</div></div></div>");

$(".statNum").click(function() {
  $(".statNum").removeClass("selected");
  $(this).addClass("selected");
  mapReshade("#mapHouse", "mnleg.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapHouseMetro", "mnleg_metro.json", $(this).attr("data"), "house", dataHouse);
  mapReshade("#mapSenate", "mnsenate.json", $(this).attr("data"), "senate", dataSenate);
  mapReshade("#mapSenateMetro", "mnsenate_metro.json", $(this).attr("data"), "senate", dataSenate);
});

});

function clicked(d) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 6;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 3;
    centered = null;
  }

  g.selectAll("path")
      .classed("faded", true)
      .classed("active", centered && function(d) { return d === centered; });

  g.transition()
      .duration(750)
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", 1.5 / k + "px");
}

function clicked2(d) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 1;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("path")
      .classed("faded", false)
      .classed("active", centered && function(d) { return d === centered; });

  g.transition()
      .duration(750)
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", 1.5 / k + "px");
}

d3.helper = {};

d3.helper.tooltip = function(accessor){
    return function(selection){
        var tooltipDiv;
        var bodyNode = d3.select('body').node();
        selection.on("mouseover", function(d, i){
            // Clean up lost tooltips
            d3.select('body').selectAll('div.tooltip').remove();
            // Append tooltip
            tooltipDiv = d3.select('body').append('div').attr('class', 'tooltip');
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px')
                .style('position', 'absolute') 
                .style('z-index', 1001);
            // Add text using the accessor function
            var tooltipText = accessor(d, i) || '';
            // Crop text arbitrarily
            //tooltipDiv.style('width', function(d, i){return (tooltipText.length > 80) ? '300px' : null;})
            //    .html(tooltipText);
        })
        .on('mousemove', function(d, i) {
            // Move tooltip
            var absoluteMousePos = d3.mouse(bodyNode);
            tooltipDiv.style('left', (absoluteMousePos[0] + 10)+'px')
                .style('top', (absoluteMousePos[1] - 15)+'px');
            var tooltipText = accessor(d, i) || '';
            tooltipDiv.html(tooltipText);
        })
        .on("mouseout", function(d, i){
            // Remove tooltip
            tooltipDiv.remove();
        });

    };
};

}

function mapReshade(container, shape, subject, race, dataCompare) {

  var ageData;
  var schoolData;
  var incomeData;

d3.json("shapefiles/" + shape, function(error, us) {

d3.selectAll(container + " svg g path")
      .data(us.features)
      .attr("class", function(d){
        if (subject == "senate" || subject == "house") { return mapColor(d.properties.DISTRICT, race, dataCompare); }
        else if (subject == "whites") {
          whites = d.properties.F_NH18_WHT; 
          if (whites >= .80) { return "gray5"; }
          else if (whites >= .60) { return "gray4"; }
          else if (whites >= .40) { return "gray3"; }
          else if (whites >= .20) { return "gray2"; }
          else if (whites > 0) { return "gray1"; }
        } 
        else if (subject == "minorities") { 
          minorities = Number(d.properties.F_NH18_DO2) + Number(d.properties.F_NH18_DO1) + Number(d.properties.F_NH18_DOJ) + Number(d.properties.F_H18_POP) + Number(d.properties.F_NH18_DO3) + Number(d.properties.F_NH18_DO4);
          if (minorities >= .80) { return "gray5"; }
          else if (minorities >= .60) { return "gray4"; } 
          else if (minorities >= .40) { return "gray3"; }
          else if (minorities >= .20) { return "gray2"; }
          else if (minorities > 0) { return "gray1"; }
        } 
        else if (subject == "mYoung") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var maleYoung = ageData[i].male_18_to_34 / population;
          if (maleYoung > .10) { return "gray5"; }
          else if (maleYoung >= .09) { return "gray4"; } 
          else if (maleYoung >= .07) { return "gray3"; }
          else if (maleYoung >= .04) { return "gray2"; }
          else if (maleYoung > 0) { return "gray1"; }
           }
          }
         } 
        else if (subject == "mMiddle") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var maleMiddle = ageData[i].male_35_to_49 / population;
          if (maleMiddle > .10) { return "gray5"; }
          else if (maleMiddle >= .09) { return "gray4"; } 
          else if (maleMiddle >= .07) { return "gray3"; }
          else if (maleMiddle >= .04) { return "gray2"; }
          else if (maleMiddle > 0) { return "gray1"; }
           }
          }
         } 
        else if (subject == "mOld") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var maleOld = ageData[i].male_50_to_64 / population;
          if (maleOld > .10) { return "gray5"; }
          else if (maleOld >= .09) { return "gray4"; } 
          else if (maleOld >= .07) { return "gray3"; }
          else if (maleOld >= .04) { return "gray2"; }
          else if (maleOld > 0) { return "gray1"; }
           }
          }
         }
        else if (subject == "mOldest") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var maleOldest = ageData[i].male_65_over / population;
          if (maleOldest > .10) { return "gray5"; }
          else if (maleOldest >= .09) { return "gray4"; } 
          else if (maleOldest >= .07) { return "gray3"; }
          else if (maleOldest >= .04) { return "gray2"; }
          else if (maleOldest > 0) { return "gray1"; }
           }
          }
        }
        else if (subject == "fYoung") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) {  
          population = Number(d.properties.POPULATION);
          var femaleYoung = ageData[i].female_18_to_34 / population;
          if (femaleYoung > .10) { return "gray5"; }
          else if (femaleYoung >= .09) { return "gray4"; } 
          else if (femaleYoung >= .07) { return "gray3"; }
          else if (femaleYoung >= .04) { return "gray2"; }
          else if (femaleYoung > 0) { return "gray1"; }
           }
          }
         } 
        else if (subject == "fMiddle") {
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) {
          population = Number(d.properties.POPULATION);
          var femaleMiddle = ageData[i].female_35_to_49 / population;
          if (femaleMiddle > .10) { return "gray5"; }
          else if (femaleMiddle >= .09) { return "gray4"; } 
          else if (femaleMiddle >= .07) { return "gray3"; }
          else if (femaleMiddle >= .04) { return "gray2"; }
          else if (femaleMiddle > 0) { return "gray1"; }
           }
          }
        } 
        else if (subject == "fOld") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var femaleOld = ageData[i].female_50_to_64 / population;
          if (femaleOld > .10) { return "gray5"; }
          else if (femaleOld >= .09) { return "gray4"; } 
          else if (femaleOld >= .07) { return "gray3"; }
          else if (femaleOld >= .04) { return "gray2"; }
          else if (femaleOld > 0) { return "gray1"; }
           }
          }
        }
        else if (subject == "fOldest") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
          population = Number(d.properties.POPULATION); 
          var femaleOldest = ageData[i].female_65_over / population;
          if (femaleOldest > .10) { return "gray5"; }
          else if (femaleOldest >= .09) { return "gray4"; } 
          else if (femaleOldest >= .07) { return "gray3"; }
          else if (femaleOldest >= .04) { return "gray2"; }
          else if (femaleOldest > 0) { return "gray1"; }
           }
          }
        }
        else if (subject == "highschool") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
            for (var j=0; j < dataEI.length; j++){
              if (dataEI[j].county == ageData[i].county){
                var highschool = dataEI[j].highschool_pct;
                if (highschool > .35) { return "gray5"; }
                else if (highschool >= .30) { return "gray4"; } 
                else if (highschool >= .20) { return "gray3"; }
                else if (highschool >= .10) { return "gray2"; }
                else if (highschool > 0) { return "gray1"; }
              }
            }
           }
          }
         }
        else if (subject == "associates") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
            for (var j=0; j < dataEI.length; j++){
              if (dataEI[j].county == ageData[i].county){
                var associates = dataEI[j].associates_pct;
                if (associates > .35) { return "gray5"; }
                else if (associates >= .30) { return "gray4"; } 
                else if (associates >= .20) { return "gray3"; }
                else if (associates >= .10) { return "gray2"; }
                else if (associates > 0) { return "gray1"; }
              }
            }
           }
          }
         }
        else if (subject == "bachelors") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
            for (var j=0; j < dataEI.length; j++){
              if (dataEI[j].county == ageData[i].county){
                var bachelors = dataEI[j].bachelors_pct;
                if (highschool > .35) { return "gray5"; }
                else if (bachelors >= .30) { return "gray4"; } 
                else if (bachelors >= .20) { return "gray3"; }
                else if (bachelors >= .10) { return "gray2"; }
                else if (bachelors > 0) { return "gray1"; }
              }
            }
           }
          }
         }
        else if (subject == "graduate") { 
            if (race == "house") { ageData = dataHouseAge; }
            else if (race == "senate") { ageData = dataSenateAge; }
            for (var i=0; i < ageData.length; i++){
          if (ageData[i].district == d.properties.DISTRICT) { 
            for (var j=0; j < dataEI.length; j++){
              if (dataEI[j].county == ageData[i].county){
                var graduate = dataEI[j].grad_degree_pct;
                if (graduate > .35) { return "gray5"; }
                else if (graduate >= .30) { return "gray4"; } 
                else if (graduate >= .20) { return "gray3"; }
                else if (graduate >= .10) { return "gray2"; }
                else if (graduate > 0) { return "gray1"; }
              }
            }
           }
          }
         }
        });

});

}

  mapBuild("#mapHouseMetro", "#houseInfo", "#chart", "mnleg_metro.json", "house", "metro", dataHouse, 0);
  mapBuild("#mapHouse", "#houseInfo", "#chart", "mnleg.json", "house", "mn", dataHouse, 0);

  // mapBuild("#mapSenateMetro", "#senateInfo", "#chart", "mnsenate_metro.json", "senate", "metro", dataSenate, 1);
  // mapBuild("#mapSenate", "#senateInfo", "#chart", "mnsenate.json", "senate", "mn", dataSenate, 1);

  tableBuild("#tableHouse","house",dataHouse,null,null,0);
  // tableBuild("#tableSenate","senate",dataSenate,null,null,1);

});
});
});
});
});
});
});
});
</script>

</html>